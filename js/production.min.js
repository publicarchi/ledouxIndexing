function OpenSeadragon(a){return new OpenSeadragon.Viewer(a)}!function(a){function b(a){return a.replace(/([a-z])-([a-z])/g,function(a,b,c){return b+c.toUpperCase()}).replace(/^-/,"")}function c(a){-1!=a.indexOf("-")&&(a=b(a));var c,d,e=a.charAt(0).toUpperCase()+a.slice(1),f="Moz O ms Webkit",g=f.split(" "),h=(a+" "+g.join(e+" ")+e).split(" "),i=document.createElement("a"),j=h.length;for(c=0;c<j;c++)if(d=h[c],void 0!==i.style[d])return d;return!1}function d(){return(-1===f.indexOf("Android 2.")&&-1===f.indexOf("Android 4.0")||-1===f.indexOf("Mobile Safari")||-1!==f.indexOf("Chrome")||-1!==f.indexOf("Windows Phone")||"file:"===location.protocol)&&(window.history&&"pushState"in window.history&&"replaceState"in window.history)}var e={},f=navigator.userAgent;e.history=d(),a.support=e,a.testCSS=c}(this),function(){for(var a,b=function(){},c=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeline","timelineEnd","timeStamp","trace","warn"],d=c.length,e=window.console=window.console||{};d--;)a=c[d],e[a]||(e[a]=b)}(),function(a){a.matches=a.matches||a.mozMatchesSelector||a.msMatchesSelector||a.oMatchesSelector||a.webkitMatchesSelector||function(a){for(var b=this,c=(b.document||b.ownerDocument).querySelectorAll(a),d=0;c[d]&&c[d]!==b;)++d;return!!c[d]},a.closest=a.closest||function(a){for(var b=this;b&&!b.matches(a);)b=b.parentElement;return b}}(Element.prototype),function(a){a.remove=a.remove||function(){this.parentNode&&this.parentNode.removeChild(this)}}(Element.prototype),function(a){a.forEach(function(a){a.hasOwnProperty("prepend")||Object.defineProperty(a,"prepend",{configurable:!0,enumerable:!0,writable:!0,value:function(){var a=Array.prototype.slice.call(arguments),b=document.createDocumentFragment();a.forEach(function(a){var c=a instanceof Node;b.appendChild(c?a:document.createTextNode(String(a)))}),this.insertBefore(b,this.firstChild)}})})}([Element.prototype,Document.prototype,DocumentFragment.prototype]),function(a){a.forEach(function(a){a.hasOwnProperty("append")||Object.defineProperty(a,"append",{configurable:!0,enumerable:!0,writable:!0,value:function(){var a=Array.prototype.slice.call(arguments),b=document.createDocumentFragment();a.forEach(function(a){var c=a instanceof Node;b.appendChild(c?a:document.createTextNode(String(a)))}),this.appendChild(b)}})})}([Element.prototype,Document.prototype,DocumentFragment.prototype]),function(a){a.forEach(function(a){a.hasOwnProperty("before")||Object.defineProperty(a,"before",{configurable:!0,enumerable:!0,writable:!0,value:function(){var a=Array.prototype.slice.call(arguments),b=document.createDocumentFragment();a.forEach(function(a){var c=a instanceof Node;b.appendChild(c?a:document.createTextNode(String(a)))}),this.parentNode.insertBefore(b,this)}})})}([Element.prototype,CharacterData.prototype,DocumentType.prototype]),function(a){a.forEach(function(a){a.hasOwnProperty("after")||Object.defineProperty(a,"after",{configurable:!0,enumerable:!0,writable:!0,value:function(){var a=Array.prototype.slice.call(arguments),b=document.createDocumentFragment();a.forEach(function(a){var c=a instanceof Node;b.appendChild(c?a:document.createTextNode(String(a)))}),this.parentNode.insertBefore(b,this.nextSibling)}})})}([Element.prototype,CharacterData.prototype,DocumentType.prototype]),window.lazySizesConfig=window.lazySizesConfig||{},window.lazySizesConfig.expand=200,window.lazySizesConfig.loadHidden=!1,function(a){var b=function(a,b,c){"use strict";var d,e;if(function(){var b,c={lazyClass:"lazyload",loadedClass:"lazyloaded",loadingClass:"lazyloading",preloadClass:"lazypreload",errorClass:"lazyerror",autosizesClass:"lazyautosizes",srcAttr:"data-src",srcsetAttr:"data-srcset",sizesAttr:"data-sizes",minSize:40,customMedia:{},init:!0,expFactor:1.5,hFac:.8,loadMode:2,loadHidden:!0,ricTimeout:0,throttleDelay:125};e=a.lazySizesConfig||a.lazysizesConfig||{};for(b in c)b in e||(e[b]=c[b])}(),!b||!b.getElementsByClassName)return{init:function(){},cfg:e,noSupport:!0};var f=b.documentElement,g=a.HTMLPictureElement,h="addEventListener",i="getAttribute",j=a[h].bind(a),k=a.setTimeout,l=a.requestAnimationFrame||k,m=a.requestIdleCallback,n=/^picture$/i,o=["load","error","lazyincluded","_lazyloaded"],p={},q=Array.prototype.forEach,r=function(a,b){return p[b]||(p[b]=new RegExp("(\\s|^)"+b+"(\\s|$)")),p[b].test(a[i]("class")||"")&&p[b]},s=function(a,b){r(a,b)||a.setAttribute("class",(a[i]("class")||"").trim()+" "+b)},t=function(a,b){var c;(c=r(a,b))&&a.setAttribute("class",(a[i]("class")||"").replace(c," "))},u=function(a,b,c){var d=c?h:"removeEventListener";c&&u(a,b),o.forEach(function(c){a[d](c,b)})},v=function(a,c,e,f,g){var h=b.createEvent("Event");return e||(e={}),e.instance=d,h.initEvent(c,!f,!g),h.detail=e,a.dispatchEvent(h),h},w=function(b,c){var d;!g&&(d=a.picturefill||e.pf)?(c&&c.src&&!b[i]("srcset")&&b.setAttribute("srcset",c.src),d({reevaluate:!0,elements:[b]})):c&&c.src&&(b.src=c.src)},x=function(a,b){return(getComputedStyle(a,null)||{})[b]},y=function(a,b,c){for(c=c||a.offsetWidth;c<e.minSize&&b&&!a._lazysizesWidth;)c=b.offsetWidth,b=b.parentNode;return c},z=function(){var a,c,d=[],e=[],f=d,g=function(){var b=f;for(f=d.length?e:d,a=!0,c=!1;b.length;)b.shift()();a=!1},h=function(d,e){a&&!e?d.apply(this,arguments):(f.push(d),c||(c=!0,(b.hidden?k:l)(g)))};return h._lsFlush=g,h}(),A=function(a,b){return b?function(){z(a)}:function(){var b=this,c=arguments;z(function(){a.apply(b,c)})}},B=function(a){var b,d=0,f=e.throttleDelay,g=e.ricTimeout,h=function(){b=!1,d=c.now(),a()},i=m&&g>49?function(){m(h,{timeout:g}),g!==e.ricTimeout&&(g=e.ricTimeout)}:A(function(){k(h)},!0);return function(a){var e;(a=!0===a)&&(g=33),b||(b=!0,e=f-(c.now()-d),e<0&&(e=0),a||e<9?i():k(i,e))}},C=function(a){var b,d,e=99,f=function(){b=null,a()},g=function(){var a=c.now()-d;a<e?k(g,e-a):(m||f)(f)};return function(){d=c.now(),b||(b=k(g,e))}},D=function(){var g,m,o,p,y,D,F,G,H,I,J,K,L=/^img$/i,M=/^iframe$/i,N="onscroll"in a&&!/(gle|ing)bot/.test(navigator.userAgent),O=0,P=0,Q=0,R=-1,S=function(a){Q--,(!a||Q<0||!a.target)&&(Q=0)},T=function(a){return null==K&&(K="hidden"==x(b.body,"visibility")),K||!("hidden"==x(a.parentNode,"visibility")&&"hidden"==x(a,"visibility"))},U=function(a,c){var d,e=a,g=T(a);for(G-=c,J+=c,H-=c,I+=c;g&&(e=e.offsetParent)&&e!=b.body&&e!=f;)(g=(x(e,"opacity")||1)>0)&&"visible"!=x(e,"overflow")&&(d=e.getBoundingClientRect(),g=I>d.left&&H<d.right&&J>d.top-1&&G<d.bottom+1);return g},V=function(){var a,c,h,j,k,l,n,o,q,r,s,t,u=d.elements;if((p=e.loadMode)&&Q<8&&(a=u.length)){for(c=0,R++;c<a;c++)if(u[c]&&!u[c]._lazyRace)if(!N||d.prematureUnveil&&d.prematureUnveil(u[c]))ba(u[c]);else if((o=u[c][i]("data-expand"))&&(l=1*o)||(l=P),r||(r=!e.expand||e.expand<1?f.clientHeight>500&&f.clientWidth>500?500:370:e.expand,d._defEx=r,s=r*e.expFactor,t=e.hFac,K=null,P<s&&Q<1&&R>2&&p>2&&!b.hidden?(P=s,R=0):P=p>1&&R>1&&Q<6?r:O),q!==l&&(D=innerWidth+l*t,F=innerHeight+l,n=-1*l,q=l),h=u[c].getBoundingClientRect(),(J=h.bottom)>=n&&(G=h.top)<=F&&(I=h.right)>=n*t&&(H=h.left)<=D&&(J||I||H||G)&&(e.loadHidden||T(u[c]))&&(m&&Q<3&&!o&&(p<3||R<4)||U(u[c],l))){if(ba(u[c]),k=!0,Q>9)break}else!k&&m&&!j&&Q<4&&R<4&&p>2&&(g[0]||e.preloadAfterLoad)&&(g[0]||!o&&(J||I||H||G||"auto"!=u[c][i](e.sizesAttr)))&&(j=g[0]||u[c]);j&&!k&&ba(j)}},W=B(V),X=function(a){var b=a.target;if(b._lazyCache)return void delete b._lazyCache;S(a),s(b,e.loadedClass),t(b,e.loadingClass),u(b,Z),v(b,"lazyloaded")},Y=A(X),Z=function(a){Y({target:a.target})},$=function(a,b){try{a.contentWindow.location.replace(b)}catch(y){a.src=b}},_=function(a){var b,c=a[i](e.srcsetAttr);(b=e.customMedia[a[i]("data-media")||a[i]("media")])&&a.setAttribute("media",b),c&&a.setAttribute("srcset",c)},aa=A(function(a,b,c,d,f){var g,h,j,l,m,p;(m=v(a,"lazybeforeunveil",b)).defaultPrevented||(d&&(c?s(a,e.autosizesClass):a.setAttribute("sizes",d)),h=a[i](e.srcsetAttr),g=a[i](e.srcAttr),f&&(j=a.parentNode,l=j&&n.test(j.nodeName||"")),p=b.firesLoad||"src"in a&&(h||g||l),m={target:a},s(a,e.loadingClass),p&&(clearTimeout(o),o=k(S,2500),u(a,Z,!0)),l&&q.call(j.getElementsByTagName("source"),_),h?a.setAttribute("srcset",h):g&&!l&&(M.test(a.nodeName)?$(a,g):a.src=g),f&&(h||l)&&w(a,{src:g})),a._lazyRace&&delete a._lazyRace,t(a,e.lazyClass),z(function(){var b=a.complete&&a.naturalWidth>1;p&&!b||(b&&s(a,"ls-is-cached"),X(m),a._lazyCache=!0,k(function(){"_lazyCache"in a&&delete a._lazyCache},9)),"lazy"==a.loading&&Q--},!0)}),ba=function(a){if(!a._lazyRace){var b,c=L.test(a.nodeName),d=c&&(a[i](e.sizesAttr)||a[i]("sizes")),f="auto"==d;(!f&&m||!c||!a[i]("src")&&!a.srcset||a.complete||r(a,e.errorClass)||!r(a,e.lazyClass))&&(b=v(a,"lazyunveilread").detail,f&&E.updateElem(a,!0,a.offsetWidth),a._lazyRace=!0,Q++,aa(a,b,f,d,c))}},ca=C(function(){e.loadMode=3,W()}),da=function(){3==e.loadMode&&(e.loadMode=2),ca()},ea=function(){if(!m){if(c.now()-y<999)return void k(ea,999);m=!0,e.loadMode=3,W(),j("scroll",da,!0)}};return{_:function(){y=c.now(),d.elements=b.getElementsByClassName(e.lazyClass),g=b.getElementsByClassName(e.lazyClass+" "+e.preloadClass),j("scroll",W,!0),j("resize",W,!0),j("pageshow",function(a){if(a.persisted){var c=b.querySelectorAll("."+e.loadingClass);c.length&&c.forEach&&l(function(){c.forEach(function(a){a.complete&&ba(a)})})}}),a.MutationObserver?new MutationObserver(W).observe(f,{childList:!0,subtree:!0,attributes:!0}):(f[h]("DOMNodeInserted",W,!0),f[h]("DOMAttrModified",W,!0),setInterval(W,999)),j("hashchange",W,!0),["focus","mouseover","click","load","transitionend","animationend"].forEach(function(a){b[h](a,W,!0)}),/d$|^c/.test(b.readyState)?ea():(j("load",ea),b[h]("DOMContentLoaded",W),k(ea,2e4)),d.elements.length?(V(),z._lsFlush()):W()},checkElems:W,unveil:ba,_aLSL:da}}(),E=function(){var a,c=A(function(a,b,c,d){var e,f,g;if(a._lazysizesWidth=d,d+="px",a.setAttribute("sizes",d),n.test(b.nodeName||""))for(e=b.getElementsByTagName("source"),f=0,g=e.length;f<g;f++)e[f].setAttribute("sizes",d);c.detail.dataAttr||w(a,c.detail)}),d=function(a,b,d){var e,f=a.parentNode;f&&(d=y(a,f,d),e=v(a,"lazybeforesizes",{width:d,dataAttr:!!b}),e.defaultPrevented||(d=e.detail.width)&&d!==a._lazysizesWidth&&c(a,f,e,d))},f=function(){var b,c=a.length;if(c)for(b=0;b<c;b++)d(a[b])},g=C(f);return{_:function(){a=b.getElementsByClassName(e.autosizesClass),j("resize",g)},checkElems:g,updateElem:d}}(),F=function(){!F.i&&b.getElementsByClassName&&(F.i=!0,E._(),D._())};return k(function(){e.init&&F()}),d={cfg:e,autoSizer:E,loader:D,init:F,uP:w,aC:s,rC:t,hC:r,fire:v,gW:y,rAF:z}}(a,a.document,Date);a.lazySizes=b,"object"==typeof module&&module.exports&&(module.exports=b)}("undefined"!=typeof window?window:{}),function(a,b){"object"==typeof exports&&"object"==typeof module?module.exports=b():"function"==typeof define&&define.amd?define("whatInput",[],b):"object"==typeof exports?exports.whatInput=b():a.whatInput=b()}(this,function(){function a(d){if(c[d])return c[d].exports;var e=c[d]={exports:{},id:d,loaded:!1};return b[d].call(e.exports,e,e.exports,a),e.loaded=!0,e.exports}return c={},a.m=b=[function(a,b){"use strict";a.exports=function(){if("undefined"==typeof document||"undefined"==typeof window)return{ask:function(){return"initial"},element:function(){return null},ignoreKeys:function(){},specificKeys:function(){},registerOnChange:function(){},unRegisterOnChange:function(){}};var a=document.documentElement,b=null,c="initial",d=c,e=Date.now(),f="false",g=["button","input","select","textarea"],h=[],i=[16,17,18,91,93],j=[],k={keydown:"keyboard",keyup:"keyboard",mousedown:"mouse",mousemove:"mouse",MSPointerDown:"pointer",MSPointerMove:"pointer",pointerdown:"pointer",pointermove:"pointer",touchstart:"touch",touchend:"touch"},l=!1,m={x:null,y:null},n={2:"touch",3:"touch",4:"mouse"},o=!1;try{var p=Object.defineProperty({},"passive",{get:function(){o=!0}});window.addEventListener("test",null,p)}catch(p){}var q=function(){var a=!!o&&{passive:!0};document.addEventListener("DOMContentLoaded",r),window.PointerEvent?(window.addEventListener("pointerdown",s),window.addEventListener("pointermove",u)):window.MSPointerEvent?(window.addEventListener("MSPointerDown",s),window.addEventListener("MSPointerMove",u)):(window.addEventListener("mousedown",s),window.addEventListener("mousemove",u),"ontouchstart"in window&&(window.addEventListener("touchstart",s,a),window.addEventListener("touchend",s))),window.addEventListener(A(),u,a),window.addEventListener("keydown",s),window.addEventListener("keyup",s),window.addEventListener("focusin",v),window.addEventListener("focusout",w)},r=function(){if(f=!(a.getAttribute("data-whatpersist")||"false"===document.body.getAttribute("data-whatpersist")))try{window.sessionStorage.getItem("what-input")&&(c=window.sessionStorage.getItem("what-input")),window.sessionStorage.getItem("what-intent")&&(d=window.sessionStorage.getItem("what-intent"))}catch(p){}t("input"),t("intent")},s=function(a){var b=a.which,e=k[a.type];"pointer"===e&&(e=y(a));var f=!j.length&&-1===i.indexOf(b),h=j.length&&-1!==j.indexOf(b),l="keyboard"===e&&b&&(f||h)||"mouse"===e||"touch"===e;if(z(e)&&(l=!1),l&&c!==e&&(x("input",c=e),t("input")),l&&d!==e){var m=document.activeElement;m&&m.nodeName&&(-1===g.indexOf(m.nodeName.toLowerCase())||"button"===m.nodeName.toLowerCase()&&!D(m,"form"))&&(x("intent",d=e),t("intent"))}},t=function(b){a.setAttribute("data-what"+b,"input"===b?c:d),B(b)},u=function(a){var b=k[a.type];"pointer"===b&&(b=y(a)),C(a),(!l&&!z(b)||l&&"wheel"===a.type||"mousewheel"===a.type||"DOMMouseScroll"===a.type)&&d!==b&&(x("intent",d=b),t("intent"))},v=function(c){c.target.nodeName?(b=c.target.nodeName.toLowerCase(),a.setAttribute("data-whatelement",b),c.target.classList&&c.target.classList.length&&a.setAttribute("data-whatclasses",c.target.classList.toString().replace(" ",","))):w()},w=function(){b=null,a.removeAttribute("data-whatelement"),a.removeAttribute("data-whatclasses")},x=function(a,b){if(f)try{window.sessionStorage.setItem("what-"+a,b)}catch(a){}},y=function(a){return"number"==typeof a.pointerType?n[a.pointerType]:"pen"===a.pointerType?"touch":a.pointerType},z=function(a){var b=Date.now(),d="mouse"===a&&"touch"===c&&b-e<200;return e=b,d},A=function(){return"onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll"},B=function(a){for(var b=0,e=h.length;b<e;b++)h[b].type===a&&h[b].fn.call(void 0,"input"===a?c:d)},C=function(a){m.x!==a.screenX||m.y!==a.screenY?(l=!1,m.x=a.screenX,m.y=a.screenY):l=!0},D=function(a,b){var c=window.Element.prototype;if(c.matches||(c.matches=c.msMatchesSelector||c.webkitMatchesSelector),c.closest)return a.closest(b);do{if(a.matches(b))return a;a=a.parentElement||a.parentNode}while(null!==a&&1===a.nodeType);return null};return"addEventListener"in window&&Array.prototype.indexOf&&(k[A()]="mouse",q()),{ask:function(a){return"intent"===a?d:c},element:function(){return b},ignoreKeys:function(a){i=a},specificKeys:function(a){j=a},registerOnChange:function(a,b){h.push({fn:a,type:b||"input"})},unRegisterOnChange:function(a){var b=function(a){for(var b=0,c=h.length;b<c;b++)if(h[b].fn===a)return b}(a);!b&&0!==b||h.splice(b,1)},clearStorage:function(){window.sessionStorage.clear()}}}()}],a.c=c,a.p="",a(0);var b,c}),function(a){a.version={versionStr:"3.1.0",major:parseInt("3",10),minor:parseInt("1",10),revision:parseInt("0",10)};var b={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"},c=Object.prototype.toString,d=Object.prototype.hasOwnProperty;a.isFunction=function(b){return"function"===a.type(b)},a.isArray=Array.isArray||function(b){return"array"===a.type(b)},a.isWindow=function(a){return a&&"object"==typeof a&&"setInterval"in a},a.type=function(a){return null==a?String(a):b[c.call(a)]||"object"},a.isPlainObject=function(b){if(!b||"object"!==OpenSeadragon.type(b)||b.nodeType||a.isWindow(b))return!1;if(b.constructor&&!d.call(b,"constructor")&&!d.call(b.constructor.prototype,"isPrototypeOf"))return!1;var c;for(var e in b)c=e;return void 0===c||d.call(b,c)},a.isEmptyObject=function(a){for(var b in a)return!1;return!0},a.freezeObject=function(b){return Object.freeze?a.freezeObject=Object.freeze:a.freezeObject=function(a){return a},a.freezeObject(b)},a.supportsCanvas=(e=document.createElement("canvas"),!(!a.isFunction(e.getContext)||!e.getContext("2d")));var e;a.isCanvasTainted=function(a){var b=!1;try{a.getContext("2d").getImageData(0,0,1,1)}catch(a){b=!0}return b},a.supportsAddEventListener=!(!document.documentElement.addEventListener||!document.addEventListener),a.supportsRemoveEventListener=!(!document.documentElement.removeEventListener||!document.removeEventListener),a.supportsEventListenerOptions=function(){var b=0;if(a.supportsAddEventListener)try{var c={get capture(){return b++,!1},get once(){return b++,!1},get passive(){return b++,!1}};window.addEventListener("test",null,c),window.removeEventListener("test",null,c)}catch(c){b=0}return 3<=b}(),a.getCurrentPixelDensityRatio=function(){if(a.supportsCanvas){var b=document.createElement("canvas").getContext("2d"),c=window.devicePixelRatio||1;return b=b.webkitBackingStorePixelRatio||b.mozBackingStorePixelRatio||b.msBackingStorePixelRatio||b.oBackingStorePixelRatio||b.backingStorePixelRatio||1,Math.max(c,1)/b}return 1},a.pixelDensityRatio=a.getCurrentPixelDensityRatio()}(OpenSeadragon),function(a){function b(a){}function c(a,b){return b&&a!==document.body?document.body:a.offsetParent}a.extend=function(){var a,b,c,d,e,f,g=arguments[0]||{},h=arguments.length,i=!1,j=1;for("boolean"==typeof g&&(i=g,g=arguments[1]||{},j=2),"object"==typeof g||OpenSeadragon.isFunction(g)||(g={}),h===j&&(g=this,--j);j<h;j++)if(null!==(a=arguments[j])||void 0!==a)for(b in a)c=g[b],g!==(d=a[b])&&(i&&d&&(OpenSeadragon.isPlainObject(d)||(e=OpenSeadragon.isArray(d)))?(e?(e=!1,f=c&&OpenSeadragon.isArray(c)?c:[]):f=c&&OpenSeadragon.isPlainObject(c)?c:{},g[b]=OpenSeadragon.extend(i,f,d)):void 0!==d&&(g[b]=d));return g},a.extend(a,{DEFAULT_SETTINGS:{xmlPath:null,tileSources:null,tileHost:null,initialPage:0,crossOriginPolicy:!1,ajaxWithCredentials:!1,loadTilesWithAjax:!1,ajaxHeaders:{},splitHashDataForPost:!1,panHorizontal:!0,panVertical:!0,constrainDuringPan:!1,wrapHorizontal:!1,wrapVertical:!1,visibilityRatio:.5,minPixelRatio:.5,defaultZoomLevel:0,minZoomLevel:null,maxZoomLevel:null,homeFillsViewer:!1,clickTimeThreshold:300,clickDistThreshold:5,dblClickTimeThreshold:300,dblClickDistThreshold:20,springStiffness:6.5,animationTime:1.2,gestureSettingsMouse:{dragToPan:!0,scrollToZoom:!0,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsTouch:{dragToPan:!0,scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsPen:{dragToPan:!0,scrollToZoom:!1,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsUnknown:{dragToPan:!0,scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},zoomPerClick:2,zoomPerScroll:1.2,zoomPerSecond:1,blendTime:0,alwaysBlend:!1,autoHideControls:!0,immediateRender:!1,minZoomImageRatio:.9,maxZoomPixelRatio:1.1,smoothTileEdgesMinZoom:1.1,iOSDevice:function(){if("object"!=typeof navigator)return!1;var a=navigator.userAgent;return"string"==typeof a&&(-1!==a.indexOf("iPhone")||-1!==a.indexOf("iPad")||-1!==a.indexOf("iPod"))}(),pixelsPerWheelLine:40,pixelsPerArrowPress:40,autoResize:!0,preserveImageSizeOnResize:!1,minScrollDeltaTime:50,rotationIncrement:90,showSequenceControl:!0,sequenceControlAnchor:null,preserveViewport:!1,preserveOverlays:!1,navPrevNextWrap:!1,showNavigationControl:!0,navigationControlAnchor:null,showZoomControl:!0,showHomeControl:!0,showFullPageControl:!0,showRotationControl:!1,showFlipControl:!1,controlsFadeDelay:2e3,controlsFadeLength:1500,mouseNavEnabled:!0,showNavigator:!1,navigatorId:null,navigatorPosition:null,navigatorSizeRatio:.2,navigatorMaintainSizeRatio:!1,navigatorTop:null,navigatorLeft:null,navigatorHeight:null,navigatorWidth:null,navigatorAutoResize:!0,navigatorAutoFade:!0,navigatorRotate:!0,navigatorBackground:"#000",navigatorOpacity:.8,navigatorBorderColor:"#555",navigatorDisplayRegionColor:"#900",degrees:0,flipped:!1,opacity:1,preload:!1,compositeOperation:null,imageSmoothingEnabled:!0,placeholderFillStyle:null,subPixelRoundingForTransparency:null,showReferenceStrip:!1,referenceStripScroll:"horizontal",referenceStripElement:null,referenceStripHeight:null,referenceStripWidth:null,referenceStripPosition:"BOTTOM_LEFT",referenceStripSizeRatio:.2,collectionRows:3,collectionColumns:0,collectionLayout:"horizontal",collectionMode:!1,collectionTileSize:800,collectionTileMargin:80,imageLoaderLimit:0,maxImageCacheCount:200,timeout:3e4,useCanvas:!0,prefixUrl:"/images/",navImages:{zoomIn:{REST:"zoomin_rest.png",GROUP:"zoomin_grouphover.png",HOVER:"zoomin_hover.png",DOWN:"zoomin_pressed.png"},zoomOut:{REST:"zoomout_rest.png",GROUP:"zoomout_grouphover.png",HOVER:"zoomout_hover.png",DOWN:"zoomout_pressed.png"},home:{REST:"home_rest.png",GROUP:"home_grouphover.png",HOVER:"home_hover.png",DOWN:"home_pressed.png"},fullpage:{REST:"fullpage_rest.png",GROUP:"fullpage_grouphover.png",HOVER:"fullpage_hover.png",DOWN:"fullpage_pressed.png"},rotateleft:{REST:"rotateleft_rest.png",GROUP:"rotateleft_grouphover.png",HOVER:"rotateleft_hover.png",DOWN:"rotateleft_pressed.png"},rotateright:{REST:"rotateright_rest.png",GROUP:"rotateright_grouphover.png",HOVER:"rotateright_hover.png",DOWN:"rotateright_pressed.png"},flip:{REST:"flip_rest.png",GROUP:"flip_grouphover.png",HOVER:"flip_hover.png",DOWN:"flip_pressed.png"},previous:{REST:"previous_rest.png",GROUP:"previous_grouphover.png",HOVER:"previous_hover.png",DOWN:"previous_pressed.png"},next:{REST:"next_rest.png",GROUP:"next_grouphover.png",HOVER:"next_hover.png",DOWN:"next_pressed.png"}},debugMode:!1,debugGridColor:["#437AB2","#1B9E77","#D95F02","#7570B3","#E7298A","#66A61E","#E6AB02","#A6761D","#666666"],silenceMultiImageWarnings:!1},SIGNAL:"----seadragon----",delegate:function(a,b){return function(){var c=arguments;return b.apply(a,c=void 0===c?[]:c)}},BROWSERS:{UNKNOWN:0,IE:1,FIREFOX:2,SAFARI:3,CHROME:4,OPERA:5,EDGE:6,CHROMEEDGE:7},SUBPIXEL_ROUNDING_OCCURRENCES:{NEVER:0,ONLY_AT_REST:1,ALWAYS:2},_viewers:new Map,getViewer:function(b){return a._viewers.get(this.getElement(b))},getElement:function(a){return a="string"==typeof a?document.getElementById(a):a},getElementPosition:function(b){var d,e,f=new a.Point;for(e=c(b=a.getElement(b),d="fixed"===a.getElementStyle(b).position);e;)f.x+=b.offsetLeft,f.y+=b.offsetTop,d&&(f=f.plus(a.getPageScroll())),e=c(b=e,d="fixed"===a.getElementStyle(b).position);return f},getElementOffset:function(b){var c,d=(b=a.getElement(b))&&b.ownerDocument,e={top:0,left:0};return d?(c=d.documentElement,void 0!==b.getBoundingClientRect&&(e=b.getBoundingClientRect()),d=d===d.window?d:9===d.nodeType&&(d.defaultView||d.parentWindow),new a.Point(e.left+(d.pageXOffset||c.scrollLeft)-(c.clientLeft||0),e.top+(d.pageYOffset||c.scrollTop)-(c.clientTop||0))):new a.Point},getElementSize:function(b){return b=a.getElement(b),new a.Point(b.clientWidth,b.clientHeight)},getElementStyle:document.documentElement.currentStyle?function(b){return(b=a.getElement(b)).currentStyle}:function(b){return b=a.getElement(b),window.getComputedStyle(b,"")},getCssPropertyWithVendorPrefix:function(b){var c={};return a.getCssPropertyWithVendorPrefix=function(b){if(void 0!==c[b])return c[b];var d=document.createElement("div").style,e=null;if(void 0!==d[b])e=b;else for(var f=["Webkit","Moz","MS","O","webkit","moz","ms","o"],g=a.capitalizeFirstLetter(b),h=0;h<f.length;h++){var i=f[h]+g;if(void 0!==d[i]){e=i;break}}return c[b]=e},a.getCssPropertyWithVendorPrefix(b)},capitalizeFirstLetter:function(a){return a.charAt(0).toUpperCase()+a.slice(1)},positiveModulo:function(a,b){return a%=b,a<0&&(a+=b),a},pointInElement:function(b,c){b=a.getElement(b);var d=a.getElementOffset(b),b=a.getElementSize(b);return c.x>=d.x&&c.x<d.x+b.x&&c.y<d.y+b.y&&c.y>=d.y},getMousePosition:function(b){if("number"==typeof b.pageX)a.getMousePosition=function(b){var c=new a.Point;return c.x=b.pageX,c.y=b.pageY,c};else{if("number"!=typeof b.clientX)throw new Error("Unknown event mouse position, no known technique.");a.getMousePosition=function(b){var c=new a.Point;return c.x=b.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,c.y=b.clientY+document.body.scrollTop+document.documentElement.scrollTop,c}}return a.getMousePosition(b)},getPageScroll:function(){var b=document.documentElement||{},c=document.body||{};if("number"==typeof window.pageXOffset)a.getPageScroll=function(){return new a.Point(window.pageXOffset,window.pageYOffset)};else if(c.scrollLeft||c.scrollTop)a.getPageScroll=function(){return new a.Point(document.body.scrollLeft,document.body.scrollTop)};else{if(!b.scrollLeft&&!b.scrollTop)return new a.Point(0,0);a.getPageScroll=function(){return new a.Point(document.documentElement.scrollLeft,document.documentElement.scrollTop)}}return a.getPageScroll()},setPageScroll:function(b){if(void 0!==window.scrollTo)a.setPageScroll=function(a){window.scrollTo(a.x,a.y)};else{var c=a.getPageScroll();if(c.x===b.x&&c.y===b.y)return;document.body.scrollLeft=b.x,document.body.scrollTop=b.y;var d=a.getPageScroll();if(d.x!==c.x&&d.y!==c.y)return void(a.setPageScroll=function(a){document.body.scrollLeft=a.x,document.body.scrollTop=a.y});if(document.documentElement.scrollLeft=b.x,document.documentElement.scrollTop=b.y,(d=a.getPageScroll()).x!==c.x&&d.y!==c.y)return void(a.setPageScroll=function(a){document.documentElement.scrollLeft=a.x,document.documentElement.scrollTop=a.y});a.setPageScroll=function(a){}}a.setPageScroll(b)},getWindowSize:function(){var b=document.documentElement||{},c=document.body||{};if("number"==typeof window.innerWidth)a.getWindowSize=function(){return new a.Point(window.innerWidth,window.innerHeight)};else if(b.clientWidth||b.clientHeight)a.getWindowSize=function(){return new a.Point(document.documentElement.clientWidth,document.documentElement.clientHeight)};else{if(!c.clientWidth&&!c.clientHeight)throw new Error("Unknown window size, no known technique.");a.getWindowSize=function(){return new a.Point(document.body.clientWidth,document.body.clientHeight)}}return a.getWindowSize()},makeCenteredNode:function(b){b=a.getElement(b);var c=[a.makeNeutralElement("div"),a.makeNeutralElement("div"),a.makeNeutralElement("div")];return a.extend(c[0].style,{display:"table",height:"100%",width:"100%"}),a.extend(c[1].style,{display:"table-row"}),a.extend(c[2].style,{display:"table-cell",verticalAlign:"middle",textAlign:"center"}),c[0].appendChild(c[1]),c[1].appendChild(c[2]),c[2].appendChild(b),c[0]},makeNeutralElement:function(a){var b=document.createElement(a),a=b.style;return a.background="transparent none",a.border="none",a.margin="0px",a.padding="0px",a.position="static",b},now:function(){return Date.now?a.now=Date.now:a.now=function(){return(new Date).getTime()},a.now()},makeTransparentImage:function(b){var c=a.makeNeutralElement("img");return c.src=b,c},setElementOpacity:function(b,c,d){b=a.getElement(b),d&&!a.Browser.alpha&&(c=Math.round(c)),a.Browser.opacity?b.style.opacity=c<1?c:"":c<1?(c=Math.round(100*c),b.style.filter="alpha(opacity="+c+")"):b.style.filter=""},setElementTouchActionNone:function(b){void 0!==(b=a.getElement(b)).style.touchAction?b.style.touchAction="none":void 0!==b.style.msTouchAction&&(b.style.msTouchAction="none")},setElementPointerEvents:function(b,c){void 0!==(b=a.getElement(b)).style&&void 0!==b.style.pointerEvents&&(b.style.pointerEvents=c)},setElementPointerEventsNone:function(b){a.setElementPointerEvents(b,"none")},addClass:function(b,c){(b=a.getElement(b)).className?-1===(" "+b.className+" ").indexOf(" "+c+" ")&&(b.className+=" "+c):b.className=c},indexOf:function(a,b,c){return Array.prototype.indexOf?this.indexOf=function(a,b,c){return a.indexOf(b,c)}:this.indexOf=function(a,b,c){var d,e,c=c||0;if(!a)throw new TypeError;if(0===(e=a.length)||e<=c)return-1;for(d=c=c<0?e-Math.abs(c):c;d<e;d++)if(a[d]===b)return d;return-1},this.indexOf(a,b,c)},removeClass:function(b,c){var d,e,f=[];for(d=(b=a.getElement(b)).className.split(/\s+/),e=0;e<d.length;e++)d[e]&&d[e]!==c&&f.push(d[e]);b.className=f.join(" ")},normalizeEventListenerOptions:function(b){return void 0!==b?"boolean"==typeof b?a.supportsEventListenerOptions?{capture:b}:b:a.supportsEventListenerOptions?b:void 0!==b.capture&&b.capture:!!a.supportsEventListenerOptions&&{capture:!1}},addEvent:function(){if(a.supportsAddEventListener)return function(b,c,d,e){e=a.normalizeEventListenerOptions(e),(b=a.getElement(b)).addEventListener(c,d,e)};if(document.documentElement.attachEvent&&document.attachEvent)return function(b,c,d){(b=a.getElement(b)).attachEvent("on"+c,d)};throw new Error("No known event model.")}(),removeEvent:function(){if(a.supportsRemoveEventListener)return function(b,c,d,e){e=a.normalizeEventListenerOptions(e),(b=a.getElement(b)).removeEventListener(c,d,e)};if(document.documentElement.detachEvent&&document.detachEvent)return function(b,c,d){(b=a.getElement(b)).detachEvent("on"+c,d)};throw new Error("No known event model.")}(),cancelEvent:function(a){a.preventDefault()},eventIsCanceled:function(a){return a.defaultPrevented},stopEvent:function(a){a.stopPropagation()},createCallback:function(a,b){var c,d=[];for(c=2;c<arguments.length;c++)d.push(arguments[c]);return function(){var c,e=d.concat([]);for(c=0;c<arguments.length;c++)e.push(arguments[c]);return b.apply(a,e)}},getUrlParameter:function(a){return(a=e[a])||null},getUrlProtocol:function(a){return a=a.match(/^([a-z]+:)\/\//i),null===a?window.location.protocol:a[1].toLowerCase()},createAjaxRequest:function(b){var c;try{c=!!new ActiveXObject("Microsoft.XMLHTTP")}catch(b){c=!1}if(c)window.XMLHttpRequest?a.createAjaxRequest=function(a){return a?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest}:a.createAjaxRequest=function(){return new ActiveXObject("Microsoft.XMLHTTP")};else{if(!window.XMLHttpRequest)throw new Error("Browser doesn't support XMLHttpRequest.");a.createAjaxRequest=function(){return new XMLHttpRequest}}return a.createAjaxRequest(b)},makeAjaxRequest:function(b,c,d){var e,f,g,h;a.isPlainObject(b)&&(c=b.success,d=b.error,e=b.withCredentials,f=b.headers,g=b.responseType||null,h=b.postData||null,b=b.url);var i=a.getUrlProtocol(b),j=a.createAjaxRequest("file:"===i);if(!a.isFunction(c))throw new Error("makeAjaxRequest requires a success callback");j.onreadystatechange=function(){4===j.readyState&&(j.onreadystatechange=function(){},200<=j.status&&j.status<300||0===j.status&&"http:"!==i&&"https:"!==i?c(j):a.isFunction(d)?d(j):a.console.error("AJAX request returned %d: %s",j.status,b))};var k=h?"POST":"GET";try{if(j.open(k,b,!0),g&&(j.responseType=g),f)for(var l in f)Object.prototype.hasOwnProperty.call(f,l)&&f[l]&&j.setRequestHeader(l,f[l]);e&&(j.withCredentials=!0),j.send(h)}catch(b){a.console.error("%s while making AJAX request: %s",b.name,b.message),j.onreadystatechange=function(){},a.isFunction(d)&&d(j,b)}return j},jsonp:function(b){var c,d=b.url,e=document.head||document.getElementsByTagName("head")[0]||document.documentElement,f=b.callbackName||"openseadragon"+a.now(),g=window[f],h=b.param||"callback",i=b.callback;d=d.replace(/(=)\?(&|$)|\?\?/i,"$1"+f+"$2"),d+=(/\?/.test(d)?"&":"?")+h+"="+f,window[f]=function(b){if(g)window[f]=g;else try{delete window[f]}catch(b){}i&&a.isFunction(i)&&i(b)},c=document.createElement("script"),void 0===b.async&&!1===b.async||(c.async="async"),b.scriptCharset&&(c.charset=b.scriptCharset),c.src=d,
c.onload=c.onreadystatechange=function(a,b){(b||!c.readyState||/loaded|complete/.test(c.readyState))&&(c.onload=c.onreadystatechange=null,e&&c.parentNode&&e.removeChild(c),c=void 0)},e.insertBefore(c,e.firstChild)},createFromDZI:function(){throw"OpenSeadragon.createFromDZI is deprecated, use Viewer.open."},parseXml:function(b){if(window.DOMParser)a.parseXml=function(a){return(new DOMParser).parseFromString(a,"text/xml")};else{if(!window.ActiveXObject)throw new Error("Browser doesn't support XML DOM.");a.parseXml=function(a){var b=null;return(b=new ActiveXObject("Microsoft.XMLDOM")).async=!1,b.loadXML(a),b}}return a.parseXml(b)},parseJSON:function(b){return a.parseJSON=window.JSON.parse,a.parseJSON(b)},imageFormatSupported:function(a){return!!d[(a=a||"").toLowerCase()]},setImageFormatsSupported:function(b){a.extend(d,b)}}),a.console=window.console||{log:b,debug:b,info:b,warn:b,error:b,assert:b};var d={bmp:!(a.Browser={vendor:a.BROWSERS.UNKNOWN,version:0,alpha:!0}),jpeg:!0,jpg:!0,png:!0,tif:!1,wdp:!1},e={};!function(){var b=navigator.appVersion,c=navigator.userAgent;switch(navigator.appName){case"Microsoft Internet Explorer":window.attachEvent&&window.ActiveXObject&&(a.Browser.vendor=a.BROWSERS.IE,a.Browser.version=parseFloat(c.substring(c.indexOf("MSIE")+5,c.indexOf(";",c.indexOf("MSIE")))));break;case"Netscape":window.addEventListener&&(0<=c.indexOf("Edge")?(a.Browser.vendor=a.BROWSERS.EDGE,a.Browser.version=parseFloat(c.substring(c.indexOf("Edge")+5))):0<=c.indexOf("Edg")?(a.Browser.vendor=a.BROWSERS.CHROMEEDGE,a.Browser.version=parseFloat(c.substring(c.indexOf("Edg")+4))):0<=c.indexOf("Firefox")?(a.Browser.vendor=a.BROWSERS.FIREFOX,a.Browser.version=parseFloat(c.substring(c.indexOf("Firefox")+8))):0<=c.indexOf("Safari")?(a.Browser.vendor=0<=c.indexOf("Chrome")?a.BROWSERS.CHROME:a.BROWSERS.SAFARI,a.Browser.version=parseFloat(c.substring(c.substring(0,c.indexOf("Safari")).lastIndexOf("/")+1,c.indexOf("Safari")))):null!==new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})").exec(c)&&(a.Browser.vendor=a.BROWSERS.IE,a.Browser.version=parseFloat(RegExp.$1)));break;case"Opera":a.Browser.vendor=a.BROWSERS.OPERA,a.Browser.version=parseFloat(b)}var d,f,g=window.location.search.substring(1).split("&");for(f=0;f<g.length;f++)if(0<(i=(d=g[f]).indexOf("="))){var h=d.substring(0,i),i=d.substring(i+1);try{e[h]=decodeURIComponent(i)}catch(b){a.console.error("Ignoring malformed URL parameter: %s=%s",h,i)}}a.Browser.alpha=!(a.Browser.vendor===a.BROWSERS.CHROME&&a.Browser.version<2),a.Browser.opacity=!0,a.Browser.vendor===a.BROWSERS.IE&&a.Browser.version<11&&a.console.error("Internet Explorer versions < 11 are not supported by OpenSeadragon")}(),function(b){var c=b.requestAnimationFrame||b.mozRequestAnimationFrame||b.webkitRequestAnimationFrame||b.msRequestAnimationFrame,d=b.cancelAnimationFrame||b.mozCancelAnimationFrame||b.webkitCancelAnimationFrame||b.msCancelAnimationFrame;if(c&&d)a.requestAnimationFrame=function(){return c.apply(b,arguments)},a.cancelAnimationFrame=function(){return d.apply(b,arguments)};else{var e,f=[],g=[],h=0;a.requestAnimationFrame=function(b){return f.push([++h,b]),e=e||setInterval(function(){if(f.length){var b=a.now(),c=g;for(g=f,f=c;g.length;)g.shift()[1](b)}else clearInterval(e),e=void 0},20),h},a.cancelAnimationFrame=function(a){var b,c;for(b=0,c=f.length;b<c;b+=1)if(f[b][0]===a)return void f.splice(b,1);for(b=0,c=g.length;b<c;b+=1)if(g[b][0]===a)return void g.splice(b,1)}}}(window)}(OpenSeadragon),function(a,b){"function"==typeof define&&define.amd?define([],b):"object"==typeof module&&module.exports?module.exports=b():a.OpenSeadragon=b()}(this,function(){return OpenSeadragon}),function(a){var b={supportsFullScreen:!1,isFullScreen:function(){return!1},getFullScreenElement:function(){return null},requestFullScreen:function(){},exitFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",fullScreenErrorEventName:""};document.exitFullscreen?(b.supportsFullScreen=!0,b.getFullScreenElement=function(){return document.fullscreenElement},b.requestFullScreen=function(a){return a.requestFullscreen()},b.exitFullScreen=function(){document.exitFullscreen()},b.fullScreenEventName="fullscreenchange",b.fullScreenErrorEventName="fullscreenerror"):document.msExitFullscreen?(b.supportsFullScreen=!0,b.getFullScreenElement=function(){return document.msFullscreenElement},b.requestFullScreen=function(a){return a.msRequestFullscreen()},b.exitFullScreen=function(){document.msExitFullscreen()},b.fullScreenEventName="MSFullscreenChange",b.fullScreenErrorEventName="MSFullscreenError"):document.webkitExitFullscreen?(b.supportsFullScreen=!0,b.getFullScreenElement=function(){return document.webkitFullscreenElement},b.requestFullScreen=function(a){return a.webkitRequestFullscreen()},b.exitFullScreen=function(){document.webkitExitFullscreen()},b.fullScreenEventName="webkitfullscreenchange",b.fullScreenErrorEventName="webkitfullscreenerror"):document.webkitCancelFullScreen?(b.supportsFullScreen=!0,b.getFullScreenElement=function(){return document.webkitCurrentFullScreenElement},b.requestFullScreen=function(a){return a.webkitRequestFullScreen()},b.exitFullScreen=function(){document.webkitCancelFullScreen()},b.fullScreenEventName="webkitfullscreenchange",b.fullScreenErrorEventName="webkitfullscreenerror"):document.mozCancelFullScreen&&(b.supportsFullScreen=!0,b.getFullScreenElement=function(){return document.mozFullScreenElement},b.requestFullScreen=function(a){return a.mozRequestFullScreen()},b.exitFullScreen=function(){document.mozCancelFullScreen()},b.fullScreenEventName="mozfullscreenchange",b.fullScreenErrorEventName="mozfullscreenerror"),b.isFullScreen=function(){return null!==b.getFullScreenElement()},b.cancelFullScreen=function(){a.console.error("cancelFullScreen is deprecated. Use exitFullScreen instead."),b.exitFullScreen()},a.extend(a,b)}(OpenSeadragon),function(a){a.EventSource=function(){this.events={}},a.EventSource.prototype={addOnceHandler:function(a,b,c,d){function e(c){++g===d&&f.removeHandler(a,e),b(c)}var f=this;d=d||1;var g=0;this.addHandler(a,e,c)},addHandler:function(b,c,d){var e=this.events[b];e||(this.events[b]=e=[]),c&&a.isFunction(c)&&(e[e.length]={handler:c,userData:d||null})},removeHandler:function(b,c){var d,e=this.events[b],f=[];if(e&&a.isArray(e)){for(d=0;d<e.length;d++)e[d].handler!==c&&f.push(e[d]);this.events[b]=f}},numberOfHandlers:function(a){return a=this.events[a],a?a.length:0},removeAllHandlers:function(a){if(a)this.events[a]=[];else for(var b in this.events)this.events[b]=[]},getHandler:function(a){var b=this.events[a];return b&&b.length?(b=1===b.length?[b[0]]:Array.apply(null,b),function(a,c){var d,e=b.length;for(d=0;d<e;d++)b[d]&&(c.eventSource=a,c.userData=b[d].userData,b[d].handler(c))}):null},raiseEvent:function(a,b){(a=this.getHandler(a))&&a(this,b=b||{})}}}(OpenSeadragon),function(a){function b(a){try{return a.addEventListener&&a.removeEventListener}catch(a){return}}function c(a,b){return a.hash.toString()+b.type+b.id.toString()}function d(){var b,c,d,e,f,g=N.length,h=a.now();for(e=h-P,P=h,b=0;b<g;b++)(d=(c=N[b]).gPoint).direction=Math.atan2(d.currentPos.y-c.lastPos.y,d.currentPos.x-c.lastPos.x),f=c.lastPos.distanceTo(d.currentPos),c.lastPos=d.currentPos,d.speed=1e3*f/(1+e)*.75+.25*d.speed}function e(a){var b,c,d,e,f,g=L[a.hash],h=g.activePointersLists.length;for(b=0;b<h;b++)if(0<(d=g.activePointersLists[b]).getLength()){for(f=[],e=d.asArray(),c=0;c<e.length;c++)f.push(e[c]);for(c=0;c<f.length;c++)B(a,d,f[c])}for(b=0;b<h;b++)g.activePointersLists.pop();g.sentDragEvent=!1}function f(b){var c,d,f=L[b.hash];if(f.tracking){for(d=0;d<a.MouseTracker.subscribeEvents.length;d++)c=a.MouseTracker.subscribeEvents[d],a.removeEvent(b.element,c,f[c],!1);e(b),f.tracking=!1}}function g(a,b){if(a=L[a.hash],"pointerevent"===b)return{upName:"pointerup",upHandler:a.pointerupcaptured,moveName:"pointermove",moveHandler:a.pointermovecaptured};if("mouse"===b)return{upName:"pointerup",upHandler:a.pointerupcaptured,moveName:"pointermove",moveHandler:a.pointermovecaptured};if("touch"===b)return{upName:"touchend",upHandler:a.touchendcaptured,moveName:"touchmove",moveHandler:a.touchmovecaptured};throw new Error("MouseTracker.getCaptureEventParams: Unknown pointer type.")}function h(c,d){var e;if(a.MouseTracker.havePointerCapture)if(a.MouseTracker.havePointerEvents){if(!(e=c.getActivePointersListByType(d.type).getById(d.id))||!e.captured)return;try{c.element.releasePointerCapture(d.id)}catch(c){}}else c.element.releaseCapture();else e=g(c,a.MouseTracker.havePointerEvents?"pointerevent":d.type),M&&b(window.top)&&a.removeEvent(window.top,e.upName,e.upHandler,!0),a.removeEvent(a.MouseTracker.captureElement,e.moveName,e.moveHandler,!0),a.removeEvent(a.MouseTracker.captureElement,e.upName,e.upHandler,!0);D(c,d,!1)}function i(b){return a.MouseTracker.havePointerEvents?b.pointerId:a.MouseTracker.mousePointerId}function j(b){return a.MouseTracker.havePointerEvents?b.pointerType||(a.Browser.vendor===a.BROWSERS.IE?"mouse":""):"mouse"}function k(b){return!a.MouseTracker.havePointerEvents||b.isPrimary}function l(b){return a.getMousePosition(b)}function m(a,b){return n(l(a),b)}function n(b,c){return c=a.getElementOffset(c),b.minus(c)}function o(b,c){return new a.Point((b.x+c.x)/2,(b.y+c.y)/2)}function p(b,c){var d={target:c.target||c.srcElement,type:"wheel",shiftKey:c.shiftKey||!1,clientX:c.clientX,clientY:c.clientY,pageX:c.pageX||c.clientX,pageY:c.pageY||c.clientY,deltaMode:"MozMousePixelScroll"===c.type?0:1,deltaX:0,deltaZ:0};"mousewheel"===a.MouseTracker.wheelEventName?d.deltaY=-c.wheelDelta/a.DEFAULT_SETTINGS.pixelsPerWheelLine:d.deltaY=c.detail,q(b,d,c)}function q(b,c,d){var e,f,g=null;e=c.deltaY<0?1:-1,C(b,f={originalEvent:c,eventType:"wheel",pointerType:"mouse",isEmulated:c!==d}),!b.scrollHandler||f.preventGesture||f.defaultPrevented||(g={eventSource:b,pointerType:"mouse",position:m(c,b.element),scroll:e,shift:c.shiftKey,isTouchEvent:!1,originalEvent:d,preventDefault:f.preventDefault||f.defaultPrevented,userData:b.userData},b.scrollHandler(g)),f.stopPropagation&&a.stopEvent(d),(g&&g.preventDefault||f.preventDefault&&!f.defaultPrevented)&&a.cancelEvent(d)}function r(b,c){var d={id:i(c),type:j(c),isPrimary:k(c),currentPos:l(c),currentTime:a.now()};c={originalEvent:c,eventType:"pointerenter",pointerType:d.type,isEmulated:!1},C(b,c),E(b,c,d)}function s(b,c){var d={id:i(c),type:j(c),isPrimary:k(c),currentPos:l(c),currentTime:a.now()};c={originalEvent:c,eventType:"pointerleave",pointerType:d.type,isEmulated:!1},C(b,c),F(b,c,d)}function t(b,c){var d={id:i(c),type:j(c),isPrimary:k(c),currentPos:l(c),currentTime:a.now()},e={originalEvent:c,eventType:"pointerover",pointerType:d.type,isEmulated:!1};C(b,e),function(a,b,c){var d,e;d=a.getActivePointersListByType(c.type),(e=d.getById(c.id))?c=e:(c.captured=!1,c.insideElementPressed=!1),a.overHandler&&a.overHandler({eventSource:a,pointerType:c.type,position:n(c.currentPos,a.element),buttons:d.buttons,pointers:a.getActivePointerCount(),insideElementPressed:c.insideElementPressed,buttonDownAny:0!==d.buttons,isTouchEvent:"touch"===c.type,originalEvent:b.originalEvent,userData:a.userData})}(b,e,d),e.preventDefault&&!e.defaultPrevented&&a.cancelEvent(c),e.stopPropagation&&a.stopEvent(c)}function u(b,c){var d={id:i(c),type:j(c),isPrimary:k(c),currentPos:l(c),currentTime:a.now()},e={originalEvent:c,eventType:"pointerout",pointerType:d.type,isEmulated:!1};C(b,e),function(a,b,c){var d,e;d=a.getActivePointersListByType(c.type),(e=d.getById(c.id))?c=e:(c.captured=!1,c.insideElementPressed=!1),a.outHandler&&a.outHandler({eventSource:a,pointerType:c.type,position:c.currentPos&&n(c.currentPos,a.element),buttons:d.buttons,pointers:a.getActivePointerCount(),insideElementPressed:c.insideElementPressed,buttonDownAny:0!==d.buttons,isTouchEvent:"touch"===c.type,originalEvent:b.originalEvent,userData:a.userData})}(b,e,d),e.preventDefault&&!e.defaultPrevented&&a.cancelEvent(c),e.stopPropagation&&a.stopEvent(c)}function v(c,d){var e={id:i(d),type:j(d),isPrimary:k(d),currentPos:l(d),currentTime:a.now()},f=a.MouseTracker.havePointerEvents&&"touch"===e.type&&a.Browser.vendor!==a.BROWSERS.IE,h={originalEvent:d,eventType:"pointerdown",pointerType:e.type,isEmulated:!1};C(c,h),G(c,h,e,d.button),h.preventDefault&&!h.defaultPrevented&&a.cancelEvent(d),h.stopPropagation&&a.stopEvent(d),h.shouldCapture&&(f?D(c,e,!0):function(c,d){var e;if(a.MouseTracker.havePointerCapture)if(a.MouseTracker.havePointerEvents)try{c.element.setPointerCapture(d.id)}catch(c){return void a.console.warn("setPointerCapture() called on invalid pointer ID")}else c.element.setCapture(!0);else e=g(c,a.MouseTracker.havePointerEvents?"pointerevent":d.type),M&&b(window.top)&&a.addEvent(window.top,e.upName,e.upHandler,!0),a.addEvent(a.MouseTracker.captureElement,e.upName,e.upHandler,!0),a.addEvent(a.MouseTracker.captureElement,e.moveName,e.moveHandler,!0);D(c,d,!0)}(c,e))}function w(a,b){x(a,b)}function x(b,c){var d,e={originalEvent:c,eventType:"pointerup",pointerType:(d={id:i(c),type:j(c),isPrimary:k(c),currentPos:l(c),currentTime:a.now()}).type,isEmulated:!1};C(b,e),H(b,e,d,c.button),e.preventDefault&&!e.defaultPrevented&&a.cancelEvent(c),e.stopPropagation&&a.stopEvent(c),e.shouldReleaseCapture&&(c.target===b.element?h(b,d):D(b,d,!1))}function y(a,b){z(a,b)}function z(b,c){var d={id:i(c),type:j(c),isPrimary:k(c),currentPos:l(c),currentTime:a.now()},e={originalEvent:c,eventType:"pointermove",pointerType:d.type,isEmulated:!1};C(b,e),I(b,e,d),e.preventDefault&&!e.defaultPrevented&&a.cancelEvent(c),e.stopPropagation&&a.stopEvent(c)}function A(a,b){return b.speed=0,b.direction=0,b.contactPos=b.currentPos,b.contactTime=b.currentTime,b.lastPos=b.currentPos,b.lastTime=b.currentTime,a.add(b)}function B(b,c,d){var e,f=c.getById(d.id);return f?(f.captured&&(a.console.warn("stopTrackingPointer() called on captured pointer"),h(b,f)),c.removeContact(),e=c.removeById(d.id)):e=c.getLength(),e}function C(b,c){c.eventSource=b,c.eventPhase=c.originalEvent&&void 0!==c.originalEvent.eventPhase?c.originalEvent.eventPhase:0,c.defaultPrevented=a.eventIsCanceled(c.originalEvent),c.shouldCapture=!1,c.shouldReleaseCapture=!1,c.userData=b.userData,function(a,b){switch(b.eventType){case"pointermove":b.isStoppable=!0,b.isCancelable=!0,b.preventDefault=!1,b.preventGesture=!a.hasGestureHandlers,b.stopPropagation=!1;break;case"pointerover":case"pointerout":case"contextmenu":case"keydown":case"keyup":case"keypress":b.isStoppable=!0,b.isCancelable=!0,b.preventDefault=!1,b.preventGesture=!1,b.stopPropagation=!1;break;case"pointerdown":case"pointerup":b.isStoppable=!0,b.isCancelable=!0,b.preventDefault=!1,b.preventGesture=!a.hasGestureHandlers,b.stopPropagation=!1;break;case"wheel":b.isStoppable=!0,b.isCancelable=!0,b.preventDefault=!1,b.preventGesture=!a.hasScrollHandler,b.stopPropagation=!1;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":b.isStoppable=!0,b.isCancelable=!1,b.preventDefault=!1,b.preventGesture=!1,b.stopPropagation=!1;break;case"click":b.isStoppable=!0,b.isCancelable=!0,b.preventDefault=!!a.clickHandler,b.preventGesture=!1,b.stopPropagation=!1;break;case"dblclick":b.isStoppable=!0,b.isCancelable=!0,b.preventDefault=!!a.dblClickHandler,b.preventGesture=!1,b.stopPropagation=!1;break;default:b.isStoppable=!1,b.isCancelable=!1,b.preventDefault=!1,b.preventGesture=!1,b.stopPropagation=!1}}(b,c),b.preProcessEventHandler&&b.preProcessEventHandler(c)}function D(b,c,d){b=b.getActivePointersListByType(c.type),c=b.getById(c.id),c?d&&!c.captured?(c.captured=!0,b.captureCount++):!d&&c.captured&&(c.captured=!1,--b.captureCount<0&&(b.captureCount=0,a.console.warn("updatePointerCaptured() - pointsList.captureCount went negative"))):a.console.warn("updatePointerCaptured() called on untracked pointer")}function E(a,b,c){var d,e=a.getActivePointersListByType(c.type);(d=e.getById(c.id))?(d.insideElement=!0,d.lastPos=d.currentPos,d.lastTime=d.currentTime,d.currentPos=c.currentPos,d.currentTime=c.currentTime,c=d):(c.captured=!1,c.insideElementPressed=!1,c.insideElement=!0,A(e,c)),a.enterHandler&&a.enterHandler({eventSource:a,pointerType:c.type,position:n(c.currentPos,a.element),buttons:e.buttons,pointers:a.getActivePointerCount(),insideElementPressed:c.insideElementPressed,buttonDownAny:0!==e.buttons,isTouchEvent:"touch"===c.type,originalEvent:b.originalEvent,userData:a.userData})}function F(a,b,c){var d,e=a.getActivePointersListByType(c.type);(d=e.getById(c.id))?(d.captured?(d.insideElement=!1,d.lastPos=d.currentPos,d.lastTime=d.currentTime,d.currentPos=c.currentPos,d.currentTime=c.currentTime):B(a,e,d),c=d):(c.captured=!1,c.insideElementPressed=!1),(a.leaveHandler||a.exitHandler)&&(b={eventSource:a,pointerType:c.type,position:c.currentPos&&n(c.currentPos,a.element),buttons:e.buttons,pointers:a.getActivePointerCount(),insideElementPressed:c.insideElementPressed,buttonDownAny:0!==e.buttons,isTouchEvent:"touch"===c.type,originalEvent:b.originalEvent,userData:a.userData},a.leaveHandler&&a.leaveHandler(b),a.exitHandler&&a.exitHandler(b))}function G(b,c,d,e){var f,g=L[b.hash],h=b.getActivePointersListByType(d.type);void 0!==c.originalEvent.buttons?h.buttons=c.originalEvent.buttons:0===e?h.buttons|=1:1===e?h.buttons|=4:2===e?h.buttons|=2:3===e?h.buttons|=8:4===e?h.buttons|=16:5===e&&(h.buttons|=32),0===e?((f=h.getById(d.id))?(f.insideElementPressed=!0,f.insideElement=!0,f.originalTarget=c.originalEvent.target,f.contactPos=d.currentPos,f.contactTime=d.currentTime,f.lastPos=f.currentPos,f.lastTime=f.currentTime,f.currentPos=d.currentPos,f.currentTime=d.currentTime,d=f):(d.captured=!1,d.insideElementPressed=!0,d.insideElement=!0,d.originalTarget=c.originalEvent.target,A(h,d)),h.addContact(),c.preventGesture||c.defaultPrevented?(c.shouldCapture=!1,c.shouldReleaseCapture=!1):(c.shouldCapture=!0,c.shouldReleaseCapture=!1,c.preventDefault=!0,(b.dragHandler||b.dragEndHandler||b.pinchHandler)&&a.MouseTracker.gesturePointVelocityTracker.addPoint(b,d),1===h.contacts?b.pressHandler&&!c.preventGesture&&b.pressHandler({eventSource:b,pointerType:d.type,position:n(d.contactPos,b.element),buttons:h.buttons,isTouchEvent:"touch"===d.type,originalEvent:c.originalEvent,userData:b.userData}):2===h.contacts&&b.pinchHandler&&"touch"===d.type&&(g.pinchGPoints=h.asArray(),g.lastPinchDist=g.currentPinchDist=g.pinchGPoints[0].currentPos.distanceTo(g.pinchGPoints[1].currentPos),g.lastPinchCenter=g.currentPinchCenter=o(g.pinchGPoints[0].currentPos,g.pinchGPoints[1].currentPos)))):(c.shouldCapture=!1,c.shouldReleaseCapture=!1,!b.nonPrimaryPressHandler||c.preventGesture||c.defaultPrevented||(c.preventDefault=!0,b.nonPrimaryPressHandler({eventSource:b,pointerType:d.type,position:n(d.currentPos,b.element),button:e,buttons:h.buttons,isTouchEvent:"touch"===d.type,originalEvent:c.originalEvent,userData:b.userData})))}function H(b,c,d,e){var f,g,h,i=L[b.hash],j=b.getActivePointersListByType(d.type),k=!1;void 0!==c.originalEvent.buttons?j.buttons=c.originalEvent.buttons:0===e?j.buttons^=-2:1===e?j.buttons^=-5:2===e?j.buttons^=-3:3===e?j.buttons^=-9:4===e?j.buttons^=-17:5===e&&(j.buttons^=-33),c.shouldCapture=!1,0===e?((g=j.getById(d.id))?(j.removeContact(),g.captured&&(k=!0),g.lastPos=g.currentPos,g.lastTime=g.currentTime,g.currentPos=d.currentPos,g.currentTime=d.currentTime,g.insideElement||B(b,j,g),f=g.currentPos,h=g.currentTime):(d.captured=!1,d.insideElementPressed=!1,d.insideElement=!0,A(j,d),g=d),c.preventGesture||c.defaultPrevented||(k?(c.shouldReleaseCapture=!0,c.preventDefault=!0,(b.dragHandler||b.dragEndHandler||b.pinchHandler)&&a.MouseTracker.gesturePointVelocityTracker.removePoint(b,g),0===j.contacts?(b.releaseHandler&&f&&b.releaseHandler({eventSource:b,pointerType:g.type,position:n(f,b.element),buttons:j.buttons,insideElementPressed:g.insideElementPressed,insideElementReleased:g.insideElement,isTouchEvent:"touch"===g.type,originalEvent:c.originalEvent,userData:b.userData}),b.dragEndHandler&&i.sentDragEvent&&b.dragEndHandler({eventSource:b,pointerType:g.type,position:n(g.currentPos,b.element),speed:g.speed,direction:g.direction,shift:c.originalEvent.shiftKey,isTouchEvent:"touch"===g.type,originalEvent:c.originalEvent,userData:b.userData}),i.sentDragEvent=!1,(b.clickHandler||b.dblClickHandler)&&g.insideElement&&(h=h-g.contactTime<=b.clickTimeThreshold&&g.contactPos.distanceTo(f)<=b.clickDistThreshold,b.clickHandler&&b.clickHandler({eventSource:b,pointerType:g.type,position:n(g.currentPos,b.element),quick:h,shift:c.originalEvent.shiftKey,isTouchEvent:"touch"===g.type,originalEvent:c.originalEvent,originalTarget:g.originalTarget,userData:b.userData}),b.dblClickHandler&&h&&(j.clicks++,1===j.clicks?(i.lastClickPos=f,i.dblClickTimeOut=setTimeout(function(){j.clicks=0},b.dblClickTimeThreshold)):2===j.clicks&&(clearTimeout(i.dblClickTimeOut),j.clicks=0,i.lastClickPos.distanceTo(f)<=b.dblClickDistThreshold&&b.dblClickHandler({eventSource:b,pointerType:g.type,position:n(g.currentPos,b.element),shift:c.originalEvent.shiftKey,isTouchEvent:"touch"===g.type,originalEvent:c.originalEvent,userData:b.userData}),i.lastClickPos=null)))):2===j.contacts&&b.pinchHandler&&"touch"===g.type&&(i.pinchGPoints=j.asArray(),i.lastPinchDist=i.currentPinchDist=i.pinchGPoints[0].currentPos.distanceTo(i.pinchGPoints[1].currentPos),i.lastPinchCenter=i.currentPinchCenter=o(i.pinchGPoints[0].currentPos,i.pinchGPoints[1].currentPos))):(c.shouldReleaseCapture=!1,b.releaseHandler&&f&&(b.releaseHandler({eventSource:b,pointerType:g.type,position:n(f,b.element),buttons:j.buttons,insideElementPressed:g.insideElementPressed,insideElementReleased:g.insideElement,isTouchEvent:"touch"===g.type,originalEvent:c.originalEvent,userData:b.userData}),c.preventDefault=!0)))):(c.shouldReleaseCapture=!1,!b.nonPrimaryReleaseHandler||c.preventGesture||c.defaultPrevented||(c.preventDefault=!0,b.nonPrimaryReleaseHandler({eventSource:b,pointerType:d.type,position:n(d.currentPos,b.element),button:e,buttons:j.buttons,isTouchEvent:"touch"===d.type,originalEvent:c.originalEvent,userData:b.userData})))}function I(a,b,c){var d,e,f=L[a.hash],g=a.getActivePointersListByType(c.type);void 0!==b.originalEvent.buttons&&(g.buttons=b.originalEvent.buttons),(d=g.getById(c.id))&&(d.lastPos=d.currentPos,d.lastTime=d.currentTime,d.currentPos=c.currentPos,d.currentTime=c.currentTime,b.shouldCapture=!1,b.shouldReleaseCapture=!1,a.stopHandler&&"mouse"===c.type&&(clearTimeout(a.stopTimeOut),a.stopTimeOut=setTimeout(function(){d=a,e=b.originalEvent,f=c.type,d.stopHandler&&d.stopHandler({eventSource:d,pointerType:f,position:m(e,d.element),buttons:d.getActivePointersListByType(f).buttons,isTouchEvent:"touch"===f,originalEvent:e,userData:d.userData});var d,e,f},a.stopDelay)),0===g.contacts?a.moveHandler&&a.moveHandler({eventSource:a,pointerType:c.type,position:n(c.currentPos,a.element),buttons:g.buttons,isTouchEvent:"touch"===c.type,originalEvent:b.originalEvent,userData:a.userData}):1===g.contacts?(a.moveHandler&&(d=g.asArray()[0],a.moveHandler({eventSource:a,pointerType:d.type,position:n(d.currentPos,a.element),buttons:g.buttons,isTouchEvent:"touch"===d.type,originalEvent:b.originalEvent,userData:a.userData})),!a.dragHandler||b.preventGesture||b.defaultPrevented||(e=(d=g.asArray()[0]).currentPos.minus(d.lastPos),a.dragHandler({eventSource:a,pointerType:d.type,position:n(d.currentPos,a.element),buttons:g.buttons,delta:e,speed:d.speed,direction:d.direction,shift:b.originalEvent.shiftKey,isTouchEvent:"touch"===d.type,originalEvent:b.originalEvent,userData:a.userData}),b.preventDefault=!0,f.sentDragEvent=!0)):2===g.contacts&&(a.moveHandler&&(d=g.asArray(),a.moveHandler({eventSource:a,pointerType:d[0].type,position:n(o(d[0].currentPos,d[1].currentPos),a.element),buttons:g.buttons,isTouchEvent:"touch"===d[0].type,originalEvent:b.originalEvent,userData:a.userData})),!a.pinchHandler||"touch"!==c.type||b.preventGesture||b.defaultPrevented||(e=f.pinchGPoints[0].currentPos.distanceTo(f.pinchGPoints[1].currentPos))===f.currentPinchDist||(f.lastPinchDist=f.currentPinchDist,f.currentPinchDist=e,f.lastPinchCenter=f.currentPinchCenter,f.currentPinchCenter=o(f.pinchGPoints[0].currentPos,f.pinchGPoints[1].currentPos),a.pinchHandler({eventSource:a,pointerType:"touch",gesturePoints:f.pinchGPoints,lastCenter:n(f.lastPinchCenter,a.element),center:n(f.currentPinchCenter,a.element),lastDistance:f.lastPinchDist,distance:f.currentPinchDist,shift:b.originalEvent.shiftKey,originalEvent:b.originalEvent,userData:a.userData}),b.preventDefault=!0)))}function J(a,b,c){var d=a.getActivePointersListByType(c.type);(c=d.getById(c.id))&&B(a,d,c)}var K=[],L={};a.MouseTracker=function(b){K.push(this);var c=arguments;a.isPlainObject(b)||(b={element:c[0],clickTimeThreshold:c[1],clickDistThreshold:c[2]}),this.hash=Math.random(),this.element=a.getElement(b.element),this.clickTimeThreshold=b.clickTimeThreshold||a.DEFAULT_SETTINGS.clickTimeThreshold,this.clickDistThreshold=b.clickDistThreshold||a.DEFAULT_SETTINGS.clickDistThreshold,this.dblClickTimeThreshold=b.dblClickTimeThreshold||a.DEFAULT_SETTINGS.dblClickTimeThreshold,this.dblClickDistThreshold=b.dblClickDistThreshold||a.DEFAULT_SETTINGS.dblClickDistThreshold,this.userData=b.userData||null,this.stopDelay=b.stopDelay||50,this.preProcessEventHandler=b.preProcessEventHandler||null,this.contextMenuHandler=b.contextMenuHandler||null,this.enterHandler=b.enterHandler||null,this.leaveHandler=b.leaveHandler||null,this.exitHandler=b.exitHandler||null,this.overHandler=b.overHandler||null,this.outHandler=b.outHandler||null,this.pressHandler=b.pressHandler||null,this.nonPrimaryPressHandler=b.nonPrimaryPressHandler||null,this.releaseHandler=b.releaseHandler||null,this.nonPrimaryReleaseHandler=b.nonPrimaryReleaseHandler||null,this.moveHandler=b.moveHandler||null,this.scrollHandler=b.scrollHandler||null,this.clickHandler=b.clickHandler||null,this.dblClickHandler=b.dblClickHandler||null,this.dragHandler=b.dragHandler||null,this.dragEndHandler=b.dragEndHandler||null,this.pinchHandler=b.pinchHandler||null,this.stopHandler=b.stopHandler||null,this.keyDownHandler=b.keyDownHandler||null,this.keyUpHandler=b.keyUpHandler||null,this.keyHandler=b.keyHandler||null,this.focusHandler=b.focusHandler||null,this.blurHandler=b.blurHandler||null;var d=this;L[this.hash]={click:function(b){!function(b,c){var d={originalEvent:c,eventType:"click",pointerType:"mouse",isEmulated:!1};C(b,d),d.preventDefault&&!d.defaultPrevented&&a.cancelEvent(c),d.stopPropagation&&a.stopEvent(c)}(d,b)},dblclick:function(b){!function(b,c){var d={originalEvent:c,eventType:"dblclick",pointerType:"mouse",isEmulated:!1};C(b,d),d.preventDefault&&!d.defaultPrevented&&a.cancelEvent(c),d.stopPropagation&&a.stopEvent(c)}(d,b)},keydown:function(b){!function(b,c){var d=null,e={originalEvent:c,eventType:"keydown",pointerType:"",isEmulated:!1};C(b,e),!b.keyDownHandler||e.preventGesture||e.defaultPrevented||(d={eventSource:b,keyCode:c.keyCode||c.charCode,ctrl:c.ctrlKey,shift:c.shiftKey,alt:c.altKey,meta:c.metaKey,originalEvent:c,preventDefault:e.preventDefault||e.defaultPrevented,userData:b.userData},b.keyDownHandler(d)),(d&&d.preventDefault||e.preventDefault&&!e.defaultPrevented)&&a.cancelEvent(c),e.stopPropagation&&a.stopEvent(c)}(d,b)},keyup:function(b){!function(b,c){var d=null,e={originalEvent:c,eventType:"keyup",pointerType:"",isEmulated:!1};C(b,e),!b.keyUpHandler||e.preventGesture||e.defaultPrevented||(d={eventSource:b,keyCode:c.keyCode||c.charCode,ctrl:c.ctrlKey,shift:c.shiftKey,alt:c.altKey,meta:c.metaKey,originalEvent:c,preventDefault:e.preventDefault||e.defaultPrevented,userData:b.userData},b.keyUpHandler(d)),(d&&d.preventDefault||e.preventDefault&&!e.defaultPrevented)&&a.cancelEvent(c),e.stopPropagation&&a.stopEvent(c)}(d,b)},keypress:function(b){!function(b,c){var d=null,e={originalEvent:c,eventType:"keypress",pointerType:"",isEmulated:!1};C(b,e),!b.keyHandler||e.preventGesture||e.defaultPrevented||(d={eventSource:b,keyCode:c.keyCode||c.charCode,ctrl:c.ctrlKey,shift:c.shiftKey,alt:c.altKey,meta:c.metaKey,originalEvent:c,preventDefault:e.preventDefault||e.defaultPrevented,userData:b.userData},b.keyHandler(d)),(d&&d.preventDefault||e.preventDefault&&!e.defaultPrevented)&&a.cancelEvent(c),e.stopPropagation&&a.stopEvent(c)}(d,b)},focus:function(a){!function(a,b){var c={originalEvent:b,eventType:"focus",pointerType:"",isEmulated:!1};C(a,c),a.focusHandler&&!c.preventGesture&&a.focusHandler({eventSource:a,originalEvent:b,userData:a.userData})}(d,a)},blur:function(a){!function(a,b){var c={originalEvent:b,eventType:"blur",pointerType:"",isEmulated:!1};C(a,c),a.blurHandler&&!c.preventGesture&&a.blurHandler({eventSource:a,originalEvent:b,userData:a.userData})}(d,a)},contextmenu:function(b){!function(b,c){var d=null,e={originalEvent:c,eventType:"contextmenu",pointerType:"mouse",isEmulated:!1};C(b,e),!b.contextMenuHandler||e.preventGesture||e.defaultPrevented||(d={eventSource:b,position:n(l(c),b.element),originalEvent:e.originalEvent,preventDefault:e.preventDefault||e.defaultPrevented,userData:b.userData},b.contextMenuHandler(d)),(d&&d.preventDefault||e.preventDefault&&!e.defaultPrevented)&&a.cancelEvent(c),e.stopPropagation&&a.stopEvent(c)}(d,b)},wheel:function(a){q(d,a,a)},mousewheel:function(a){p(d,a)},DOMMouseScroll:function(a){p(d,a)},MozMousePixelScroll:function(a){p(d,a)},losecapture:function(b){!function(b,c){var d={id:a.MouseTracker.mousePointerId,type:"mouse"},e={originalEvent:c,eventType:"lostpointercapture",pointerType:"mouse",isEmulated:!1};C(b,e),c.target===b.element&&D(b,d,!1),e.stopPropagation&&a.stopEvent(c)}(d,b)},mouseenter:function(a){r(d,a)},mouseleave:function(a){s(d,a)},mouseover:function(a){t(d,a)},mouseout:function(a){u(d,a)},mousedown:function(a){v(d,a)},mouseup:function(a){w(d,a)},mousemove:function(a){y(d,a)},touchstart:function(b){!function(b,c){var d,e,f,g=c.changedTouches.length,h=b.getActivePointersListByType("touch");d=a.now(),h.getLength()>c.touches.length-g&&a.console.warn("Tracked touch contact count doesn't match event.touches.length");var i={originalEvent:c,eventType:"pointerdown",pointerType:"touch",isEmulated:!1};for(C(b,i),e=0;e<g;e++)f={id:c.changedTouches[e].identifier,type:"touch",isPrimary:0===h.getLength(),currentPos:l(c.changedTouches[e]),currentTime:d},E(b,i,f),G(b,i,f,0),D(b,f,!0);i.preventDefault&&!i.defaultPrevented&&a.cancelEvent(c),i.stopPropagation&&a.stopEvent(c)}(d,b)},touchend:function(b){!function(b,c){var d,e,f,g=c.changedTouches.length;d=a.now();var h={originalEvent:c,eventType:"pointerup",pointerType:"touch",isEmulated:!1};for(C(b,h),e=0;e<g;e++)f={id:c.changedTouches[e].identifier,type:"touch",currentPos:l(c.changedTouches[e]),currentTime:d},H(b,h,f,0),D(b,f,!1),F(b,h,f);h.preventDefault&&!h.defaultPrevented&&a.cancelEvent(c),h.stopPropagation&&a.stopEvent(c)}(d,b)},touchmove:function(b){!function(b,c){var d,e,f,g=c.changedTouches.length;d=a.now();var h={originalEvent:c,eventType:"pointermove",pointerType:"touch",isEmulated:!1};for(C(b,h),e=0;e<g;e++)f={id:c.changedTouches[e].identifier,type:"touch",currentPos:l(c.changedTouches[e]),currentTime:d},I(b,h,f);h.preventDefault&&!h.defaultPrevented&&a.cancelEvent(c),h.stopPropagation&&a.stopEvent(c)}(d,b)},touchcancel:function(b){!function(b,c){var d,e,f=c.changedTouches.length,g={originalEvent:c,eventType:"pointercancel",pointerType:"touch",isEmulated:!1};for(C(b,g),d=0;d<f;d++)e={id:c.changedTouches[d].identifier,type:"touch"},J(b,0,e);g.stopPropagation&&a.stopEvent(c)}(d,b)},gesturestart:function(b){b=b,a.eventIsCanceled(b)||b.preventDefault()},gesturechange:function(b){b=b,a.eventIsCanceled(b)||b.preventDefault()},gotpointercapture:function(b){!function(b,c){var d={originalEvent:c,eventType:"gotpointercapture",pointerType:j(c),isEmulated:!1};C(b,d),c.target===b.element&&D(b,{id:c.pointerId,type:j(c)},!0),d.stopPropagation&&a.stopEvent(c)}(d,b)},lostpointercapture:function(b){!function(b,c){var d={originalEvent:c,eventType:"lostpointercapture",pointerType:j(c),isEmulated:!1};C(b,d),c.target===b.element&&D(b,{id:c.pointerId,type:j(c)},!1),d.stopPropagation&&a.stopEvent(c)}(d,b)},
pointerenter:function(a){r(d,a)},pointerleave:function(a){s(d,a)},pointerover:function(a){t(d,a)},pointerout:function(a){u(d,a)},pointerdown:function(a){v(d,a)},pointerup:function(a){w(d,a)},pointermove:function(a){y(d,a)},pointercancel:function(b){!function(b,c){var d={id:c.pointerId,type:j(c)},e={originalEvent:c,eventType:"pointercancel",pointerType:d.type,isEmulated:!1};C(b,e),J(b,0,d),e.stopPropagation&&a.stopEvent(c)}(d,b)},pointerupcaptured:function(b){!function(b,c){b.getActivePointersListByType(j(c)).getById(c.pointerId)&&x(b,c),a.stopEvent(c)}(d,b)},pointermovecaptured:function(b){!function(b,c){b.getActivePointersListByType(j(c)).getById(c.pointerId)&&z(b,c),a.stopEvent(c)}(d,b)},tracking:!1,activePointersLists:[],lastClickPos:null,dblClickTimeOut:null,pinchGPoints:[],lastPinchDist:0,currentPinchDist:0,lastPinchCenter:null,currentPinchCenter:null,sentDragEvent:!1},this.hasGestureHandlers=!!(this.pressHandler||this.nonPrimaryPressHandler||this.releaseHandler||this.nonPrimaryReleaseHandler||this.clickHandler||this.dblClickHandler||this.dragHandler||this.dragEndHandler||this.pinchHandler),this.hasScrollHandler=!!this.scrollHandler,a.MouseTracker.havePointerEvents&&a.setElementPointerEvents(this.element,"auto"),this.exitHandler&&a.console.error("MouseTracker.exitHandler is deprecated. Use MouseTracker.leaveHandler instead."),b.startDisabled||this.setTracking(!0)},a.MouseTracker.prototype={destroy:function(){var a;for(f(this),this.element=null,a=0;a<K.length;a++)if(K[a]===this){K.splice(a,1);break}L[this.hash]=null,delete L[this.hash]},isTracking:function(){return L[this.hash].tracking},setTracking:function(b){return(b?function(b){var c,d,f=L[b.hash];if(!f.tracking){for(d=0;d<a.MouseTracker.subscribeEvents.length;d++)c=a.MouseTracker.subscribeEvents[d],a.addEvent(b.element,c,f[c],c===a.MouseTracker.wheelEventName&&{passive:!1,capture:!1});e(b),f.tracking=!0}}:f)(this),this},getActivePointersListByType:function(b){var c,d,e=L[this.hash],f=e.activePointersLists.length;for(c=0;c<f;c++)if(e.activePointersLists[c].type===b)return e.activePointersLists[c];return d=new a.MouseTracker.GesturePointList(b),e.activePointersLists.push(d),d},getActivePointerCount:function(){var a,b=L[this.hash],c=b.activePointersLists.length,d=0;for(a=0;a<c;a++)d+=b.activePointersLists[a].getLength();return d},preProcessEventHandler:function(){},contextMenuHandler:function(){},enterHandler:function(){},leaveHandler:function(){},exitHandler:function(){},overHandler:function(){},outHandler:function(){},pressHandler:function(){},nonPrimaryPressHandler:function(){},releaseHandler:function(){},nonPrimaryReleaseHandler:function(){},moveHandler:function(){},scrollHandler:function(){},clickHandler:function(){},dblClickHandler:function(){},dragHandler:function(){},dragEndHandler:function(){},pinchHandler:function(){},stopHandler:function(){},keyDownHandler:function(){},keyUpHandler:function(){},keyHandler:function(){},focusHandler:function(){},blurHandler:function(){}};var M=function(){try{return window.self!==window.top}catch(Q){return!0}}();a.MouseTracker.gesturePointVelocityTracker=(N=[],P=O=0,{addPoint:function(b,e){b=c(b,e),N.push({guid:b,gPoint:e,lastPos:e.currentPos}),1===N.length&&(P=a.now(),O=window.setInterval(d,50))},removePoint:function(a,b){var d,e=c(a,b),f=N.length;for(d=0;d<f;d++)if(N[d].guid===e){N.splice(d,1),0==--f&&window.clearInterval(O);break}}});var N,O,P;a.MouseTracker.captureElement=document,a.MouseTracker.wheelEventName=a.Browser.vendor===a.BROWSERS.IE&&8<a.Browser.version||"onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",a.MouseTracker.subscribeEvents=["click","dblclick","keydown","keyup","keypress","focus","blur","contextmenu",a.MouseTracker.wheelEventName],"DOMMouseScroll"===a.MouseTracker.wheelEventName&&a.MouseTracker.subscribeEvents.push("MozMousePixelScroll"),window.PointerEvent?(a.MouseTracker.havePointerEvents=!0,a.MouseTracker.subscribeEvents.push("pointerenter","pointerleave","pointerover","pointerout","pointerdown","pointerup","pointermove","pointercancel"),a.MouseTracker.havePointerCapture=(Q=document.createElement("div"),a.isFunction(Q.setPointerCapture)&&a.isFunction(Q.releasePointerCapture)),a.MouseTracker.havePointerCapture&&a.MouseTracker.subscribeEvents.push("gotpointercapture","lostpointercapture")):(a.MouseTracker.havePointerEvents=!1,a.MouseTracker.subscribeEvents.push("mouseenter","mouseleave","mouseover","mouseout","mousedown","mouseup","mousemove"),a.MouseTracker.mousePointerId="legacy-mouse",a.MouseTracker.havePointerCapture=(Q=document.createElement("div"),a.isFunction(Q.setCapture)&&a.isFunction(Q.releaseCapture)),a.MouseTracker.havePointerCapture&&a.MouseTracker.subscribeEvents.push("losecapture"),"ontouchstart"in window&&a.MouseTracker.subscribeEvents.push("touchstart","touchend","touchmove","touchcancel"),"ongesturestart"in window&&a.MouseTracker.subscribeEvents.push("gesturestart","gesturechange"));var Q;a.MouseTracker.GesturePointList=function(a){this._gPoints=[],this.type=a,this.buttons=0,this.contacts=0,this.clicks=0,this.captureCount=0},a.MouseTracker.GesturePointList.prototype={getLength:function(){return this._gPoints.length},asArray:function(){return this._gPoints},add:function(a){return this._gPoints.push(a)},removeById:function(a){var b,c=this._gPoints.length;for(b=0;b<c;b++)if(this._gPoints[b].id===a){this._gPoints.splice(b,1);break}return this._gPoints.length},getByIndex:function(a){return a<this._gPoints.length?this._gPoints[a]:null},getById:function(a){var b,c=this._gPoints.length;for(b=0;b<c;b++)if(this._gPoints[b].id===a)return this._gPoints[b];return null},getPrimary:function(a){var b,c=this._gPoints.length;for(b=0;b<c;b++)if(this._gPoints[b].isPrimary)return this._gPoints[b];return null},addContact:function(){1<++this.contacts&&("mouse"===this.type||"pen"===this.type)&&(a.console.warn("GesturePointList.addContact() Implausible contacts value"),this.contacts=1)},removeContact:function(){--this.contacts<0&&(this.contacts=0)}}}(OpenSeadragon),function(a){a.ControlAnchor={NONE:0,TOP_LEFT:1,TOP_RIGHT:2,BOTTOM_RIGHT:3,BOTTOM_LEFT:4,ABSOLUTE:5},a.Control=function(b,c,d){var e=b.parentNode;"number"==typeof c&&(a.console.error("Passing an anchor directly into the OpenSeadragon.Control constructor is deprecated; please use an options object instead.  Support for this deprecated variant is scheduled for removal in December 2013"),c={anchor:c}),c.attachToViewer=void 0===c.attachToViewer||c.attachToViewer,this.autoFade=void 0===c.autoFade||c.autoFade,this.element=b,this.anchor=c.anchor,this.container=d,this.anchor===a.ControlAnchor.ABSOLUTE?(this.wrapper=a.makeNeutralElement("div"),this.wrapper.style.position="absolute",this.wrapper.style.top="number"==typeof c.top?c.top+"px":c.top,this.wrapper.style.left="number"==typeof c.left?c.left+"px":c.left,this.wrapper.style.height="number"==typeof c.height?c.height+"px":c.height,this.wrapper.style.width="number"==typeof c.width?c.width+"px":c.width,this.wrapper.style.margin="0px",this.wrapper.style.padding="0px",this.element.style.position="relative",this.element.style.top="0px",this.element.style.left="0px",this.element.style.height="100%",this.element.style.width="100%"):(this.wrapper=a.makeNeutralElement("div"),this.wrapper.style.display="inline-block",this.anchor===a.ControlAnchor.NONE&&(this.wrapper.style.width=this.wrapper.style.height="100%")),this.wrapper.appendChild(this.element),c.attachToViewer?this.anchor===a.ControlAnchor.TOP_RIGHT||this.anchor===a.ControlAnchor.BOTTOM_RIGHT?this.container.insertBefore(this.wrapper,this.container.firstChild):this.container.appendChild(this.wrapper):e.appendChild(this.wrapper)},a.Control.prototype={destroy:function(){this.wrapper.removeChild(this.element),this.anchor!==a.ControlAnchor.NONE&&this.container.removeChild(this.wrapper)},isVisible:function(){return"none"!==this.wrapper.style.display},setVisible:function(b){this.wrapper.style.display=b?this.anchor===a.ControlAnchor.ABSOLUTE?"block":"inline-block":"none"},setOpacity:function(b){this.element[a.SIGNAL]&&a.Browser.vendor===a.BROWSERS.IE?a.setElementOpacity(this.element,b,!0):a.setElementOpacity(this.wrapper,b,!0)}}}(OpenSeadragon),function(a){function b(a,b){var c,d=a.controls;for(c=d.length-1;0<=c;c--)if(d[c].element===b)return c;return-1}a.ControlDock=function(b){var c,d,e=["topleft","topright","bottomright","bottomleft"];for(a.extend(!0,this,{id:"controldock-"+a.now()+"-"+Math.floor(1e6*Math.random()),container:a.makeNeutralElement("div"),controls:[]},b),this.container.onsubmit=function(){return!1},this.element&&(this.element=a.getElement(this.element),this.element.appendChild(this.container),this.element.style.position="relative",this.container.style.width="100%",this.container.style.height="100%"),d=0;d<e.length;d++)this.controls[c=e[d]]=a.makeNeutralElement("div"),this.controls[c].style.position="absolute",c.match("left")&&(this.controls[c].style.left="0px"),c.match("right")&&(this.controls[c].style.right="0px"),c.match("top")&&(this.controls[c].style.top="0px"),c.match("bottom")&&(this.controls[c].style.bottom="0px");this.container.appendChild(this.controls.topleft),this.container.appendChild(this.controls.topright),this.container.appendChild(this.controls.bottomright),this.container.appendChild(this.controls.bottomleft)},a.ControlDock.prototype={addControl:function(c,d){var e=null;if(!(0<=b(this,c=a.getElement(c)))){switch(d.anchor){case a.ControlAnchor.TOP_RIGHT:e=this.controls.topright,c.style.position="relative",c.style.paddingRight="0px",c.style.paddingTop="0px";break;case a.ControlAnchor.BOTTOM_RIGHT:e=this.controls.bottomright,c.style.position="relative",c.style.paddingRight="0px",c.style.paddingBottom="0px";break;case a.ControlAnchor.BOTTOM_LEFT:e=this.controls.bottomleft,c.style.position="relative",c.style.paddingLeft="0px",c.style.paddingBottom="0px";break;case a.ControlAnchor.TOP_LEFT:e=this.controls.topleft,c.style.position="relative",c.style.paddingLeft="0px",c.style.paddingTop="0px";break;case a.ControlAnchor.ABSOLUTE:e=this.container,c.style.margin="0px",c.style.padding="0px";break;default:case a.ControlAnchor.NONE:e=this.container,c.style.margin="0px",c.style.padding="0px"}this.controls.push(new a.Control(c,d,e)),c.style.display="inline-block"}},removeControl:function(c){return c=b(this,c=a.getElement(c)),0<=c&&(this.controls[c].destroy(),this.controls.splice(c,1)),this},clearControls:function(){for(;0<this.controls.length;)this.controls.pop().destroy();return this},areControlsEnabled:function(){var a;for(a=this.controls.length-1;0<=a;a--)if(this.controls[a].isVisible())return!0;return!1},setControlsEnabled:function(a){var b;for(b=this.controls.length-1;0<=b;b--)this.controls[b].setVisible(a);return this}}}(OpenSeadragon),function(a){a.Placement=a.freezeObject({CENTER:0,TOP_LEFT:1,TOP:2,TOP_RIGHT:3,RIGHT:4,BOTTOM_RIGHT:5,BOTTOM:6,BOTTOM_LEFT:7,LEFT:8,properties:{0:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1},1:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},2:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},3:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!0,isVerticallyCentered:!1,isBottom:!1},4:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!0,isBottom:!1},5:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!1,isBottom:!0},6:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},7:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},8:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1}}})}(OpenSeadragon),function(a){function b(b){return b=a.getElement(b),new a.Point(0===b.clientWidth?1:b.clientWidth,0===b.clientHeight?1:b.clientHeight)}function c(b,c){if(c instanceof a.Overlay)return c;var d=null;if(c.element)d=a.getElement(c.element);else{var e=c.id||"openseadragon-overlay-"+Math.floor(1e7*Math.random());(d=a.getElement(c.id))||((d=document.createElement("a")).href="#/overlay/"+e),d.id=e,a.addClass(d,c.className||"openseadragon-overlay")}var f=c.location,g=c.width,h=c.height;if(!f){e=c.x;var i=c.y;void 0!==c.px&&(b=b.viewport.imageToViewportRectangle(new a.Rect(c.px,c.py,g||0,h||0)),e=b.x,i=b.y,g=void 0!==g?b.width:void 0,h=void 0!==h?b.height:void 0),f=new a.Point(e,i)}return i=c.placement,i&&"string"===a.type(i)&&(i=a.Placement[c.placement.toUpperCase()]),new a.Overlay({element:d,location:f,placement:i,onDraw:c.onDraw,checkResize:c.checkResize,width:g,height:h,rotationMode:c.rotationMode})}function d(a,b){var c;for(c=a.length-1;0<=c;c--)if(a[c].element===b)return c;return-1}function e(b,c){return a.requestAnimationFrame(function(){c(b)})}function f(b){a.requestAnimationFrame(function(){!function(b){var c,d,e;if(b.controlsShouldFade){for(c=a.now(),c-=b.controlsFadeBeginTime,d=1-c/b.controlsFadeLength,d=Math.min(1,d),d=Math.max(0,d),e=b.controls.length-1;0<=e;e--)b.controls[e].autoFade&&b.controls[e].setOpacity(d);0<d&&f(b)}}(b)})}function g(b){b.autoHideControls&&(b.controlsShouldFade=!0,b.controlsFadeBeginTime=a.now()+b.controlsFadeDelay,window.setTimeout(function(){f(b)},b.controlsFadeDelay))}function h(a){var b;for(a.controlsShouldFade=!1,b=a.controls.length-1;0<=b;b--)a.controls[b].setOpacity(1)}function i(){h(this)}function j(){g(this)}function k(a){var b={tracker:a.eventSource,position:a.position,originalEvent:a.originalEvent,preventDefault:a.preventDefault};this.raiseEvent("canvas-contextmenu",b),a.preventDefault=b.preventDefault}function l(b){var c={originalEvent:b.originalEvent,preventDefaultAction:!1,preventVerticalPan:b.preventVerticalPan||!this.panVertical,preventHorizontalPan:b.preventHorizontalPan||!this.panHorizontal};if(this.raiseEvent("canvas-key",c),c.preventDefaultAction||b.ctrl||b.alt||b.meta)b.preventDefault=!1;else switch(b.keyCode){case 38:c.preventVerticalPan||(b.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new a.Point(0,-this.pixelsPerArrowPress))),this.viewport.applyConstraints()),b.preventDefault=!0;break;case 40:c.preventVerticalPan||(b.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new a.Point(0,this.pixelsPerArrowPress))),this.viewport.applyConstraints()),b.preventDefault=!0;break;case 37:c.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new a.Point(-this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),b.preventDefault=!0;break;case 39:c.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new a.Point(this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),b.preventDefault=!0;break;default:b.preventDefault=!1}}function m(b){var c={originalEvent:b.originalEvent,preventDefaultAction:!1,preventVerticalPan:b.preventVerticalPan||!this.panVertical,preventHorizontalPan:b.preventHorizontalPan||!this.panHorizontal};if(this.raiseEvent("canvas-key",c),c.preventDefaultAction||b.ctrl||b.alt||b.meta)b.preventDefault=!1;else switch(b.keyCode){case 43:case 61:this.viewport.zoomBy(1.1),this.viewport.applyConstraints(),b.preventDefault=!0;break;case 45:this.viewport.zoomBy(.9),this.viewport.applyConstraints(),b.preventDefault=!0;break;case 48:this.viewport.goHome(),this.viewport.applyConstraints(),b.preventDefault=!0;break;case 119:case 87:c.preventVerticalPan||(b.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new a.Point(0,-40))),this.viewport.applyConstraints()),b.preventDefault=!0;break;case 115:case 83:c.preventVerticalPan||(b.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new a.Point(0,40))),this.viewport.applyConstraints()),b.preventDefault=!0;break;case 97:c.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new a.Point(-40,0))),this.viewport.applyConstraints()),b.preventDefault=!0;break;case 100:c.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new a.Point(40,0))),this.viewport.applyConstraints()),b.preventDefault=!0;break;case 114:this.viewport.flipped?this.viewport.setRotation(a.positiveModulo(this.viewport.degrees-this.rotationIncrement,360)):this.viewport.setRotation(a.positiveModulo(this.viewport.degrees+this.rotationIncrement,360)),this.viewport.applyConstraints(),b.preventDefault=!0;break;case 82:this.viewport.flipped?this.viewport.setRotation(a.positiveModulo(this.viewport.degrees+this.rotationIncrement,360)):this.viewport.setRotation(a.positiveModulo(this.viewport.degrees-this.rotationIncrement,360)),this.viewport.applyConstraints(),b.preventDefault=!0;break;case 102:this.viewport.toggleFlip(),b.preventDefault=!0;break;case 106:this.goToPreviousPage();break;case 107:this.goToNextPage();break;default:b.preventDefault=!1}}function n(a){var b;document.activeElement===this.canvas||this.canvas.focus(),this.viewport.flipped&&(a.position.x=this.viewport.getContainerSize().x-a.position.x);var c={tracker:a.eventSource,position:a.position,quick:a.quick,shift:a.shift,originalEvent:a.originalEvent,originalTarget:a.originalTarget,preventDefaultAction:!1};this.raiseEvent("canvas-click",c),!c.preventDefaultAction&&this.viewport&&a.quick&&(b=this.gestureSettingsByDeviceType(a.pointerType)).clickToZoom&&(this.viewport.zoomBy(a.shift?1/this.zoomPerClick:this.zoomPerClick,b.zoomToRefPoint?this.viewport.pointFromPixel(a.position,!0):null),this.viewport.applyConstraints())}function o(a){var b,c={tracker:a.eventSource,position:a.position,shift:a.shift,originalEvent:a.originalEvent,preventDefaultAction:!1};this.raiseEvent("canvas-double-click",c),!c.preventDefaultAction&&this.viewport&&(b=this.gestureSettingsByDeviceType(a.pointerType)).dblClickToZoom&&(this.viewport.zoomBy(a.shift?1/this.zoomPerClick:this.zoomPerClick,b.zoomToRefPoint?this.viewport.pointFromPixel(a.position,!0):null),this.viewport.applyConstraints())}function p(a){var b,c={tracker:a.eventSource,pointerType:a.pointerType,position:a.position,delta:a.delta,speed:a.speed,direction:a.direction,shift:a.shift,originalEvent:a.originalEvent,preventDefaultAction:!1};if(this.raiseEvent("canvas-drag",c),(b=this.gestureSettingsByDeviceType(a.pointerType)).dragToPan&&!c.preventDefaultAction&&this.viewport){if(this.panHorizontal||(a.delta.x=0),this.panVertical||(a.delta.y=0),this.viewport.flipped&&(a.delta.x=-a.delta.x),this.constrainDuringPan){var d=this.viewport.deltaPointsFromPixels(a.delta.negate());this.viewport.centerSpringX.target.value+=d.x,this.viewport.centerSpringY.target.value+=d.y;var e=this.viewport.getBounds();c=this.viewport.getConstrainedBounds(),this.viewport.centerSpringX.target.value-=d.x,this.viewport.centerSpringY.target.value-=d.y,e.x!==c.x&&(a.delta.x=0),e.y!==c.y&&(a.delta.y=0)}this.viewport.panBy(this.viewport.deltaPointsFromPixels(a.delta.negate()),b.flickEnabled&&!this.constrainDuringPan)}}function q(b){var c={tracker:b.eventSource,pointerType:b.pointerType,position:b.position,speed:b.speed,direction:b.direction,shift:b.shift,originalEvent:b.originalEvent,preventDefaultAction:!1};if(this.raiseEvent("canvas-drag-end",c),!c.preventDefaultAction&&this.viewport){var d=this.gestureSettingsByDeviceType(b.pointerType);if(d.flickEnabled&&b.speed>=d.flickMinSpeed){var e=0;this.panHorizontal&&(e=d.flickMomentum*b.speed*Math.cos(b.direction)),c=0,this.panVertical&&(c=d.flickMomentum*b.speed*Math.sin(b.direction)),b=this.viewport.pixelFromPoint(this.viewport.getCenter(!0)),c=this.viewport.pointFromPixel(new a.Point(b.x-e,b.y-c)),this.viewport.panTo(c,!1)}this.viewport.applyConstraints()}}function r(a){this.raiseEvent("canvas-enter",{tracker:a.eventSource,pointerType:a.pointerType,position:a.position,buttons:a.buttons,pointers:a.pointers,insideElementPressed:a.insideElementPressed,buttonDownAny:a.buttonDownAny,originalEvent:a.originalEvent})}function s(a){this.raiseEvent("canvas-exit",{tracker:a.eventSource,pointerType:a.pointerType,position:a.position,buttons:a.buttons,pointers:a.pointers,insideElementPressed:a.insideElementPressed,buttonDownAny:a.buttonDownAny,originalEvent:a.originalEvent})}function t(a){this.raiseEvent("canvas-press",{tracker:a.eventSource,pointerType:a.pointerType,position:a.position,insideElementPressed:a.insideElementPressed,insideElementReleased:a.insideElementReleased,originalEvent:a.originalEvent})}function u(a){this.raiseEvent("canvas-release",{tracker:a.eventSource,pointerType:a.pointerType,position:a.position,insideElementPressed:a.insideElementPressed,insideElementReleased:a.insideElementReleased,originalEvent:a.originalEvent})}function v(a){this.raiseEvent("canvas-nonprimary-press",{tracker:a.eventSource,position:a.position,pointerType:a.pointerType,button:a.button,buttons:a.buttons,originalEvent:a.originalEvent})}function w(a){this.raiseEvent("canvas-nonprimary-release",{tracker:a.eventSource,position:a.position,pointerType:a.pointerType,button:a.button,buttons:a.buttons,originalEvent:a.originalEvent})}function x(a){var b,c,d,e={tracker:a.eventSource,pointerType:a.pointerType,gesturePoints:a.gesturePoints,lastCenter:a.lastCenter,center:a.center,lastDistance:a.lastDistance,distance:a.distance,shift:a.shift,originalEvent:a.originalEvent,preventDefaultPanAction:!1,preventDefaultZoomAction:!1,preventDefaultRotateAction:!1};this.raiseEvent("canvas-pinch",e),this.viewport&&(!(b=this.gestureSettingsByDeviceType(a.pointerType)).pinchToZoom||e.preventDefaultPanAction&&e.preventDefaultZoomAction||(c=this.viewport.pointFromPixel(a.center,!0),b.zoomToRefPoint&&!e.preventDefaultPanAction&&(d=this.viewport.pointFromPixel(a.lastCenter,!0).minus(c),this.panHorizontal||(d.x=0),this.panVertical||(d.y=0),this.viewport.panBy(d,!0)),e.preventDefaultZoomAction||this.viewport.zoomBy(a.distance/a.lastDistance,c,!0),this.viewport.applyConstraints()),b.pinchRotate&&!e.preventDefaultRotateAction&&(e=Math.atan2(a.gesturePoints[0].currentPos.y-a.gesturePoints[1].currentPos.y,a.gesturePoints[0].currentPos.x-a.gesturePoints[1].currentPos.x),a=Math.atan2(a.gesturePoints[0].lastPos.y-a.gesturePoints[1].lastPos.y,a.gesturePoints[0].lastPos.x-a.gesturePoints[1].lastPos.x),this.viewport.setRotation(this.viewport.getRotation()+(e-a)*(180/Math.PI))))}function y(b){var c,d,e;(e=a.now())-this._lastScrollTime>this.minScrollDeltaTime?(this._lastScrollTime=e,c={tracker:b.eventSource,position:b.position,scroll:b.scroll,shift:b.shift,originalEvent:b.originalEvent,preventDefaultAction:!1,preventDefault:!0},this.raiseEvent("canvas-scroll",c),!c.preventDefaultAction&&this.viewport&&(this.viewport.flipped&&(b.position.x=this.viewport.getContainerSize().x-b.position.x),(d=this.gestureSettingsByDeviceType(b.pointerType)).scrollToZoom&&(e=Math.pow(this.zoomPerScroll,b.scroll),this.viewport.zoomBy(e,d.zoomToRefPoint?this.viewport.pointFromPixel(b.position,!0):null),this.viewport.applyConstraints())),b.preventDefault=c.preventDefault):b.preventDefault=!0}function z(a){Q[this.hash].mouseInside=!0,h(this),this.raiseEvent("container-enter",{tracker:a.eventSource,pointerType:a.pointerType,position:a.position,buttons:a.buttons,pointers:a.pointers,insideElementPressed:a.insideElementPressed,buttonDownAny:a.buttonDownAny,originalEvent:a.originalEvent})}function A(a){a.pointers<1&&(Q[this.hash].mouseInside=!1,Q[this.hash].animating||g(this)),this.raiseEvent("container-exit",{tracker:a.eventSource,pointerType:a.pointerType,position:a.position,buttons:a.buttons,pointers:a.pointers,insideElementPressed:a.insideElementPressed,buttonDownAny:a.buttonDownAny,originalEvent:a.originalEvent})}function B(a){!function(a){if(!a._opening&&Q[a.hash]){if(a.autoResize){var c=b(a.container),d=Q[a.hash].prevContainerSize;if(!c.equals(d)){var e=a.viewport;if(a.preserveImageSizeOnResize){var f=d.x/c.x;d=e.getZoom()*f,f=e.getCenter(),e.resize(c,!1),e.zoomTo(d,null,!0),e.panTo(f,!0)}else{var i=e.getBounds();e.resize(c,!0),e.fitBoundsWithConstraints(i,!0)}Q[a.hash].prevContainerSize=c,Q[a.hash].forceRedraw=!0}}i=a.viewport.update(),c=a.world.update()||i,i&&a.raiseEvent("viewport-change"),a.referenceStrip&&(c=a.referenceStrip.update(a.viewport)||c),i=Q[a.hash].animating,!i&&c&&(a.raiseEvent("animation-start"),h(a)),i=i&&!c,i&&(Q[a.hash].animating=!1),(c||i||Q[a.hash].forceRedraw||a.world.needsDraw())&&(!function(a){a.imageLoader.clear(),a.drawer.clear(),a.world.draw(),a.raiseEvent("update-viewport",{})}(a),a._drawOverlays(),a.navigator&&a.navigator.update(a.viewport),Q[a.hash].forceRedraw=!1,c&&a.raiseEvent("animation")),i&&(a.raiseEvent("animation-finish"),Q[a.hash].mouseInside||g(a)),Q[a.hash].animating=c}}(a),a.isOpen()?a._updateRequestId=e(a,B):a._updateRequestId=!1}function C(a,b){return a?a+b:b}function D(){Q[this.hash].lastZoomTime=a.now(),Q[this.hash].zoomFactor=this.zoomPerSecond,Q[this.hash].zooming=!0,G(this)}function E(){Q[this.hash].lastZoomTime=a.now(),Q[this.hash].zoomFactor=1/this.zoomPerSecond,Q[this.hash].zooming=!0,G(this)}function F(){Q[this.hash].zooming=!1}function G(b){a.requestAnimationFrame(a.delegate(b,H))}function H(){var b,c;Q[this.hash].zooming&&this.viewport&&(c=(b=a.now())-Q[this.hash].lastZoomTime,c=Math.pow(Q[this.hash].zoomFactor,c/1e3),this.viewport.zoomBy(c),this.viewport.applyConstraints(),Q[this.hash].lastZoomTime=b,G(this))}function I(){this.viewport&&(Q[this.hash].zooming=!1,this.viewport.zoomBy(+this.zoomPerClick),this.viewport.applyConstraints())}function J(){this.viewport&&(Q[this.hash].zooming=!1,this.viewport.zoomBy(1/this.zoomPerClick),this.viewport.applyConstraints())}function K(){this.buttonGroup&&(this.buttonGroup.emulateEnter(),this.buttonGroup.emulateLeave())}function L(){this.viewport&&this.viewport.goHome()}function M(){this.isFullPage()&&!a.isFullScreen()?this.setFullPage(!1):this.setFullScreen(!this.isFullPage()),this.buttonGroup&&this.buttonGroup.emulateLeave(),this.fullPageButton.element.focus(),this.viewport&&this.viewport.applyConstraints()}function N(){if(this.viewport){var b=this.viewport.getRotation();b=this.viewport.flipped?a.positiveModulo(b+this.rotationIncrement,360):a.positiveModulo(b-this.rotationIncrement,360),this.viewport.setRotation(b)}}function O(){if(this.viewport){var b=this.viewport.getRotation();b=this.viewport.flipped?a.positiveModulo(b-this.rotationIncrement,360):a.positiveModulo(b+this.rotationIncrement,360),this.viewport.setRotation(b)}}function P(){this.viewport.toggleFlip()}var Q={},R=1;a.Viewer=function(c){var d,f=arguments,h=this;if((c=a.isPlainObject(c)?c:{id:f[0],xmlPath:1<f.length?f[1]:void 0,prefixUrl:2<f.length?f[2]:void 0,controls:3<f.length?f[3]:void 0,overlays:4<f.length?f[4]:void 0}).config&&(a.extend(!0,c,c.config),delete c.config),a.extend(!0,this,{id:c.id,hash:c.hash||R++,initialPage:0,element:null,container:null,canvas:null,overlays:[],overlaysContainer:null,previousBody:[],customControls:[],source:null,drawer:null,world:null,viewport:null,navigator:null,collectionViewport:null,collectionDrawer:null,navImages:null,buttons:null,profiler:null},a.DEFAULT_SETTINGS,c),void 0===this.hash)throw new Error("A hash must be defined, either by specifying options.id or options.hash.");for(void 0!==Q[this.hash]&&a.console.warn("Hash "+this.hash+" has already been used."),Q[this.hash]={fsBoundsDelta:new a.Point(1,1),prevContainerSize:null,animating:!1,forceRedraw:!1,mouseInside:!1,group:null,zooming:!1,zoomFactor:null,lastZoomTime:null,fullPage:!1,onfullscreenchange:null},this._sequenceIndex=0,this._firstOpen=!0,this._updateRequestId=null,this._loadQueue=[],this.currentOverlays=[],this._updatePixelDensityRatioBind=null,this._lastScrollTime=a.now(),a.EventSource.call(this),this.addHandler("open-failed",function(b){b=a.getString("Errors.OpenFailed",b.eventSource,b.message),h._showMessage(b)}),a.ControlDock.call(this,c),this.xmlPath&&(this.tileSources=[this.xmlPath]),this.element=this.element||document.getElementById(this.id),this.canvas=a.makeNeutralElement("div"),this.canvas.className="openseadragon-canvas",function(a){a.width="100%",a.height="100%",a.overflow="hidden",a.position="absolute",a.top="0px",a.left="0px"}(this.canvas.style),a.setElementTouchActionNone(this.canvas),""!==c.tabIndex&&(this.canvas.tabIndex=void 0===c.tabIndex?0:c.tabIndex),this.container.className="openseadragon-container",function(a){a.width="100%",a.height="100%",a.position="relative",a.overflow="hidden",a.left="0px",a.top="0px",a.textAlign="left"}(this.container.style),a.setElementTouchActionNone(this.container),this.container.insertBefore(this.canvas,this.container.firstChild),this.element.appendChild(this.container),this.bodyWidth=document.body.style.width,this.bodyHeight=document.body.style.height,this.bodyOverflow=document.body.style.overflow,this.docOverflow=document.documentElement.style.overflow,this.innerTracker=new a.MouseTracker({userData:"Viewer.innerTracker",element:this.canvas,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,contextMenuHandler:a.delegate(this,k),keyDownHandler:a.delegate(this,l),keyHandler:a.delegate(this,m),clickHandler:a.delegate(this,n),dblClickHandler:a.delegate(this,o),dragHandler:a.delegate(this,p),dragEndHandler:a.delegate(this,q),enterHandler:a.delegate(this,r),leaveHandler:a.delegate(this,s),pressHandler:a.delegate(this,t),releaseHandler:a.delegate(this,u),nonPrimaryPressHandler:a.delegate(this,v),nonPrimaryReleaseHandler:a.delegate(this,w),scrollHandler:a.delegate(this,y),pinchHandler:a.delegate(this,x)}),this.outerTracker=new a.MouseTracker({userData:"Viewer.outerTracker",element:this.container,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,enterHandler:a.delegate(this,z),leaveHandler:a.delegate(this,A)}),this.toolbar&&(this.toolbar=new a.ControlDock({element:this.toolbar})),this.bindStandardControls(),Q[this.hash].prevContainerSize=b(this.container),this.world=new a.World({viewer:this}),this.world.addHandler("add-item",function(a){h.source=h.world.getItemAt(0).source,Q[h.hash].forceRedraw=!0,h._updateRequestId||(h._updateRequestId=e(h,B))}),this.world.addHandler("remove-item",function(a){h.world.getItemCount()?h.source=h.world.getItemAt(0).source:h.source=null,Q[h.hash].forceRedraw=!0}),this.world.addHandler("metrics-change",function(a){h.viewport&&h.viewport._setContentBounds(h.world.getHomeBounds(),h.world.getContentFactor())}),this.world.addHandler("item-index-change",function(a){h.source=h.world.getItemAt(0).source}),this.viewport=new a.Viewport({containerSize:Q[this.hash].prevContainerSize,springStiffness:this.springStiffness,animationTime:this.animationTime,minZoomImageRatio:this.minZoomImageRatio,maxZoomPixelRatio:this.maxZoomPixelRatio,visibilityRatio:this.visibilityRatio,wrapHorizontal:this.wrapHorizontal,wrapVertical:this.wrapVertical,defaultZoomLevel:this.defaultZoomLevel,minZoomLevel:this.minZoomLevel,maxZoomLevel:this.maxZoomLevel,viewer:this,degrees:this.degrees,flipped:this.flipped,navigatorRotate:this.navigatorRotate,homeFillsViewer:this.homeFillsViewer,margins:this.viewportMargins,silenceMultiImageWarnings:this.silenceMultiImageWarnings}),this.viewport._setContentBounds(this.world.getHomeBounds(),this.world.getContentFactor()),this.imageLoader=new a.ImageLoader({jobLimit:this.imageLoaderLimit,timeout:c.timeout}),this.tileCache=new a.TileCache({maxImageCacheCount:this.maxImageCacheCount}),this.drawer=new a.Drawer({viewer:this,viewport:this.viewport,element:this.canvas,debugGridColor:this.debugGridColor}),this.overlaysContainer=a.makeNeutralElement("div"),this.canvas.appendChild(this.overlaysContainer),this.drawer.canRotate()||(this.rotateLeft&&(d=this.buttonGroup.buttons.indexOf(this.rotateLeft),this.buttonGroup.buttons.splice(d,1),
this.buttonGroup.element.removeChild(this.rotateLeft.element)),this.rotateRight&&(d=this.buttonGroup.buttons.indexOf(this.rotateRight),this.buttonGroup.buttons.splice(d,1),this.buttonGroup.element.removeChild(this.rotateRight.element))),this._addUpdatePixelDensityRatioEvent(),this.showNavigator&&(this.navigator=new a.Navigator({id:this.navigatorId,position:this.navigatorPosition,sizeRatio:this.navigatorSizeRatio,maintainSizeRatio:this.navigatorMaintainSizeRatio,top:this.navigatorTop,left:this.navigatorLeft,width:this.navigatorWidth,height:this.navigatorHeight,autoResize:this.navigatorAutoResize,autoFade:this.navigatorAutoFade,prefixUrl:this.prefixUrl,viewer:this,navigatorRotate:this.navigatorRotate,background:this.navigatorBackground,opacity:this.navigatorOpacity,borderColor:this.navigatorBorderColor,displayRegionColor:this.navigatorDisplayRegionColor,crossOriginPolicy:this.crossOriginPolicy})),this.sequenceMode&&this.bindSequenceControls(),this.tileSources&&this.open(this.tileSources),d=0;d<this.customControls.length;d++)this.addControl(this.customControls[d].id,{anchor:this.customControls[d].anchor});a.requestAnimationFrame(function(){g(h)}),void 0===this.imageSmoothingEnabled||this.imageSmoothingEnabled||this.drawer.setImageSmoothingEnabled(this.imageSmoothingEnabled),a._viewers.set(this.element,this)},a.extend(a.Viewer.prototype,a.EventSource.prototype,a.ControlDock.prototype,{isOpen:function(){return!!this.world.getItemCount()},openDzi:function(b){return a.console.error("[Viewer.openDzi] this function is deprecated; use Viewer.open() instead."),this.open(b)},openTileSource:function(b){return a.console.error("[Viewer.openTileSource] this function is deprecated; use Viewer.open() instead."),this.open(b)},get buttons(){return a.console.warn("Viewer.buttons is deprecated; Please use Viewer.buttonGroup"),this.buttonGroup},open:function(b,d){var e=this;if(this.close(),!b)return this;if(this.sequenceMode&&a.isArray(b))return this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),void 0===d||isNaN(d)||(this.initialPage=d),this.tileSources=b,this._sequenceIndex=Math.max(0,Math.min(this.tileSources.length-1,this.initialPage)),this.tileSources.length&&(this.open(this.tileSources[this._sequenceIndex]),this.showReferenceStrip&&this.addReferenceStrip()),this._updateSequenceButtons(this._sequenceIndex),this;if(!(b=a.isArray(b)?b:[b]).length)return this;this._opening=!0;for(var f,g=b.length,h=0,i=0,j=function(){if(h+i===g)if(h){!e._firstOpen&&e.preserveViewport||(e.viewport.goHome(!0),e.viewport.update()),e._firstOpen=!1;var a=b[0];if(a.tileSource&&(a=a.tileSource),e.overlays&&!e.preserveOverlays)for(var d=0;d<e.overlays.length;d++)e.currentOverlays[d]=c(e,e.overlays[d]);e._drawOverlays(),e._opening=!1,e.raiseEvent("open",{source:a})}else e._opening=!1,e.raiseEvent("open-failed",f)},k=0;k<b.length;k++)!function(b){void 0!==(b=a.isPlainObject(b)&&b.tileSource?b:{tileSource:b}).index&&(a.console.error("[Viewer.open] setting indexes here is not supported; use addTiledImage instead"),delete b.index),void 0===b.collectionImmediately&&(b.collectionImmediately=!0);var c=b.success;b.success=function(a){if(h++,b.tileSource.overlays)for(var d=0;d<b.tileSource.overlays.length;d++)e.addOverlay(b.tileSource.overlays[d]);c&&c(a),j()};var d=b.error;b.error=function(a){i++,f=f||a,d&&d(a),j()},e.addTiledImage(b)}(b[k]);return this},close:function(){return Q[this.hash]?(this._opening=!1,this.navigator&&this.navigator.close(),this.preserveOverlays||(this.clearOverlays(),this.overlaysContainer.innerHTML=""),Q[this.hash].animating=!1,this.world.removeAll(),this.imageLoader.clear(),this.raiseEvent("close"),this):this},destroy:function(){if(Q[this.hash]){if(this._removeUpdatePixelDensityRatioEvent(),this.close(),this.clearOverlays(),this.overlaysContainer.innerHTML="",this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),null!==this._updateRequestId&&(a.cancelAnimationFrame(this._updateRequestId),this._updateRequestId=null),this.drawer&&this.drawer.destroy(),this.navigator&&(this.navigator.destroy(),Q[this.navigator.hash]=null,delete Q[this.navigator.hash],this.navigator=null),this.removeAllHandlers(),this.buttonGroup)this.buttonGroup.destroy();else if(this.customButtons)for(;this.customButtons.length;)this.customButtons.pop().destroy();if(this.paging&&this.paging.destroy(),this.element)for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.container.onsubmit=null,this.clearControls(),this.innerTracker&&this.innerTracker.destroy(),this.outerTracker&&this.outerTracker.destroy(),Q[this.hash]=null,delete Q[this.hash],this.canvas=null,this.container=null,a._viewers.delete(this.element),this.element=null}},isMouseNavEnabled:function(){return this.innerTracker.isTracking()},setMouseNavEnabled:function(a){return this.innerTracker.setTracking(a),this.outerTracker.setTracking(a),this.raiseEvent("mouse-enabled",{enabled:a}),this},areControlsEnabled:function(){var a,b=this.controls.length;for(a=0;a<this.controls.length;a++)b=b&&this.controls[a].isVisible();return b},setControlsEnabled:function(a){return(a?h:g)(this),this.raiseEvent("controls-enabled",{enabled:a}),this},setDebugMode:function(a){for(var b=0;b<this.world.getItemCount();b++)this.world.getItemAt(b).debugMode=a;this.debugMode=a,this.forceRedraw()},isFullPage:function(){return Q[this.hash].fullPage},setFullPage:function(b){var c,d,e=document.body,f=e.style,g=document.documentElement.style,h=this;if(b===this.isFullPage())return this;var i={fullPage:b,preventDefaultAction:!1};if(this.raiseEvent("pre-full-page",i),i.preventDefaultAction)return this;if(b){for(this.elementSize=a.getElementSize(this.element),this.pageScroll=a.getPageScroll(),this.elementMargin=this.element.style.margin,this.element.style.margin="0",this.elementPadding=this.element.style.padding,this.element.style.padding="0",this.bodyMargin=f.margin,this.docMargin=g.margin,f.margin="0",g.margin="0",this.bodyPadding=f.padding,this.docPadding=g.padding,f.padding="0",g.padding="0",this.bodyWidth=f.width,this.docWidth=g.width,f.width="100%",g.width="100%",this.bodyHeight=f.height,this.docHeight=g.height,f.height="100%",g.height="100%",this.bodyDisplay=f.display,f.display="block",this.previousBody=[],Q[this.hash].prevElementParent=this.element.parentNode,Q[this.hash].prevNextSibling=this.element.nextSibling,Q[this.hash].prevElementWidth=this.element.style.width,Q[this.hash].prevElementHeight=this.element.style.height,c=e.childNodes.length,d=0;d<c;d++)this.previousBody.push(e.childNodes[0]),e.removeChild(e.childNodes[0]);this.toolbar&&this.toolbar.element&&(this.toolbar.parentNode=this.toolbar.element.parentNode,this.toolbar.nextSibling=this.toolbar.element.nextSibling,e.appendChild(this.toolbar.element),a.addClass(this.toolbar.element,"fullpage")),a.addClass(this.element,"fullpage"),e.appendChild(this.element),this.element.style.height="100vh",this.element.style.width="100vw",this.toolbar&&this.toolbar.element&&(this.element.style.height=a.getElementSize(this.element).y-a.getElementSize(this.toolbar.element).y+"px"),Q[this.hash].fullPage=!0,a.delegate(this,z)({})}else{for(this.element.style.margin=this.elementMargin,this.element.style.padding=this.elementPadding,f.margin=this.bodyMargin,g.margin=this.docMargin,f.padding=this.bodyPadding,g.padding=this.docPadding,f.width=this.bodyWidth,g.width=this.docWidth,f.height=this.bodyHeight,g.height=this.docHeight,f.display=this.bodyDisplay,e.removeChild(this.element),c=this.previousBody.length,d=0;d<c;d++)e.appendChild(this.previousBody.shift());a.removeClass(this.element,"fullpage"),Q[this.hash].prevElementParent.insertBefore(this.element,Q[this.hash].prevNextSibling),this.toolbar&&this.toolbar.element&&(e.removeChild(this.toolbar.element),a.removeClass(this.toolbar.element,"fullpage"),this.toolbar.parentNode.insertBefore(this.toolbar.element,this.toolbar.nextSibling),delete this.toolbar.parentNode,delete this.toolbar.nextSibling),this.element.style.width=Q[this.hash].prevElementWidth,this.element.style.height=Q[this.hash].prevElementHeight;var j=0,k=function(){a.setPageScroll(h.pageScroll);var b=a.getPageScroll();++j<10&&(b.x!==h.pageScroll.x||b.y!==h.pageScroll.y)&&a.requestAnimationFrame(k)};a.requestAnimationFrame(k),Q[this.hash].fullPage=!1,a.delegate(this,A)({})}return this.navigator&&this.viewport&&this.navigator.update(this.viewport),this.raiseEvent("full-page",{fullPage:b}),this},setFullScreen:function(b){var c=this;if(!a.supportsFullScreen)return this.setFullPage(b);if(a.isFullScreen()===b)return this;var d={fullScreen:b,preventDefaultAction:!1};if(this.raiseEvent("pre-full-screen",d),d.preventDefaultAction)return this;if(b){if(this.setFullPage(!0),!this.isFullPage())return this;this.fullPageStyleWidth=this.element.style.width,this.fullPageStyleHeight=this.element.style.height,this.element.style.width="100%",this.element.style.height="100%";var e=function(){var b=a.isFullScreen();b||(a.removeEvent(document,a.fullScreenEventName,e),a.removeEvent(document,a.fullScreenErrorEventName,e),c.setFullPage(!1),c.isFullPage()&&(c.element.style.width=c.fullPageStyleWidth,c.element.style.height=c.fullPageStyleHeight)),c.navigator&&c.viewport&&setTimeout(function(){c.navigator.update(c.viewport)}),c.raiseEvent("full-screen",{fullScreen:b})};a.addEvent(document,a.fullScreenEventName,e),a.addEvent(document,a.fullScreenErrorEventName,e),a.requestFullScreen(document.body)}else a.exitFullScreen();return this},isVisible:function(){return"hidden"!==this.container.style.visibility},isFullScreen:function(){return a.isFullScreen()&&this.isFullPage()},setVisible:function(a){return this.container.style.visibility=a?"":"hidden",this.raiseEvent("visible",{visible:a}),this},addTiledImage:function(b){function c(a){for(var c=0;c<f._loadQueue.length;c++)if(f._loadQueue[c]===g){f._loadQueue.splice(c,1);break}0===f._loadQueue.length&&d(g),f.raiseEvent("add-item-failed",a),b.error&&b.error(a)}function d(a){f.collectionMode&&(f.world.arrange({immediately:a.options.collectionImmediately,rows:f.collectionRows,columns:f.collectionColumns,layout:f.collectionLayout,tileSize:f.collectionTileSize,tileMargin:f.collectionTileMargin}),f.world.setAutoRefigureSizes(!0))}function e(){for(var b,c;f._loadQueue.length&&(b=f._loadQueue[0]).tileSource;){if(f._loadQueue.splice(0,1),b.options.replace){var e=f.world.getIndexOfItem(b.options.replaceItem);-1!==e&&(b.options.index=e),f.world.removeItem(b.options.replaceItem)}c=new a.TiledImage({viewer:f,source:b.tileSource,viewport:f.viewport,drawer:f.drawer,tileCache:f.tileCache,imageLoader:f.imageLoader,x:b.options.x,y:b.options.y,width:b.options.width,height:b.options.height,fitBounds:b.options.fitBounds,fitBoundsPlacement:b.options.fitBoundsPlacement,clip:b.options.clip,placeholderFillStyle:b.options.placeholderFillStyle,opacity:b.options.opacity,preload:b.options.preload,degrees:b.options.degrees,flipped:b.options.flipped,compositeOperation:b.options.compositeOperation,springStiffness:f.springStiffness,animationTime:f.animationTime,minZoomImageRatio:f.minZoomImageRatio,wrapHorizontal:f.wrapHorizontal,wrapVertical:f.wrapVertical,immediateRender:f.immediateRender,blendTime:f.blendTime,alwaysBlend:f.alwaysBlend,minPixelRatio:f.minPixelRatio,smoothTileEdgesMinZoom:f.smoothTileEdgesMinZoom,iOSDevice:f.iOSDevice,crossOriginPolicy:b.options.crossOriginPolicy,ajaxWithCredentials:b.options.ajaxWithCredentials,loadTilesWithAjax:b.options.loadTilesWithAjax,ajaxHeaders:b.options.ajaxHeaders,debugMode:f.debugMode,subPixelRoundingForTransparency:f.subPixelRoundingForTransparency}),f.collectionMode&&f.world.setAutoRefigureSizes(!1),f.navigator&&(e=a.extend({},b.options,{replace:!1,originalTiledImage:c,tileSource:b.tileSource}),f.navigator.addTiledImage(e)),f.world.addItem(c,{index:b.options.index}),0===f._loadQueue.length&&d(b),1!==f.world.getItemCount()||f.preserveViewport||f.viewport.goHome(!0),b.options.success&&b.options.success({item:c})}}a.console.assert(b,"[Viewer.addTiledImage] options is required"),a.console.assert(b.tileSource,"[Viewer.addTiledImage] options.tileSource is required"),a.console.assert(!b.replace||-1<b.index&&b.index<this.world.getItemCount(),"[Viewer.addTiledImage] if options.replace is used, options.index must be a valid index in Viewer.world");var f=this;b.replace&&(b.replaceItem=f.world.getItemAt(b.index)),this._hideMessage(),void 0===b.placeholderFillStyle&&(b.placeholderFillStyle=this.placeholderFillStyle),void 0===b.opacity&&(b.opacity=this.opacity),void 0===b.preload&&(b.preload=this.preload),void 0===b.compositeOperation&&(b.compositeOperation=this.compositeOperation),void 0===b.crossOriginPolicy&&(b.crossOriginPolicy=(void 0!==b.tileSource.crossOriginPolicy?b.tileSource:this).crossOriginPolicy),void 0===b.ajaxWithCredentials&&(b.ajaxWithCredentials=this.ajaxWithCredentials),void 0===b.loadTilesWithAjax&&(b.loadTilesWithAjax=this.loadTilesWithAjax),void 0===b.ajaxHeaders||null===b.ajaxHeaders?b.ajaxHeaders=this.ajaxHeaders:a.isPlainObject(b.ajaxHeaders)&&a.isPlainObject(this.ajaxHeaders)&&(b.ajaxHeaders=a.extend({},this.ajaxHeaders,b.ajaxHeaders));var g={options:b};a.isArray(b.tileSource)?setTimeout(function(){c({message:"[Viewer.addTiledImage] Sequences can not be added; add them one at a time instead.",source:b.tileSource,options:b})}):(this._loadQueue.push(g),function(b,c,d,e,f){function g(a,b){a.ready?e(a):(a.addHandler("ready",function(){e(a)}),a.addHandler("open-failed",function(a){f({message:a.message,source:b})}))}var h=b;if("string"===a.type(c))if(c.match(/^\s*<.*>\s*$/))c=a.parseXml(c);else if(c.match(/^\s*[{[].*[}\]]\s*$/))try{var i=a.parseJSON(c);c=i}catch(i){}setTimeout(function(){if("string"===a.type(c))(c=new a.TileSource({url:c,crossOriginPolicy:(void 0!==d.crossOriginPolicy?d:b).crossOriginPolicy,ajaxWithCredentials:b.ajaxWithCredentials,ajaxHeaders:d.ajaxHeaders||b.ajaxHeaders,splitHashDataForPost:b.splitHashDataForPost,useCanvas:b.useCanvas,success:function(a){e(a.tileSource)}})).addHandler("open-failed",function(a){f(a)});else if(a.isPlainObject(c)||c.nodeType)if(void 0!==c.crossOriginPolicy||void 0===d.crossOriginPolicy&&void 0===b.crossOriginPolicy||(c.crossOriginPolicy=(void 0!==d.crossOriginPolicy?d:b).crossOriginPolicy),void 0===c.ajaxWithCredentials&&(c.ajaxWithCredentials=b.ajaxWithCredentials),void 0===c.useCanvas&&(c.useCanvas=b.useCanvas),a.isFunction(c.getTileUrl)){var i=new a.TileSource(c);i.getTileUrl=c.getTileUrl,e(i)}else{var j=a.TileSource.determineType(h,c);j?(i=j.prototype.configure.apply(h,[c]),g(new j(i),c)):f({message:"Unable to load TileSource",source:c})}else g(c,c)})}(this,b.tileSource,b,function(a){g.tileSource=a,e()},function(a){a.options=b,c(a),e()}))},addSimpleImage:function(b){a.console.assert(b,"[Viewer.addSimpleImage] options is required"),a.console.assert(b.url,"[Viewer.addSimpleImage] options.url is required"),b=a.extend({},b,{tileSource:{type:"image",url:b.url}}),delete b.url,this.addTiledImage(b)},addLayer:function(b){var c=this;a.console.error("[Viewer.addLayer] this function is deprecated; use Viewer.addTiledImage() instead.");var d=a.extend({},b,{success:function(a){c.raiseEvent("add-layer",{options:b,drawer:a.item})},error:function(a){c.raiseEvent("add-layer-failed",a)}});return this.addTiledImage(d),this},getLayerAtLevel:function(b){return a.console.error("[Viewer.getLayerAtLevel] this function is deprecated; use World.getItemAt() instead."),this.world.getItemAt(b)},getLevelOfLayer:function(b){return a.console.error("[Viewer.getLevelOfLayer] this function is deprecated; use World.getIndexOfItem() instead."),this.world.getIndexOfItem(b)},getLayersCount:function(){return a.console.error("[Viewer.getLayersCount] this function is deprecated; use World.getItemCount() instead."),this.world.getItemCount()},setLayerLevel:function(b,c){return a.console.error("[Viewer.setLayerLevel] this function is deprecated; use World.setItemIndex() instead."),this.world.setItemIndex(b,c)},removeLayer:function(b){return a.console.error("[Viewer.removeLayer] this function is deprecated; use World.removeItem() instead."),this.world.removeItem(b)},forceRedraw:function(){return Q[this.hash].forceRedraw=!0,this},bindSequenceControls:function(){var b=a.delegate(this,i),c=a.delegate(this,j),d=a.delegate(this,this.goToNextPage),e=a.delegate(this,this.goToPreviousPage),f=this.navImages,g=!0;return this.showSequenceControl&&((this.previousButton||this.nextButton)&&(g=!1),this.previousButton=new a.Button({element:this.previousButton?a.getElement(this.previousButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:a.getString("Tooltips.PreviousPage"),srcRest:C(this.prefixUrl,f.previous.REST),srcGroup:C(this.prefixUrl,f.previous.GROUP),srcHover:C(this.prefixUrl,f.previous.HOVER),srcDown:C(this.prefixUrl,f.previous.DOWN),onRelease:e,onFocus:b,onBlur:c}),this.nextButton=new a.Button({element:this.nextButton?a.getElement(this.nextButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:a.getString("Tooltips.NextPage"),srcRest:C(this.prefixUrl,f.next.REST),srcGroup:C(this.prefixUrl,f.next.GROUP),srcHover:C(this.prefixUrl,f.next.HOVER),srcDown:C(this.prefixUrl,f.next.DOWN),onRelease:d,onFocus:b,onBlur:c}),this.navPrevNextWrap||this.previousButton.disable(),this.tileSources&&this.tileSources.length||this.nextButton.disable(),g&&(this.paging=new a.ButtonGroup({buttons:[this.previousButton,this.nextButton],clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.pagingControl=this.paging.element,this.toolbar?this.toolbar.addControl(this.pagingControl,{anchor:a.ControlAnchor.BOTTOM_RIGHT}):this.addControl(this.pagingControl,{anchor:this.sequenceControlAnchor||a.ControlAnchor.TOP_LEFT}))),this},bindStandardControls:function(){var b=a.delegate(this,D),c=a.delegate(this,F),d=a.delegate(this,I),e=a.delegate(this,E),f=a.delegate(this,J),g=a.delegate(this,L),h=a.delegate(this,M),k=a.delegate(this,N),l=a.delegate(this,O),m=a.delegate(this,P),n=a.delegate(this,i),o=a.delegate(this,j),p=this.navImages,q=[],r=!0;return this.showNavigationControl&&((this.zoomInButton||this.zoomOutButton||this.homeButton||this.fullPageButton||this.rotateLeftButton||this.rotateRightButton||this.flipButton)&&(r=!1),this.showZoomControl&&(q.push(this.zoomInButton=new a.Button({element:this.zoomInButton?a.getElement(this.zoomInButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:a.getString("Tooltips.ZoomIn"),srcRest:C(this.prefixUrl,p.zoomIn.REST),srcGroup:C(this.prefixUrl,p.zoomIn.GROUP),srcHover:C(this.prefixUrl,p.zoomIn.HOVER),srcDown:C(this.prefixUrl,p.zoomIn.DOWN),onPress:b,onRelease:c,onClick:d,onEnter:b,onExit:c,onFocus:n,onBlur:o})),q.push(this.zoomOutButton=new a.Button({element:this.zoomOutButton?a.getElement(this.zoomOutButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:a.getString("Tooltips.ZoomOut"),srcRest:C(this.prefixUrl,p.zoomOut.REST),srcGroup:C(this.prefixUrl,p.zoomOut.GROUP),srcHover:C(this.prefixUrl,p.zoomOut.HOVER),srcDown:C(this.prefixUrl,p.zoomOut.DOWN),onPress:e,onRelease:c,onClick:f,onEnter:e,onExit:c,onFocus:n,onBlur:o}))),this.showHomeControl&&q.push(this.homeButton=new a.Button({element:this.homeButton?a.getElement(this.homeButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:a.getString("Tooltips.Home"),srcRest:C(this.prefixUrl,p.home.REST),srcGroup:C(this.prefixUrl,p.home.GROUP),srcHover:C(this.prefixUrl,p.home.HOVER),srcDown:C(this.prefixUrl,p.home.DOWN),onRelease:g,onFocus:n,onBlur:o})),this.showFullPageControl&&q.push(this.fullPageButton=new a.Button({element:this.fullPageButton?a.getElement(this.fullPageButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:a.getString("Tooltips.FullPage"),srcRest:C(this.prefixUrl,p.fullpage.REST),srcGroup:C(this.prefixUrl,p.fullpage.GROUP),srcHover:C(this.prefixUrl,p.fullpage.HOVER),srcDown:C(this.prefixUrl,p.fullpage.DOWN),onRelease:h,onFocus:n,onBlur:o})),this.showRotationControl&&(q.push(this.rotateLeftButton=new a.Button({element:this.rotateLeftButton?a.getElement(this.rotateLeftButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:a.getString("Tooltips.RotateLeft"),srcRest:C(this.prefixUrl,p.rotateleft.REST),srcGroup:C(this.prefixUrl,p.rotateleft.GROUP),srcHover:C(this.prefixUrl,p.rotateleft.HOVER),srcDown:C(this.prefixUrl,p.rotateleft.DOWN),onRelease:k,onFocus:n,onBlur:o})),q.push(this.rotateRightButton=new a.Button({element:this.rotateRightButton?a.getElement(this.rotateRightButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:a.getString("Tooltips.RotateRight"),srcRest:C(this.prefixUrl,p.rotateright.REST),srcGroup:C(this.prefixUrl,p.rotateright.GROUP),srcHover:C(this.prefixUrl,p.rotateright.HOVER),srcDown:C(this.prefixUrl,p.rotateright.DOWN),onRelease:l,onFocus:n,onBlur:o}))),this.showFlipControl&&q.push(this.flipButton=new a.Button({element:this.flipButton?a.getElement(this.flipButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:a.getString("Tooltips.Flip"),srcRest:C(this.prefixUrl,p.flip.REST),srcGroup:C(this.prefixUrl,p.flip.GROUP),srcHover:C(this.prefixUrl,p.flip.HOVER),srcDown:C(this.prefixUrl,p.flip.DOWN),onRelease:m,onFocus:n,onBlur:o})),r?(this.buttonGroup=new a.ButtonGroup({buttons:q,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.navControl=this.buttonGroup.element,this.addHandler("open",a.delegate(this,K)),(this.toolbar||this).addControl(this.navControl,{anchor:this.navigationControlAnchor||a.ControlAnchor.TOP_LEFT})):this.customButtons=q),this},currentPage:function(){return this._sequenceIndex},goToPage:function(a){return this.tileSources&&0<=a&&a<this.tileSources.length&&(this._sequenceIndex=a,this._updateSequenceButtons(a),this.open(this.tileSources[a]),this.referenceStrip&&this.referenceStrip.setFocus(a),this.raiseEvent("page",{page:a})),this},addOverlay:function(b,e,f,g){return f=a.isPlainObject(b)?b:{element:b,location:e,placement:f,onDraw:g},b=a.getElement(f.element),0<=d(this.currentOverlays,b)?this:(g=c(this,f),this.currentOverlays.push(g),g.drawHTML(this.overlaysContainer,this.viewport),this.raiseEvent("add-overlay",{element:b,location:f.location,placement:f.placement}),this)},updateOverlay:function(b,c,e){var f;return b=a.getElement(b),0<=(f=d(this.currentOverlays,b))&&(this.currentOverlays[f].update(c,e),Q[this.hash].forceRedraw=!0,this.raiseEvent("update-overlay",{element:b,location:c,placement:e})),this},removeOverlay:function(b){var c;return b=a.getElement(b),0<=(c=d(this.currentOverlays,b))&&(this.currentOverlays[c].destroy(),this.currentOverlays.splice(c,1),Q[this.hash].forceRedraw=!0,this.raiseEvent("remove-overlay",{element:b})),this},clearOverlays:function(){for(;0<this.currentOverlays.length;)this.currentOverlays.pop().destroy();return Q[this.hash].forceRedraw=!0,this.raiseEvent("clear-overlay",{}),this},getOverlayById:function(b){return b=a.getElement(b),0<=(b=d(this.currentOverlays,b))?this.currentOverlays[b]:null},_updateSequenceButtons:function(a){this.nextButton&&(this.tileSources&&this.tileSources.length-1!==a?this.nextButton.enable():this.navPrevNextWrap||this.nextButton.disable()),this.previousButton&&(0<a?this.previousButton.enable():this.navPrevNextWrap||this.previousButton.disable())},_showMessage:function(b){this._hideMessage();var c=a.makeNeutralElement("div");c.appendChild(document.createTextNode(b)),this.messageDiv=a.makeCenteredNode(c),a.addClass(this.messageDiv,"openseadragon-message"),this.container.appendChild(this.messageDiv)},_hideMessage:function(){var a=this.messageDiv;a&&(a.parentNode.removeChild(a),delete this.messageDiv)},gestureSettingsByDeviceType:function(a){switch(a){case"mouse":return this.gestureSettingsMouse;case"touch":return this.gestureSettingsTouch;case"pen":return this.gestureSettingsPen;default:return this.gestureSettingsUnknown}},_drawOverlays:function(){var a,b=this.currentOverlays.length;for(a=0;a<b;a++)this.currentOverlays[a].drawHTML(this.overlaysContainer,this.viewport)},_cancelPendingImages:function(){this._loadQueue=[]},removeReferenceStrip:function(){this.showReferenceStrip=!1,this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null)},addReferenceStrip:function(){this.showReferenceStrip=!0,this.sequenceMode?!this.referenceStrip&&this.tileSources.length&&1<this.tileSources.length&&(this.referenceStrip=new a.ReferenceStrip({id:this.referenceStripElement,position:this.referenceStripPosition,sizeRatio:this.referenceStripSizeRatio,scroll:this.referenceStripScroll,height:this.referenceStripHeight,width:this.referenceStripWidth,tileSources:this.tileSources,prefixUrl:this.prefixUrl,useCanvas:this.useCanvas,viewer:this}),this.referenceStrip.setFocus(this._sequenceIndex)):a.console.warn('Attempting to display a reference strip while "sequenceMode" is off.')},_addUpdatePixelDensityRatioEvent:function(){this._updatePixelDensityRatioBind=this._updatePixelDensityRatio.bind(this),a.addEvent(window,"resize",this._updatePixelDensityRatioBind)},_removeUpdatePixelDensityRatioEvent:function(){a.removeEvent(window,"resize",this._updatePixelDensityRatioBind)},_updatePixelDensityRatio:function(){var b=a.pixelDensityRatio,c=a.getCurrentPixelDensityRatio();b!==c&&(a.pixelDensityRatio=c,this.world.resetItems(),this.forceRedraw())},goToPreviousPage:function(){var a=this._sequenceIndex-1;this.navPrevNextWrap&&a<0&&(a+=this.tileSources.length),this.goToPage(a)},goToNextPage:function(){var a=this._sequenceIndex+1;this.navPrevNextWrap&&a>=this.tileSources.length&&(a=0),this.goToPage(a)},isAnimating:function(){return Q[this.hash].animating}})}(OpenSeadragon),function(a){function b(a){var b={tracker:a.eventSource,position:a.position,quick:a.quick,shift:a.shift,originalEvent:a.originalEvent,preventDefaultAction:!1};this.viewer.raiseEvent("navigator-click",b),!b.preventDefaultAction&&a.quick&&this.viewer.viewport&&(this.panVertical||this.panHorizontal)&&(this.viewer.viewport.flipped&&(a.position.x=this.viewport.getContainerSize().x-a.position.x),a=this.viewport.pointFromPixel(a.position),this.panVertical?this.panHorizontal||(a.x=this.viewer.viewport.getCenter(!0).x):a.y=this.viewer.viewport.getCenter(!0).y,this.viewer.viewport.panTo(a),this.viewer.viewport.applyConstraints())}function c(a){var b={tracker:a.eventSource,position:a.position,delta:a.delta,speed:a.speed,direction:a.direction,shift:a.shift,originalEvent:a.originalEvent,preventDefaultAction:!1};this.viewer.raiseEvent("navigator-drag",b),!b.preventDefaultAction&&this.viewer.viewport&&(this.panHorizontal||(a.delta.x=0),this.panVertical||(a.delta.y=0),this.viewer.viewport.flipped&&(a.delta.x=-a.delta.x),this.viewer.viewport.panBy(this.viewport.deltaPointsFromPixels(a.delta)),this.viewer.constrainDuringPan&&this.viewer.viewport.applyConstraints())}function d(a){a.insideElementPressed&&this.viewer.viewport&&this.viewer.viewport.applyConstraints()}function e(a){var b={tracker:a.eventSource,position:a.position,scroll:a.scroll,shift:a.shift,originalEvent:a.originalEvent,preventDefault:a.preventDefault};this.viewer.raiseEvent("navigator-scroll",b),a.preventDefault=b.preventDefault}function f(a,b){g(a,"rotate("+b+"deg)")}function g(a,b){a.style.webkitTransform=b,a.style.mozTransform=b,a.style.msTransform=b,a.style.oTransform=b,a.style.transform=b}a.Navigator=function(g){function h(a){f(k.displayRegionContainer,a),f(k.displayRegion,-a),k.viewport.setRotation(a)}var i,j=g.viewer,k=this;g.id?(this.element=document.getElementById(g.id),g.controlOptions={anchor:a.ControlAnchor.NONE,attachToViewer:!1,autoFade:!1}):(g.id="navigator-"+a.now(),this.element=a.makeNeutralElement("div"),g.controlOptions={anchor:a.ControlAnchor.TOP_RIGHT,attachToViewer:!0,autoFade:g.autoFade},g.position&&("BOTTOM_RIGHT"===g.position?g.controlOptions.anchor=a.ControlAnchor.BOTTOM_RIGHT:"BOTTOM_LEFT"===g.position?g.controlOptions.anchor=a.ControlAnchor.BOTTOM_LEFT:"TOP_RIGHT"===g.position?g.controlOptions.anchor=a.ControlAnchor.TOP_RIGHT:"TOP_LEFT"===g.position?g.controlOptions.anchor=a.ControlAnchor.TOP_LEFT:"ABSOLUTE"===g.position&&(g.controlOptions.anchor=a.ControlAnchor.ABSOLUTE,g.controlOptions.top=g.top,g.controlOptions.left=g.left,g.controlOptions.height=g.height,g.controlOptions.width=g.width))),this.element.id=g.id,this.element.className+=" navigator",(g=a.extend(!0,{sizeRatio:a.DEFAULT_SETTINGS.navigatorSizeRatio},g,{element:this.element,tabIndex:-1,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,autoResize:g.autoResize,minZoomImageRatio:1,background:g.background,opacity:g.opacity,borderColor:g.borderColor,displayRegionColor:g.displayRegionColor})).minPixelRatio=this.minPixelRatio=j.minPixelRatio,a.setElementTouchActionNone(this.element),this.borderWidth=2,this.fudge=new a.Point(1,1),this.totalBorderWidths=new a.Point(2*this.borderWidth,2*this.borderWidth).minus(this.fudge),g.controlOptions.anchor!==a.ControlAnchor.NONE&&function(a,b){a.margin="0px",a.border=b+"px solid "+g.borderColor,a.padding="0px",a.background=g.background,a.opacity=g.opacity,a.overflow="hidden"}(this.element.style,this.borderWidth),this.displayRegion=a.makeNeutralElement("div"),this.displayRegion.id=this.element.id+"-displayregion",this.displayRegion.className="displayregion",function(a,b){a.position="relative",a.top="0px",a.left="0px",a.fontSize="0px",a.overflow="hidden",a.border=b+"px solid "+g.displayRegionColor,a.margin="0px",a.padding="0px",a.background="transparent",a.float="left",a.cssFloat="left",a.styleFloat="left",a.zIndex=999999999,a.cursor="default"}(this.displayRegion.style,this.borderWidth),a.setElementPointerEventsNone(this.displayRegion),a.setElementTouchActionNone(this.displayRegion),this.displayRegionContainer=a.makeNeutralElement("div"),this.displayRegionContainer.id=this.element.id+"-displayregioncontainer",this.displayRegionContainer.className="displayregioncontainer",this.displayRegionContainer.style.width="100%",this.displayRegionContainer.style.height="100%",a.setElementPointerEventsNone(this.displayRegionContainer),a.setElementTouchActionNone(this.displayRegionContainer),j.addControl(this.element,g.controlOptions),this._resizeWithViewer=g.controlOptions.anchor!==a.ControlAnchor.ABSOLUTE&&g.controlOptions.anchor!==a.ControlAnchor.NONE,g.width&&g.height?(this.setWidth(g.width),this.setHeight(g.height)):this._resizeWithViewer&&(i=a.getElementSize(j.element),this.element.style.height=Math.round(i.y*g.sizeRatio)+"px",this.element.style.width=Math.round(i.x*g.sizeRatio)+"px",this.oldViewerSize=i,i=a.getElementSize(this.element),this.elementArea=i.x*i.y),this.oldContainerSize=new a.Point(0,0),a.Viewer.apply(this,[g]),this.displayRegionContainer.appendChild(this.displayRegion),this.element.getElementsByTagName("div")[0].appendChild(this.displayRegionContainer),g.navigatorRotate&&(h(g.viewer.viewport?g.viewer.viewport.getRotation():g.viewer.degrees||0),g.viewer.addHandler("rotate",function(a){h(a.degrees)})),this.innerTracker.destroy(),this.innerTracker=new a.MouseTracker({userData:"Navigator.innerTracker",element:this.element,dragHandler:a.delegate(this,c),clickHandler:a.delegate(this,b),releaseHandler:a.delegate(this,d),scrollHandler:a.delegate(this,e),preProcessEventHandler:function(a){"wheel"===a.eventType&&(a.preventDefault=!0)}}),this.outerTracker.userData="Navigator.outerTracker",a.setElementPointerEventsNone(this.canvas),a.setElementPointerEventsNone(this.container),this.addHandler("reset-size",function(){k.viewport&&k.viewport.goHome(!0)}),j.world.addHandler("item-index-change",function(a){window.setTimeout(function(){var b=k.world.getItemAt(a.previousIndex)
;k.world.setItemIndex(b,a.newIndex)},1)}),j.world.addHandler("remove-item",function(a){a=a.item,(a=k._getMatchingItem(a))&&k.world.removeItem(a)}),this.update(j.viewport)},a.extend(a.Navigator.prototype,a.EventSource.prototype,a.Viewer.prototype,{updateSize:function(){if(this.viewport){var b=new a.Point(0===this.container.clientWidth?1:this.container.clientWidth,0===this.container.clientHeight?1:this.container.clientHeight);b.equals(this.oldContainerSize)||(this.viewport.resize(b,!0),this.viewport.goHome(!0),this.oldContainerSize=b,this.drawer.clear(),this.world.draw())}},setWidth:function(a){this.width=a,this.element.style.width="number"==typeof a?a+"px":a,this._resizeWithViewer=!1},setHeight:function(a){this.height=a,this.element.style.height="number"==typeof a?a+"px":a,this._resizeWithViewer=!1},setFlip:function(a){return this.viewport.setFlip(a),this.setDisplayTransform(this.viewer.viewport.getFlip()?"scale(-1,1)":"scale(1,1)"),this},setDisplayTransform:function(a){g(this.displayRegion,a),g(this.canvas,a),g(this.element,a)},update:function(b){var c;if(d=a.getElementSize(this.viewer.element),this._resizeWithViewer&&d.x&&d.y&&!d.equals(this.oldViewerSize)&&(this.oldViewerSize=d,this.maintainSizeRatio||!this.elementArea?(c=d.x*this.sizeRatio,e=d.y*this.sizeRatio):(c=Math.sqrt(this.elementArea*(d.x/d.y)),e=this.elementArea/c),this.element.style.width=Math.round(c)+"px",this.element.style.height=Math.round(e)+"px",this.elementArea||(this.elementArea=c*e),this.updateSize()),b&&this.viewport){d=b.getBoundsNoRotate(!0),c=this.viewport.pixelFromPointNoRotate(d.getTopLeft(),!1),e=this.viewport.pixelFromPointNoRotate(d.getBottomRight(),!1).minus(this.totalBorderWidths),b=this.displayRegion.style,b.display=this.world.getItemCount()?"block":"none",b.top=Math.round(c.y)+"px",b.left=Math.round(c.x)+"px";var d=Math.abs(c.x-e.x),e=Math.abs(c.y-e.y);b.width=Math.round(Math.max(d,0))+"px",b.height=Math.round(Math.max(e,0))+"px"}},addTiledImage:function(b){var c=this,d=b.originalTiledImage;return delete b.original,b=a.extend({},b,{success:function(a){function b(){c._matchBounds(e,d)}var e=a.item;e._originalForNavigator=d,c._matchBounds(e,d,!0),c._matchOpacity(e,d),c._matchCompositeOperation(e,d),d.addHandler("bounds-change",b),d.addHandler("clip-change",b),d.addHandler("opacity-change",function(){c._matchOpacity(e,d)}),d.addHandler("composite-operation-change",function(){c._matchCompositeOperation(e,d)})}}),a.Viewer.prototype.addTiledImage.apply(this,[b])},destroy:function(){return a.Viewer.prototype.destroy.apply(this)},_getMatchingItem:function(a){for(var b,c=this.world.getItemCount(),d=0;d<c;d++)if((b=this.world.getItemAt(d))._originalForNavigator===a)return b;return null},_matchBounds:function(a,b,c){var d=b.getBoundsNoRotate();a.setPosition(d.getTopLeft(),c),a.setWidth(d.width,c),a.setRotation(b.getRotation(),c),a.setClip(b.getClip()),a.setFlip(b.getFlip())},_matchOpacity:function(a,b){a.setOpacity(b.opacity)},_matchCompositeOperation:function(a,b){a.setCompositeOperation(b.compositeOperation)}})}(OpenSeadragon),function(a){var b={Errors:{Dzc:"Sorry, we don't support Deep Zoom Collections!",Dzi:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",Xml:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",ImageFormat:"Sorry, we don't support {0}-based Deep Zoom Images.",Security:"It looks like a security restriction stopped us from loading this Deep Zoom Image.",Status:"This space unintentionally left blank ({0} {1}).",OpenFailed:"Unable to open {0}: {1}"},Tooltips:{FullPage:"Toggle full page",Home:"Go home",ZoomIn:"Zoom in",ZoomOut:"Zoom out",NextPage:"Next page",PreviousPage:"Previous page",RotateLeft:"Rotate left",RotateRight:"Rotate right",Flip:"Flip Horizontally"}};a.extend(a,{getString:function(c){var d,e=c.split("."),f=null,g=arguments,h=b;for(d=0;d<e.length-1;d++)h=h[e[d]]||{};return"string"!=typeof(f=h[e[d]])&&(a.console.error("Untranslated source string:",c),f=""),f.replace(/\{\d+\}/g,function(a){return a=parseInt(a.match(/\d+/),10)+1,a<g.length?g[a]:""})},setString:function(a,c){var d,e=a.split("."),f=b;for(d=0;d<e.length-1;d++)f[e[d]]||(f[e[d]]={}),f=f[e[d]];f[e[d]]=c}})}(OpenSeadragon),function(a){a.Point=function(a,b){this.x="number"==typeof a?a:0,this.y="number"==typeof b?b:0},a.Point.prototype={clone:function(){return new a.Point(this.x,this.y)},plus:function(b){return new a.Point(this.x+b.x,this.y+b.y)},minus:function(b){return new a.Point(this.x-b.x,this.y-b.y)},times:function(b){return new a.Point(this.x*b,this.y*b)},divide:function(b){return new a.Point(this.x/b,this.y/b)},negate:function(){return new a.Point(-this.x,-this.y)},distanceTo:function(a){return Math.sqrt(Math.pow(this.x-a.x,2)+Math.pow(this.y-a.y,2))},squaredDistanceTo:function(a){return Math.pow(this.x-a.x,2)+Math.pow(this.y-a.y,2)},apply:function(b){return new a.Point(b(this.x),b(this.y))},equals:function(b){return b instanceof a.Point&&this.x===b.x&&this.y===b.y},rotate:function(b,c){c=c||new a.Point(0,0);var d,e;if(b%90==0)switch(a.positiveModulo(b,360)){case 0:d=1,e=0;break;case 90:d=0,e=1;break;case 180:d=-1,e=0;break;case 270:d=0,e=-1}else{var f=b*Math.PI/180;d=Math.cos(f),e=Math.sin(f)}return f=d*(this.x-c.x)-e*(this.y-c.y)+c.x,c=e*(this.x-c.x)+d*(this.y-c.y)+c.y,new a.Point(f,c)},toString:function(){return"("+Math.round(100*this.x)/100+","+Math.round(100*this.y)/100+")"}}}(OpenSeadragon),function(a){a.TileSource=function(b,c,d,e,f,g){var h,i=this,j=arguments;if(j=a.isPlainObject(b)?b:{width:j[0],height:j[1],tileSize:j[2],tileOverlap:j[3],minLevel:j[4],maxLevel:j[5]},a.EventSource.call(this),a.extend(!0,this,j),!this.success)for(h=0;h<arguments.length;h++)if(a.isFunction(arguments[h])){this.success=arguments[h];break}this.success&&this.addHandler("ready",function(a){i.success(a)}),"string"===a.type(b)&&(this.url=b),this.url?(this.aspectRatio=1,this.dimensions=new a.Point(10,10),this._tileWidth=0,this._tileHeight=0,this.tileOverlap=0,this.minLevel=0,this.maxLevel=0,this.ready=!1,this.getImageInfo(this.url)):(this.ready=!0,this.aspectRatio=j.width&&j.height?j.width/j.height:1,this.dimensions=new a.Point(j.width,j.height),this.tileSize?(this._tileWidth=this._tileHeight=this.tileSize,delete this.tileSize):(this.tileWidth?(this._tileWidth=this.tileWidth,delete this.tileWidth):this._tileWidth=0,this.tileHeight?(this._tileHeight=this.tileHeight,delete this.tileHeight):this._tileHeight=0),this.tileOverlap=j.tileOverlap||0,this.minLevel=j.minLevel||0,this.maxLevel=void 0!==j.maxLevel&&null!==j.maxLevel?j.maxLevel:j.width&&j.height?Math.ceil(Math.log(Math.max(j.width,j.height))/Math.log(2)):0,this.success&&a.isFunction(this.success)&&this.success(this))},a.TileSource.prototype={getTileSize:function(b){return a.console.error("[TileSource.getTileSize] is deprecated. Use TileSource.getTileWidth() and TileSource.getTileHeight() instead"),this._tileWidth},getTileWidth:function(a){return this._tileWidth||this.getTileSize(a)},getTileHeight:function(a){return this._tileHeight||this.getTileSize(a)},setMaxLevel:function(a){this.maxLevel=a,this._memoizeLevelScale()},getLevelScale:function(a){return this._memoizeLevelScale(),this.getLevelScale(a)},_memoizeLevelScale:function(){var a,b={};for(a=0;a<=this.maxLevel;a++)b[a]=1/Math.pow(2,this.maxLevel-a);this.getLevelScale=function(a){return b[a]}},getNumTiles:function(b){var c=this.getLevelScale(b),d=Math.ceil(c*this.dimensions.x/this.getTileWidth(b)),b=Math.ceil(c*this.dimensions.y/this.getTileHeight(b));return new a.Point(d,b)},getPixelRatio:function(b){var c=this.dimensions.times(this.getLevelScale(b)),b=1/c.x*a.pixelDensityRatio,c=1/c.y*a.pixelDensityRatio;return new a.Point(b,c)},getClosestLevel:function(){var a,b;for(a=this.minLevel+1;a<=this.maxLevel&&!(1<(b=this.getNumTiles(a)).x||1<b.y);a++);return a-1},getTileAtPoint:function(b,c){var d=0<=c.x&&c.x<=1&&0<=c.y&&c.y<=1/this.aspectRatio;a.console.assert(d,"[TileSource.getTileAtPoint] must be called with a valid point.");var e=this.dimensions.x*this.getLevelScale(b);return d=c.x*e,e=c.y*e,d=Math.floor(d/this.getTileWidth(b)),e=Math.floor(e/this.getTileHeight(b)),1<=c.x&&(d=this.getNumTiles(b).x-1),c.y>=1/this.aspectRatio-1e-15&&(e=this.getNumTiles(b).y-1),new a.Point(d,e)},getTileBounds:function(b,c,d,e){var f=this.dimensions.times(this.getLevelScale(b)),g=this.getTileWidth(b),h=this.getTileHeight(b),i=0===c?0:g*c-this.tileOverlap,b=0===d?0:h*d-this.tileOverlap,c=g+(0===c?1:2)*this.tileOverlap,h=h+(0===d?1:2)*this.tileOverlap,d=1/f.x;return c=Math.min(c,f.x-i),h=Math.min(h,f.y-b),e?new a.Rect(0,0,c,h):new a.Rect(i*d,b*d,c*d,h*d)},getImageInfo:function(b){var c,d,e,f,g,h=this;b&&-1<(g=(f=(e=b.split("/"))[e.length-1]).lastIndexOf("."))&&(e[e.length-1]=f.slice(0,g));var i=null;if(this.splitHashDataForPost){var j=b.indexOf("#");-1!==j&&(i=b.substring(j+1),b=b.substr(0,j))}c=function(c){"string"==typeof c&&(c=a.parseXml(c));var e=a.TileSource.determineType(h,c,b);e?(void 0===(d=e.prototype.configure.apply(h,[c,b,i])).ajaxWithCredentials&&(d.ajaxWithCredentials=h.ajaxWithCredentials),d=new e(d),h.ready=!0,h.raiseEvent("ready",{tileSource:d})):h.raiseEvent("open-failed",{message:"Unable to load TileSource",source:b})},b.match(/\.js$/)?(j=b.split("/").pop().replace(".js",""),a.jsonp({url:b,async:!1,callbackName:j,callback:c})):a.makeAjaxRequest({url:b,postData:i,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,success:function(b){b=function(b){var c,d,e=b.responseText,f=b.status;if(!b)throw new Error(a.getString("Errors.Security"));if(200!==b.status&&0!==b.status)throw f=b.status,c=404===f?"Not Found":b.statusText,new Error(a.getString("Errors.Status",f,c));if(e.match(/\s*<.*/))try{d=b.responseXML&&b.responseXML.documentElement?b.responseXML:a.parseXml(e)}catch(c){d=b.responseText}else if(e.match(/\s*[{[].*/))try{d=a.parseJSON(e)}catch(c){d=e}else d=e;return d}(b),c(b)},error:function(c,d){var e;try{e="HTTP "+c.status+" attempting to load TileSource: "+b}catch(c){e=(void 0!==d&&d.toString?d.toString():"Unknown error")+" attempting to load TileSource: "+b}a.console.error(e),h.raiseEvent("open-failed",{message:e,source:b,postData:i})}})},supports:function(a,b){return!1},configure:function(a,b,c){throw new Error("Method not implemented.")},getTileUrl:function(a,b,c){throw new Error("Method not implemented.")},getTilePostData:function(a,b,c){return null},getTileAjaxHeaders:function(a,b,c){return{}},getTileHashKey:function(a,b,c,d,e,f){return e?d+"+"+JSON.stringify(e):d},tileExists:function(a,b,c){var d=this.getNumTiles(a);return a>=this.minLevel&&a<=this.maxLevel&&0<=b&&0<=c&&b<d.x&&c<d.y}},a.extend(!0,a.TileSource.prototype,a.EventSource.prototype),a.TileSource.determineType=function(b,c,d){for(var e in OpenSeadragon)if(e.match(/.+TileSource$/)&&a.isFunction(OpenSeadragon[e])&&a.isFunction(OpenSeadragon[e].prototype.supports)&&OpenSeadragon[e].prototype.supports.call(b,c,d))return OpenSeadragon[e];return a.console.error("No TileSource was able to open %s %s",d,c),null}}(OpenSeadragon),function(a){function b(b,c){var d,e,f=c.Image,g=f.Url,h=f.Format,i=f.Size,j=f.DisplayRect||[],k=parseInt(i.Width,10),l=parseInt(i.Height,10),i=parseInt(f.TileSize,10),f=parseInt(f.Overlap,10),m=[];for(e=0;e<j.length;e++)d=j[e].Rect,m.push(new a.DisplayRect(parseInt(d.X,10),parseInt(d.Y,10),parseInt(d.Width,10),parseInt(d.Height,10),parseInt(d.MinLevel,10),parseInt(d.MaxLevel,10)));return a.extend(!0,{width:k,height:l,tileSize:i,tileOverlap:f,minLevel:null,maxLevel:null,tilesUrl:g,fileFormat:h,displayRects:m},c)}a.DziTileSource=function(b,c,d,e,f,g,h,i,j){var k,l,m,n;if(n=a.isPlainObject(b)?b:{width:b,height:c,tileSize:d,tileOverlap:e,tilesUrl:f,fileFormat:g,displayRects:h,minLevel:i,maxLevel:j},this._levelRects={},this.tilesUrl=n.tilesUrl,this.fileFormat=n.fileFormat,this.displayRects=n.displayRects,this.displayRects)for(k=this.displayRects.length-1;0<=k;k--)for(m=(l=this.displayRects[k]).minLevel;m<=l.maxLevel;m++)this._levelRects[m]||(this._levelRects[m]=[]),this._levelRects[m].push(l);a.TileSource.apply(this,[n])},a.extend(a.DziTileSource.prototype,a.TileSource.prototype,{supports:function(a,b){var c;return a.Image?c=a.Image.xmlns:a.documentElement&&("Image"!==a.documentElement.localName&&"Image"!==a.documentElement.tagName||(c=a.documentElement.namespaceURI)),-1!==(c=(c||"").toLowerCase()).indexOf("schemas.microsoft.com/deepzoom/2008")||-1!==c.indexOf("schemas.microsoft.com/deepzoom/2009")},configure:function(c,d,e){return c=(a.isPlainObject(c)?b:function(c,d){if(!d||!d.documentElement)throw new Error(a.getString("Errors.Xml"));var e,f,g,h,i,j=d.documentElement,k=j.localName||j.tagName,l=d.documentElement.namespaceURI,d=null,m=[];if("Image"===k)try{if(void 0===(h=j.getElementsByTagName("Size")[0])&&(h=j.getElementsByTagNameNS(l,"Size")[0]),d={Image:{xmlns:"http://schemas.microsoft.com/deepzoom/2008",Url:j.getAttribute("Url"),Format:j.getAttribute("Format"),DisplayRect:null,Overlap:parseInt(j.getAttribute("Overlap"),10),TileSize:parseInt(j.getAttribute("TileSize"),10),Size:{Height:parseInt(h.getAttribute("Height"),10),Width:parseInt(h.getAttribute("Width"),10)}}},!a.imageFormatSupported(d.Image.Format))throw new Error(a.getString("Errors.ImageFormat",d.Image.Format.toUpperCase()));for(void 0===(e=j.getElementsByTagName("DisplayRect"))&&(e=j.getElementsByTagNameNS(l,"DisplayRect")[0]),i=0;i<e.length;i++)f=e[i],void 0===(g=f.getElementsByTagName("Rect")[0])&&(g=f.getElementsByTagNameNS(l,"Rect")[0]),m.push({Rect:{X:parseInt(g.getAttribute("X"),10),Y:parseInt(g.getAttribute("Y"),10),Width:parseInt(g.getAttribute("Width"),10),Height:parseInt(g.getAttribute("Height"),10),MinLevel:parseInt(f.getAttribute("MinLevel"),10),MaxLevel:parseInt(f.getAttribute("MaxLevel"),10)}});return m.length&&(d.Image.DisplayRect=m),b(0,d)}catch(c){throw c instanceof Error?c:new Error(a.getString("Errors.Dzi"))}else{if("Collection"===k)throw new Error(a.getString("Errors.Dzc"));if("Error"===k)throw j=j.getElementsByTagName("Message")[0].firstChild.nodeValue,new Error(j)}throw new Error(a.getString("Errors.Dzi"))})(this,c),d&&!c.tilesUrl&&(c.tilesUrl=d.replace(/([^/]+?)(\.(dzi|xml|js)?(\?[^/]*)?)?\/?$/,"$1_files/"),-1!==d.search(/\.(dzi|xml|js)\?/)?c.queryParams=d.match(/\?.*/):c.queryParams=""),c},getTileUrl:function(a,b,c){return[this.tilesUrl,a,"/",b,"_",c,".",this.fileFormat,this.queryParams].join("")},tileExists:function(a,b,c){var d,e,f,g,h,i,j=this._levelRects[a];if(this.minLevel&&a<this.minLevel||this.maxLevel&&a>this.maxLevel)return!1;if(!j||!j.length)return!0;for(i=j.length-1;0<=i;i--)if(!(a<(d=j[i]).minLevel||a>d.maxLevel)&&(h=this.getLevelScale(a),e=d.x*h,f=d.y*h,g=e+d.width*h,h=f+d.height*h,e=Math.floor(e/this._tileWidth),f=Math.floor(f/this._tileWidth),g=Math.ceil(g/this._tileWidth),h=Math.ceil(h/this._tileWidth),e<=b&&b<g&&f<=c&&c<h))return!0;return!1}})}(OpenSeadragon),function(a){function b(a){var b=Array.isArray(a.profile)?a.profile[0]:a.profile,c=-1!==["http://library.stanford.edu/iiif/image-api/compliance.html#level0","http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0","http://iiif.io/api/image/2/level0.json","level0","https://iiif.io/api/image/3/level0.json"].indexOf(b);return b=!1,2===a.version&&1<a.profile.length&&a.profile[1].supports&&(b=-1!==a.profile[1].supports.indexOf("sizeByW")),3===a.version&&a.extraFeatures&&(b=-1!==a.extraFeatures.indexOf("sizeByWh")),!c||b}function c(a){for(var b=[],c=0;c<a.sizes.length;c++)b.push({url:a["@id"]+"/full/"+a.sizes[c].width+","+(3===a.version?a.sizes[c].height:"")+"/0/default."+a.tileFormat,width:a.sizes[c].width,height:a.sizes[c].height});return b.sort(function(a,b){return a.width-b.width})}a.IIIFTileSource=function(d){if(a.extend(!0,this,d),!(this.height&&this.width&&this["@id"]))throw new Error("IIIF required parameters not provided.");if(d.tileSizePerScaleFactor={},this.tileFormat=this.tileFormat||"jpg",this.version=d.version,this.tile_width&&this.tile_height)d.tileWidth=this.tile_width,d.tileHeight=this.tile_height;else if(this.tile_width)d.tileSize=this.tile_width;else if(this.tile_height)d.tileSize=this.tile_height;else if(this.tiles)if(1===this.tiles.length)d.tileWidth=this.tiles[0].width,d.tileHeight=this.tiles[0].height||this.tiles[0].width,this.scale_factors=this.tiles[0].scaleFactors;else{this.scale_factors=[];for(var e=0;e<this.tiles.length;e++)for(var f=0;f<this.tiles[e].scaleFactors.length;f++){var g=this.tiles[e].scaleFactors[f];this.scale_factors.push(g),d.tileSizePerScaleFactor[g]={width:this.tiles[e].width,height:this.tiles[e].height||this.tiles[e].width}}}else if(b(d)){for(var h=Math.min(this.height,this.width),i=[256,512,1024],j=[],k=0;k<i.length;k++)i[k]<=h&&j.push(i[k]);0<j.length?d.tileSize=Math.max.apply(null,j):d.tileSize=h}else this.sizes&&0<this.sizes.length?(this.emulateLegacyImagePyramid=!0,d.levels=c(this),a.extend(!0,d,{width:d.levels[d.levels.length-1].width,height:d.levels[d.levels.length-1].height,tileSize:Math.max(d.height,d.width),tileOverlap:0,minLevel:0,maxLevel:d.levels.length-1}),this.levels=d.levels):a.console.error("Nothing in the info.json to construct image pyramids from");if(!d.maxLevel&&!this.emulateLegacyImagePyramid)if(this.scale_factors){var l=Math.max.apply(null,this.scale_factors);d.maxLevel=Math.round(Math.log(l)*Math.LOG2E)}else d.maxLevel=Number(Math.ceil(Math.log(Math.max(this.width,this.height),2)));a.TileSource.apply(this,[d])},a.extend(a.IIIFTileSource.prototype,a.TileSource.prototype,{supports:function(a,b){return!!(a.protocol&&"http://iiif.io/api/image"===a.protocol||a["@context"]&&("http://library.stanford.edu/iiif/image-api/1.1/context.json"===a["@context"]||"http://iiif.io/api/image/1/context.json"===a["@context"])||a.profile&&0===a.profile.indexOf("http://library.stanford.edu/iiif/image-api/compliance.html")||a.identifier&&a.width&&a.height||a.documentElement&&"info"===a.documentElement.tagName&&"http://library.stanford.edu/iiif/image-api/ns/"===a.documentElement.namespaceURI)},configure:function(b,c,d){if(a.isPlainObject(b)){if(b["@context"]){var e=b["@context"];if(Array.isArray(e))for(var f=0;f<e.length;f++)if("string"==typeof e[f]&&(/^http:\/\/iiif\.io\/api\/image\/[1-3]\/context\.json$/.test(e[f])||"http://library.stanford.edu/iiif/image-api/1.1/context.json"===e[f])){e=e[f];break}switch(e){case"http://iiif.io/api/image/1/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/context.json":b.version=1;break;case"http://iiif.io/api/image/2/context.json":b.version=2;break;case"http://iiif.io/api/image/3/context.json":b.version=3;break;default:a.console.error("Data has a @context property which contains no known IIIF context URI.")}}else b["@context"]="http://iiif.io/api/image/1.0/context.json",b["@id"]=c.replace("/info.json",""),b.version=1;if(!b["@id"]&&b.id&&(b["@id"]=b.id),b.preferredFormats)for(var g=0;g<b.preferredFormats.length;g++)if(OpenSeadragon.imageFormatSupported(b.preferredFormats[g])){b.tileFormat=b.preferredFormats[g];break}return b}var h=function(b){if(!b||!b.documentElement)throw new Error(a.getString("Errors.Xml"));var c=b.documentElement,d=c.tagName,b=null;if("info"===d)try{return function b(c,d,e){var f,g;if(3===c.nodeType&&e)(g=c.nodeValue.trim()).match(/^\d*$/)&&(g=Number(g)),d[e]?(a.isArray(d[e])||(d[e]=[d[e]]),d[e].push(g)):d[e]=g;else if(1===c.nodeType)for(f=0;f<c.childNodes.length;f++)b(c.childNodes[f],d,c.nodeName)}(c,b={}),b}catch(b){throw b instanceof Error?b:new Error(a.getString("Errors.IIIF"))}throw new Error(a.getString("Errors.IIIF"))}(b);return h["@context"]="http://iiif.io/api/image/1.0/context.json",h["@id"]=c.replace("/info.xml",""),h.version=1,h},getTileWidth:function(b){return this.emulateLegacyImagePyramid?a.TileSource.prototype.getTileWidth.call(this,b):(b=Math.pow(2,this.maxLevel-b),this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[b]?this.tileSizePerScaleFactor[b].width:this._tileWidth)},getTileHeight:function(b){return this.emulateLegacyImagePyramid?a.TileSource.prototype.getTileHeight.call(this,b):(b=Math.pow(2,this.maxLevel-b),this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[b]?this.tileSizePerScaleFactor[b].height:this._tileHeight)},getLevelScale:function(b){if(this.emulateLegacyImagePyramid){var c=NaN;return c=0<this.levels.length&&b>=this.minLevel&&b<=this.maxLevel?this.levels[b].width/this.levels[this.maxLevel].width:c}return a.TileSource.prototype.getLevelScale.call(this,b)},getNumTiles:function(b){return this.emulateLegacyImagePyramid?this.getLevelScale(b)?new a.Point(1,1):new a.Point(0,0):a.TileSource.prototype.getNumTiles.call(this,b)},getTileAtPoint:function(b,c){return this.emulateLegacyImagePyramid?new a.Point(0,0):a.TileSource.prototype.getTileAtPoint.call(this,b,c)},getTileUrl:function(a,b,c){if(this.emulateLegacyImagePyramid){var d=null;return d=0<this.levels.length&&a>=this.minLevel&&a<=this.maxLevel?this.levels[a].url:d}var e,f,g,h,i,j=Math.pow(.5,this.maxLevel-a),k=Math.ceil(this.width*j),l=Math.ceil(this.height*j);return e=this.getTileWidth(a),f=this.getTileHeight(a),i=Math.ceil(e/j),d=Math.ceil(f/j),a=1===this.version?"native."+this.tileFormat:"default."+this.tileFormat,k<e&&l<f?(h=2===this.version&&k===this.width?"full":3===this.version&&k===this.width&&l===this.height?"max":3===this.version?k+","+l:k+",",g="full"):(l=b*i,k=c*d,i=Math.min(i,this.width-l),d=Math.min(d,this.height-k),g=0===b&&0===c&&i===this.width&&d===this.height?"full":[l,k,i,d].join(","),i=Math.ceil(i*j),j=Math.ceil(d*j),h=2===this.version&&i===this.width?"full":3===this.version&&i===this.width&&j===this.height?"max":3===this.version?i+","+j:i+","),[this["@id"],g,h,"0",a].join("/")},__testonly__:{canBeTiled:b,constructLevels:c}})}(OpenSeadragon),function(a){a.OsmTileSource=function(b,c,d,e,f){var g;(g=a.isPlainObject(b)?b:{width:b,height:c,tileSize:d,tileOverlap:e,tilesUrl:f}).width&&g.height||(g.width=65572864,g.height=65572864),g.tileSize||(g.tileSize=256,g.tileOverlap=0),g.tilesUrl||(g.tilesUrl="http://tile.openstreetmap.org/"),g.minLevel=8,a.TileSource.apply(this,[g])},a.extend(a.OsmTileSource.prototype,a.TileSource.prototype,{supports:function(a,b){return a.type&&"openstreetmaps"===a.type},configure:function(a,b,c){return a},getTileUrl:function(a,b,c){return this.tilesUrl+(a-8)+"/"+b+"/"+c+".png"}})}(OpenSeadragon),function(a){a.TmsTileSource=function(b,c,d,e,f){var g;g=a.isPlainObject(b)?b:{width:b,height:c,tileSize:d,tileOverlap:e,tilesUrl:f};var h,i=256*Math.ceil(g.width/256),j=256*Math.ceil(g.height/256);h=j<i?i/256:j/256,g.maxLevel=Math.ceil(Math.log(h)/Math.log(2))-1,g.tileSize=256,g.width=i,g.height=j,a.TileSource.apply(this,[g])},a.extend(a.TmsTileSource.prototype,a.TileSource.prototype,{supports:function(a,b){return a.type&&"tiledmapservice"===a.type},configure:function(a,b,c){return a},getTileUrl:function(a,b,c){var d=this.getNumTiles(a).y-1;return this.tilesUrl+a+"/"+b+"/"+(d-c)+".png"}})}(OpenSeadragon),function(a){a.ZoomifyTileSource=function(a){void 0===a.tileSize&&(a.tileSize=256),void 0===a.fileFormat&&(a.fileFormat="jpg",this.fileFormat=a.fileFormat);var b={x:a.width,y:a.height};for(a.imageSizes=[{x:a.width,y:a.height}],a.gridSize=[this._getGridSize(a.width,a.height,a.tileSize)];parseInt(b.x,10)>a.tileSize||parseInt(b.y,10)>a.tileSize;)b.x=Math.floor(b.x/2),b.y=Math.floor(b.y/2),a.imageSizes.push({x:b.x,y:b.y}),a.gridSize.push(this._getGridSize(b.x,b.y,a.tileSize));a.imageSizes.reverse(),a.gridSize.reverse(),a.minLevel=0,a.maxLevel=a.gridSize.length-1,OpenSeadragon.TileSource.apply(this,[a])},a.extend(a.ZoomifyTileSource.prototype,a.TileSource.prototype,{_getGridSize:function(a,b,c){return{x:Math.ceil(a/c),y:Math.ceil(b/c)}},_calculateAbsoluteTileNumber:function(a,b,c){for(var d=0,e={},f=0;f<a;f++)d+=(e=this.gridSize[f]).x*e.y;return d+=(e=this.gridSize[a]).x*c+b},supports:function(a,b){return a.type&&"zoomifytileservice"===a.type},configure:function(a,b,c){return a},getTileUrl:function(a,b,c){var d=this._calculateAbsoluteTileNumber(a,b,c);return d=Math.floor(d/256),this.tilesUrl+"TileGroup"+d+"/"+a+"-"+b+"-"+c+"."+this.fileFormat}})}(OpenSeadragon),function(a){a.LegacyTileSource=function(b){var c,d,e;(c=a.isArray(b)?{type:"legacy-image-pyramid",levels:b}:c).levels=function(b){var c,d,e=[];for(d=0;d<b.length;d++)(c=b[d]).height&&c.width&&c.url?e.push({url:c.url,width:Number(c.width),height:Number(c.height)}):a.console.error("Unsupported image format: %s",c.url||"<no URL>");return e.sort(function(a,b){return a.height-b.height})}(c.levels),0<c.levels.length?(d=c.levels[c.levels.length-1].width,e=c.levels[c.levels.length-1].height):(e=d=0,a.console.error("No supported image formats found")),a.extend(!0,c,{width:d,height:e,tileSize:Math.max(e,d),tileOverlap:0,minLevel:0,maxLevel:0<c.levels.length?c.levels.length-1:0}),a.TileSource.apply(this,[c]),this.levels=c.levels},a.extend(a.LegacyTileSource.prototype,a.TileSource.prototype,{supports:function(a,b){return a.type&&"legacy-image-pyramid"===a.type||a.documentElement&&"legacy-image-pyramid"===a.documentElement.getAttribute("type")},configure:function(b,c,d){return a.isPlainObject(b)?b.levels:function(b){if(!b||!b.documentElement)throw new Error(a.getString("Errors.Xml"));var c,d,e=b.documentElement,f=e.tagName,g=null,h=[];if("image"===f)try{for(g={type:e.getAttribute("type"),levels:[]},h=e.getElementsByTagName("level"),d=0;d<h.length;d++)c=h[d],g.levels.push({url:c.getAttribute("url"),width:parseInt(c.getAttribute("width"),10),height:parseInt(c.getAttribute("height"),10)});return g.levels}catch(b){throw b instanceof Error?b:new Error("Unknown error parsing Legacy Image Pyramid XML.")}else{if("collection"===f)throw new Error("Legacy Image Pyramid Collections not yet supported.");if("error"===f)throw new Error("Error: "+b)}throw new Error("Unknown element "+f)}(b)},getLevelScale:function(a){var b=NaN;return b=0<this.levels.length&&a>=this.minLevel&&a<=this.maxLevel?this.levels[a].width/this.levels[this.maxLevel].width:b},getNumTiles:function(b){return this.getLevelScale(b)?new a.Point(1,1):new a.Point(0,0)},getTileUrl:function(a,b,c){var d=null;return d=0<this.levels.length&&a>=this.minLevel&&a<=this.maxLevel?this.levels[a].url:d}})}(OpenSeadragon),function(a){a.ImageTileSource=function(b){b=a.extend({buildPyramid:!0,crossOriginPolicy:!1,ajaxWithCredentials:!1,useCanvas:!0},b),a.TileSource.apply(this,[b])},a.extend(a.ImageTileSource.prototype,a.TileSource.prototype,{supports:function(a,b){return a.type&&"image"===a.type},configure:function(a,b,c){return a},getImageInfo:function(b){var c=this._image=new Image,d=this;this.crossOriginPolicy&&(c.crossOrigin=this.crossOriginPolicy),this.ajaxWithCredentials&&(c.useCredentials=this.ajaxWithCredentials),a.addEvent(c,"load",function(){d.width=c.naturalWidth,d.height=c.naturalHeight,d.aspectRatio=d.width/d.height,d.dimensions=new a.Point(d.width,d.height),d._tileWidth=d.width,d._tileHeight=d.height,d.tileOverlap=0,d.minLevel=0,d.levels=d._buildLevels(),d.maxLevel=d.levels.length-1,d.ready=!0,d.raiseEvent("ready",{tileSource:d})}),a.addEvent(c,"error",function(){d.raiseEvent("open-failed",{message:"Error loading image at "+b,source:b})}),c.src=b},getLevelScale:function(a){var b=NaN;return b=a>=this.minLevel&&a<=this.maxLevel?this.levels[a].width/this.levels[this.maxLevel].width:b},getNumTiles:function(b){return this.getLevelScale(b)?new a.Point(1,1):new a.Point(0,0)},getTileUrl:function(a,b,c){var d=null;return d=a>=this.minLevel&&a<=this.maxLevel?this.levels[a].url:d},getContext2D:function(a,b,c){var d=null;return d=a>=this.minLevel&&a<=this.maxLevel?this.levels[a].context2D:d},destroy:function(){this._freeupCanvasMemory()},_buildLevels:function(){var b=[{url:this._image.src,width:this._image.naturalWidth,height:this._image.naturalHeight}];if(!this.buildPyramid||!a.supportsCanvas||!this.useCanvas)return delete this._image,b;var c=this._image.naturalWidth,d=this._image.naturalHeight,e=document.createElement("canvas"),f=e.getContext("2d");if(e.width=c,e.height=d,f.drawImage(this._image,0,0,c,d),b[0].context2D=f,delete this._image,a.isCanvasTainted(e))return b;for(;2<=c&&2<=d;){c=Math.floor(c/2),d=Math.floor(d/2);var g=document.createElement("canvas"),h=g.getContext("2d");g.width=c,g.height=d,h.drawImage(e,0,0,c,d),b.splice(0,0,{context2D:h,width:c,height:d}),e=g,f=h}return b},_freeupCanvasMemory:function(){for(var a=0;a<this.levels.length;a++)this.levels[a].context2D&&(this.levels[a].context2D.canvas.height=0,this.levels[a].context2D.canvas.width=0)}})}(OpenSeadragon),function(a){a.TileSourceCollection=function(b,c,d,e){a.console.error("TileSourceCollection is deprecated; use World instead")}}(OpenSeadragon),function(a){function b(c){a.requestAnimationFrame(function(){!function(c){var d;c.shouldFade&&(d=a.now(),d-=c.fadeBeginTime,d=1-d/c.fadeLength,d=Math.min(1,d),d=Math.max(0,d),c.imgGroup&&a.setElementOpacity(c.imgGroup,d,!0),0<d&&b(c))}(c)})}function c(b,c){b.element.disabled||(c>=a.ButtonState.GROUP&&b.currentState===a.ButtonState.REST&&(!function(b){b.shouldFade=!1,b.imgGroup&&a.setElementOpacity(b.imgGroup,1,!0)}(b),b.currentState=a.ButtonState.GROUP),c>=a.ButtonState.HOVER&&b.currentState===a.ButtonState.GROUP&&(b.imgHover&&(b.imgHover.style.visibility=""),b.currentState=a.ButtonState.HOVER),c>=a.ButtonState.DOWN&&b.currentState===a.ButtonState.HOVER&&(b.imgDown&&(b.imgDown.style.visibility=""),b.currentState=a.ButtonState.DOWN))}function d(c,d){c.element.disabled||(d<=a.ButtonState.HOVER&&c.currentState===a.ButtonState.DOWN&&(c.imgDown&&(c.imgDown.style.visibility="hidden"),c.currentState=a.ButtonState.HOVER),d<=a.ButtonState.GROUP&&c.currentState===a.ButtonState.HOVER&&(c.imgHover&&(c.imgHover.style.visibility="hidden"),c.currentState=a.ButtonState.GROUP),d<=a.ButtonState.REST&&c.currentState===a.ButtonState.GROUP&&(!function(c){c.shouldFade=!0,c.fadeBeginTime=a.now()+c.fadeDelay,window.setTimeout(function(){b(c)},c.fadeDelay)}(c),c.currentState=a.ButtonState.REST))}a.ButtonState={REST:0,GROUP:1,HOVER:2,DOWN:3},a.Button=function(b){var e=this;a.EventSource.call(this),a.extend(!0,this,{tooltip:null,srcRest:null,srcGroup:null,srcHover:null,srcDown:null,clickTimeThreshold:a.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:a.DEFAULT_SETTINGS.clickDistThreshold,fadeDelay:0,fadeLength:2e3,onPress:null,onRelease:null,onClick:null,onEnter:null,onExit:null,onFocus:null,onBlur:null,userData:null},b),this.element=b.element||a.makeNeutralElement("div"),b.element||(this.imgRest=a.makeTransparentImage(this.srcRest),this.imgGroup=a.makeTransparentImage(this.srcGroup),this.imgHover=a.makeTransparentImage(this.srcHover),this.imgDown=a.makeTransparentImage(this.srcDown),this.imgRest.alt=this.imgGroup.alt=this.imgHover.alt=this.imgDown.alt=this.tooltip,a.setElementPointerEventsNone(this.imgRest),a.setElementPointerEventsNone(this.imgGroup),a.setElementPointerEventsNone(this.imgHover),a.setElementPointerEventsNone(this.imgDown),this.element.style.position="relative",a.setElementTouchActionNone(this.element),this.imgGroup.style.position=this.imgHover.style.position=this.imgDown.style.position="absolute",this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top="0px",this.imgGroup.style.left=this.imgHover.style.left=this.imgDown.style.left="0px",this.imgHover.style.visibility=this.imgDown.style.visibility="hidden",a.Browser.vendor===a.BROWSERS.FIREFOX&&a.Browser.version<3&&(this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top=""),this.element.appendChild(this.imgRest),this.element.appendChild(this.imgGroup),this.element.appendChild(this.imgHover),this.element.appendChild(this.imgDown)),this.addHandler("press",this.onPress),this.addHandler("release",this.onRelease),this.addHandler("click",this.onClick),this.addHandler("enter",this.onEnter),this.addHandler("exit",this.onExit),this.addHandler("focus",this.onFocus),this.addHandler("blur",this.onBlur),this.currentState=a.ButtonState.GROUP,this.fadeBeginTime=null,this.shouldFade=!1,this.element.style.display="inline-block",this.element.style.position="relative",this.element.title=this.tooltip,this.tracker=new a.MouseTracker({userData:"Button.tracker",element:this.element,
clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(b){b.insideElementPressed?(c(e,a.ButtonState.DOWN),e.raiseEvent("enter",{originalEvent:b.originalEvent})):b.buttonDownAny||c(e,a.ButtonState.HOVER)},focusHandler:function(a){e.tracker.enterHandler(a),e.raiseEvent("focus",{originalEvent:a.originalEvent})},leaveHandler:function(b){d(e,a.ButtonState.GROUP),b.insideElementPressed&&e.raiseEvent("exit",{originalEvent:b.originalEvent})},blurHandler:function(a){e.tracker.leaveHandler(a),e.raiseEvent("blur",{originalEvent:a.originalEvent})},pressHandler:function(b){c(e,a.ButtonState.DOWN),e.raiseEvent("press",{originalEvent:b.originalEvent})},releaseHandler:function(b){b.insideElementPressed&&b.insideElementReleased?(d(e,a.ButtonState.HOVER),e.raiseEvent("release",{originalEvent:b.originalEvent})):b.insideElementPressed?d(e,a.ButtonState.GROUP):c(e,a.ButtonState.HOVER)},clickHandler:function(a){a.quick&&e.raiseEvent("click",{originalEvent:a.originalEvent})},keyHandler:function(a){13===a.keyCode?(e.raiseEvent("click",{originalEvent:a.originalEvent}),e.raiseEvent("release",{originalEvent:a.originalEvent}),a.preventDefault=!0):a.preventDefault=!1}}),d(this,a.ButtonState.REST)},a.extend(a.Button.prototype,a.EventSource.prototype,{notifyGroupEnter:function(){c(this,a.ButtonState.GROUP)},notifyGroupExit:function(){d(this,a.ButtonState.REST)},disable:function(){this.notifyGroupExit(),this.element.disabled=!0,a.setElementOpacity(this.element,.2,!0)},enable:function(){this.element.disabled=!1,a.setElementOpacity(this.element,1,!0),this.notifyGroupEnter()},destroy:function(){this.imgRest&&(this.element.removeChild(this.imgRest),this.imgRest=null),this.imgGroup&&(this.element.removeChild(this.imgGroup),this.imgGroup=null),this.imgHover&&(this.element.removeChild(this.imgHover),this.imgHover=null),this.imgDown&&(this.element.removeChild(this.imgDown),this.imgDown=null),this.removeAllHandlers(),this.tracker.destroy(),this.element=null}})}(OpenSeadragon),function(a){a.ButtonGroup=function(b){a.extend(!0,this,{buttons:[],clickTimeThreshold:a.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:a.DEFAULT_SETTINGS.clickDistThreshold,labelText:""},b);var c,d=this.buttons.concat([]),e=this;if(this.element=b.element||a.makeNeutralElement("div"),!b.group)for(this.element.style.display="inline-block",c=0;c<d.length;c++)this.element.appendChild(d[c].element);a.setElementTouchActionNone(this.element),this.tracker=new a.MouseTracker({userData:"ButtonGroup.tracker",element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(a){var b;for(b=0;b<e.buttons.length;b++)e.buttons[b].notifyGroupEnter()},leaveHandler:function(a){var b;if(!a.insideElementPressed)for(b=0;b<e.buttons.length;b++)e.buttons[b].notifyGroupExit()}})},a.ButtonGroup.prototype={emulateEnter:function(){this.tracker.enterHandler({eventSource:this.tracker})},emulateLeave:function(){this.tracker.leaveHandler({eventSource:this.tracker})},destroy:function(){for(;this.buttons.length;){var a=this.buttons.pop();this.element.removeChild(a.element),a.destroy()}this.tracker.destroy(),this.element=null}}}(OpenSeadragon),function(a){a.Rect=function(b,c,d,e,f){this.x="number"==typeof b?b:0,this.y="number"==typeof c?c:0,this.width="number"==typeof d?d:0,this.height="number"==typeof e?e:0,this.degrees="number"==typeof f?f:0,this.degrees=a.positiveModulo(this.degrees,360);var g,h;270<=this.degrees?(g=this.getTopRight(),this.x=g.x,this.y=g.y,h=this.height,this.height=this.width,this.width=h,this.degrees-=270):180<=this.degrees?(g=this.getBottomRight(),this.x=g.x,this.y=g.y,this.degrees-=180):90<=this.degrees&&(g=this.getBottomLeft(),this.x=g.x,this.y=g.y,h=this.height,this.height=this.width,this.width=h,this.degrees-=90)},a.Rect.fromSummits=function(b,c,d){var e=b.distanceTo(c),f=b.distanceTo(d);return d=c.minus(b),c=Math.atan(d.y/d.x),d.x<0?c+=Math.PI:d.y<0&&(c+=2*Math.PI),new a.Rect(b.x,b.y,e,f,c/Math.PI*180)},a.Rect.prototype={clone:function(){return new a.Rect(this.x,this.y,this.width,this.height,this.degrees)},getAspectRatio:function(){return this.width/this.height},getTopLeft:function(){return new a.Point(this.x,this.y)},getBottomRight:function(){return new a.Point(this.x+this.width,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getTopRight:function(){return new a.Point(this.x+this.width,this.y).rotate(this.degrees,this.getTopLeft())},getBottomLeft:function(){return new a.Point(this.x,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getCenter:function(){return new a.Point(this.x+this.width/2,this.y+this.height/2).rotate(this.degrees,this.getTopLeft())},getSize:function(){return new a.Point(this.width,this.height)},equals:function(b){return b instanceof a.Rect&&this.x===b.x&&this.y===b.y&&this.width===b.width&&this.height===b.height&&this.degrees===b.degrees},times:function(b){return new a.Rect(this.x*b,this.y*b,this.width*b,this.height*b,this.degrees)},translate:function(b){return new a.Rect(this.x+b.x,this.y+b.y,this.width,this.height,this.degrees)},union:function(b){var c=this.getBoundingBox(),d=b.getBoundingBox(),e=Math.min(c.x,d.x),f=Math.min(c.y,d.y);return b=Math.max(c.x+c.width,d.x+d.width),d=Math.max(c.y+c.height,d.y+d.height),new a.Rect(e,f,b-e,d-f)},intersection:function(b){var c=1e-10,d=[],e=this.getTopLeft();b.containsPoint(e,c)&&d.push(e),e=this.getTopRight(),b.containsPoint(e,c)&&d.push(e),e=this.getBottomLeft(),b.containsPoint(e,c)&&d.push(e),e=this.getBottomRight(),b.containsPoint(e,c)&&d.push(e),e=b.getTopLeft(),this.containsPoint(e,c)&&d.push(e),e=b.getTopRight(),this.containsPoint(e,c)&&d.push(e),e=b.getBottomLeft(),this.containsPoint(e,c)&&d.push(e),e=b.getBottomRight(),this.containsPoint(e,c)&&d.push(e);for(var f=this._getSegments(),g=b._getSegments(),h=0;h<f.length;h++)for(var i=f[h],j=0;j<g.length;j++){var k=g[j];k=function(b,d,e,f){var g=d.minus(b),h=f.minus(e);return 0==(d=-h.x*g.y+g.x*h.y)?null:(f=(g.x*(b.y-e.y)-g.y*(b.x-e.x))/d,d=(h.x*(b.y-e.y)-h.y*(b.x-e.x))/d,-c<=f&&f<=1-c&&-c<=d&&d<=1-c?new a.Point(b.x+d*g.x,b.y+d*g.y):null)}(i[0],i[1],k[0],k[1]),k&&d.push(k)}if(0===d.length)return null;for(var l=d[0].x,m=d[0].x,n=d[0].y,o=d[0].y,p=1;p<d.length;p++){var q=d[p];q.x<l&&(l=q.x),q.x>m&&(m=q.x),q.y<n&&(n=q.y),q.y>o&&(o=q.y)}return new a.Rect(l,n,m-l,o-n)},_getSegments:function(){var a=this.getTopLeft(),b=this.getTopRight(),c=this.getBottomLeft(),d=this.getBottomRight();return[[a,b],[b,d],[d,c],[c,a]]},rotate:function(b,c){if(0===(b=a.positiveModulo(b,360)))return this.clone();c=c||this.getCenter();var d=this.getTopLeft().rotate(b,c);return b=this.getTopRight().rotate(b,c).minus(d),b=b.apply(function(a){return Math.abs(a)<1e-15?0:a}),c=Math.atan(b.y/b.x),b.x<0?c+=Math.PI:b.y<0&&(c+=2*Math.PI),new a.Rect(d.x,d.y,this.width,this.height,c/Math.PI*180)},getBoundingBox:function(){if(0===this.degrees)return this.clone();var b=this.getTopLeft(),c=this.getTopRight(),d=this.getBottomLeft(),e=this.getBottomRight(),f=Math.min(b.x,c.x,d.x,e.x),g=Math.max(b.x,c.x,d.x,e.x),h=Math.min(b.y,c.y,d.y,e.y);return e=Math.max(b.y,c.y,d.y,e.y),new a.Rect(f,h,g-f,e-h)},getIntegerBoundingBox:function(){var b=this.getBoundingBox(),c=Math.floor(b.x),d=Math.floor(b.y),e=Math.ceil(b.width+b.x-c);return b=Math.ceil(b.height+b.y-d),new a.Rect(c,d,e,b)},containsPoint:function(a,b){b=b||0;var c=this.getTopLeft(),d=this.getTopRight(),e=this.getBottomLeft(),f=d.minus(c),g=e.minus(c);return(a.x-c.x)*f.x+(a.y-c.y)*f.y>=-b&&(a.x-d.x)*f.x+(a.y-d.y)*f.y<=b&&(a.x-c.x)*g.x+(a.y-c.y)*g.y>=-b&&(a.x-e.x)*g.x+(a.y-e.y)*g.y<=b},toString:function(){return"["+Math.round(100*this.x)/100+", "+Math.round(100*this.y)/100+", "+Math.round(100*this.width)/100+"x"+Math.round(100*this.height)/100+", "+Math.round(100*this.degrees)/100+"deg]"}}}(OpenSeadragon),function(a){function b(a){a.quick&&(a="horizontal"===this.scroll?Math.floor(a.position.x/this.panelWidth):Math.floor(a.position.y/this.panelHeight),this.viewer.goToPage(a)),this.element.focus()}function c(b){if(this.dragging=!0,this.element){var c=Number(this.element.style.marginLeft.replace("px","")),d=Number(this.element.style.marginTop.replace("px","")),f=Number(this.element.style.width.replace("px","")),g=Number(this.element.style.height.replace("px","")),h=a.getElementSize(this.viewer.canvas);"horizontal"===this.scroll?0<-b.delta.x?c>-(f-h.x)&&(this.element.style.marginLeft=c+2*b.delta.x+"px",e(this,h.x,c+2*b.delta.x)):-b.delta.x<0&&c<0&&(this.element.style.marginLeft=c+2*b.delta.x+"px",e(this,h.x,c+2*b.delta.x)):0<-b.delta.y?d>-(g-h.y)&&(this.element.style.marginTop=d+2*b.delta.y+"px",e(this,h.y,d+2*b.delta.y)):-b.delta.y<0&&d<0&&(this.element.style.marginTop=d+2*b.delta.y+"px",e(this,h.y,d+2*b.delta.y))}}function d(b){if(this.element){var c=Number(this.element.style.marginLeft.replace("px","")),d=Number(this.element.style.marginTop.replace("px","")),f=Number(this.element.style.width.replace("px","")),g=Number(this.element.style.height.replace("px","")),h=a.getElementSize(this.viewer.canvas);"horizontal"===this.scroll?0<b.scroll?c>-(f-h.x)&&(this.element.style.marginLeft=c-60*b.scroll+"px",e(this,h.x,c-60*b.scroll)):b.scroll<0&&c<0&&(this.element.style.marginLeft=c-60*b.scroll+"px",e(this,h.x,c-60*b.scroll)):b.scroll<0?d>h.y-g&&(this.element.style.marginTop=d+60*b.scroll+"px",e(this,h.y,d+60*b.scroll)):0<b.scroll&&d<0&&(this.element.style.marginTop=d+60*b.scroll+"px",e(this,h.y,d+60*b.scroll)),b.preventDefault=!0}}function e(b,c,d){var e,f,g,h,i;for(e="horizontal"===b.scroll?b.panelWidth:b.panelHeight,f=Math.ceil(c/e)+5,h=f=(f=(g=Math.ceil((Math.abs(d)+c)/e)+1)-f)<0?0:f;h<g&&h<b.panels.length;h++)if(!(i=b.panels[h]).activePanel){var j=b.viewer.tileSources[h];j=j.referenceStripThumbnailUrl?{type:"image",url:j.referenceStripThumbnailUrl}:j,j=new a.Viewer({id:i.id,tileSources:[j],element:i,navigatorSizeRatio:b.sizeRatio,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,loadTilesWithAjax:b.viewer.loadTilesWithAjax,ajaxHeaders:b.viewer.ajaxHeaders,useCanvas:b.useCanvas}),a.setElementPointerEventsNone(j.canvas),a.setElementPointerEventsNone(j.container),j.innerTracker.setTracking(!1),j.outerTracker.setTracking(!1),b.miniViewers[i.id]=j,i.activePanel=!0}}function f(a){a=a.eventSource.element,"horizontal"===this.scroll?a.style.marginBottom="0px":a.style.marginLeft="0px"}function g(b){b=b.eventSource.element,"horizontal"===this.scroll?b.style.marginBottom="-"+a.getElementSize(b).y/2+"px":b.style.marginLeft="-"+a.getElementSize(b).x/2+"px"}function h(a){if(a.ctrl||a.alt||a.meta)a.preventDefault=!1;else switch(a.keyCode){case 38:d.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),a.preventDefault=!0;break;case 40:case 37:d.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),a.preventDefault=!0;break;case 39:d.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),a.preventDefault=!0;break;default:a.preventDefault=!1}}function i(a){if(a.ctrl||a.alt||a.meta)a.preventDefault=!1;else switch(a.keyCode){case 61:d.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),a.preventDefault=!0;break;case 45:d.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),a.preventDefault=!0;break;case 48:case 119:case 87:d.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),a.preventDefault=!0;break;case 115:case 83:case 97:d.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),a.preventDefault=!0;break;case 100:d.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),a.preventDefault=!0;break;default:a.preventDefault=!1}}var j={};a.ReferenceStrip=function(k){var l,m,n,o=k.viewer,p=a.getElementSize(o.element);for(k.id||(k.id="referencestrip-"+a.now(),this.element=a.makeNeutralElement("div"),this.element.id=k.id,this.element.className="referencestrip"),k=a.extend(!0,{sizeRatio:a.DEFAULT_SETTINGS.referenceStripSizeRatio,position:a.DEFAULT_SETTINGS.referenceStripPosition,scroll:a.DEFAULT_SETTINGS.referenceStripScroll,clickTimeThreshold:a.DEFAULT_SETTINGS.clickTimeThreshold},k,{element:this.element}),a.extend(this,k),j[this.id]={animating:!1},this.minPixelRatio=this.viewer.minPixelRatio,this.element.tabIndex=0,(m=this.element.style).marginTop="0px",m.marginRight="0px",m.marginBottom="0px",m.marginLeft="0px",m.left="0px",m.bottom="0px",m.border="0px",m.background="#000",m.position="relative",a.setElementTouchActionNone(this.element),a.setElementOpacity(this.element,.8),this.viewer=o,this.tracker=new a.MouseTracker({userData:"ReferenceStrip.tracker",element:this.element,clickHandler:a.delegate(this,b),dragHandler:a.delegate(this,c),scrollHandler:a.delegate(this,d),enterHandler:a.delegate(this,f),leaveHandler:a.delegate(this,g),keyDownHandler:a.delegate(this,h),keyHandler:a.delegate(this,i),preProcessEventHandler:function(a){"wheel"===a.eventType&&(a.preventDefault=!0)}}),k.width&&k.height?(this.element.style.width=k.width+"px",this.element.style.height=k.height+"px",o.addControl(this.element,{anchor:a.ControlAnchor.BOTTOM_LEFT})):"horizontal"===k.scroll?(this.element.style.width=p.x*k.sizeRatio*o.tileSources.length+12*o.tileSources.length+"px",this.element.style.height=p.y*k.sizeRatio+"px",o.addControl(this.element,{anchor:a.ControlAnchor.BOTTOM_LEFT})):(this.element.style.height=p.y*k.sizeRatio*o.tileSources.length+12*o.tileSources.length+"px",this.element.style.width=p.x*k.sizeRatio+"px",o.addControl(this.element,{anchor:a.ControlAnchor.TOP_LEFT})),this.panelWidth=p.x*this.sizeRatio+8,this.panelHeight=p.y*this.sizeRatio+8,this.panels=[],this.miniViewers={},n=0;n<o.tileSources.length;n++)(l=a.makeNeutralElement("div")).id=this.element.id+"-"+n,l.style.width=this.panelWidth+"px",l.style.height=this.panelHeight+"px",l.style.display="inline",l.style.float="left",l.style.cssFloat="left",l.style.styleFloat="left",l.style.padding="2px",a.setElementTouchActionNone(l),a.setElementPointerEventsNone(l),this.element.appendChild(l),l.activePanel=!1,this.panels.push(l);e(this,"vertical"===this.scroll?p.y:p.x,0),this.setFocus(0)},a.ReferenceStrip.prototype={setFocus:function(b){var c,d=this.element.querySelector("#"+this.element.id+"-"+b),g=a.getElementSize(this.viewer.canvas),h=Number(this.element.style.width.replace("px","")),i=Number(this.element.style.height.replace("px","")),j=-Number(this.element.style.marginLeft.replace("px","")),k=-Number(this.element.style.marginTop.replace("px",""));this.currentSelected!==d&&(this.currentSelected&&(this.currentSelected.style.background="#000"),this.currentSelected=d,this.currentSelected.style.background="#999","horizontal"===this.scroll?(c=Number(b)*(this.panelWidth+3))>j+g.x-this.panelWidth?(c=Math.min(c,h-g.x),this.element.style.marginLeft=-c+"px",e(this,g.x,-c)):c<j&&(c=Math.max(0,c-g.x/2),this.element.style.marginLeft=-c+"px",e(this,g.x,-c)):(c=Number(b)*(this.panelHeight+3))>k+g.y-this.panelHeight?(c=Math.min(c,i-g.y),this.element.style.marginTop=-c+"px",e(this,g.y,-c)):c<k&&(c=Math.max(0,c-g.y/2),this.element.style.marginTop=-c+"px",e(this,g.y,-c)),this.currentPage=b,f.call(this,{eventSource:this.tracker}))},update:function(){return!!j[this.id].animating},destroy:function(){if(this.miniViewers)for(var a in this.miniViewers)this.miniViewers[a].destroy();this.tracker.destroy(),this.element&&this.viewer.removeControl(this.element)}}}(OpenSeadragon),function(a){a.DisplayRect=function(b,c,d,e,f,g){a.Rect.apply(this,[b,c,d,e]),this.minLevel=f,this.maxLevel=g},a.extend(a.DisplayRect.prototype,a.Rect.prototype)}(OpenSeadragon),function(a){a.Spring=function(b){var c=arguments;"object"!=typeof b&&(b={initial:c.length&&"number"==typeof c[0]?c[0]:void 0,springStiffness:1<c.length?c[1].springStiffness:5,animationTime:1<c.length?c[1].animationTime:1.5}),a.console.assert("number"==typeof b.springStiffness&&0!==b.springStiffness,"[OpenSeadragon.Spring] options.springStiffness must be a non-zero number"),a.console.assert("number"==typeof b.animationTime&&0<=b.animationTime,"[OpenSeadragon.Spring] options.animationTime must be a number greater than or equal to 0"),b.exponential&&(this._exponential=!0,delete b.exponential),a.extend(!0,this,b),this.current={value:"number"==typeof this.initial?this.initial:this._exponential?0:1,time:a.now()},a.console.assert(!this._exponential||0!==this.current.value,"[OpenSeadragon.Spring] value must be non-zero for exponential springs"),this.start={value:this.current.value,time:this.current.time},this.target={value:this.current.value,time:this.current.time},this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},a.Spring.prototype={resetTo:function(b){a.console.assert(!this._exponential||0!==b,"[OpenSeadragon.Spring.resetTo] target must be non-zero for exponential springs"),this.start.value=this.target.value=this.current.value=b,this.start.time=this.target.time=this.current.time=a.now(),this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},springTo:function(b){a.console.assert(!this._exponential||0!==b,"[OpenSeadragon.Spring.springTo] target must be non-zero for exponential springs"),this.start.value=this.current.value,this.start.time=this.current.time,this.target.value=b,this.target.time=this.start.time+1e3*this.animationTime,this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},shiftBy:function(b){this.start.value+=b,this.target.value+=b,this._exponential&&(a.console.assert(0!==this.target.value&&0!==this.start.value,"[OpenSeadragon.Spring.shiftBy] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},setExponential:function(b){this._exponential=b,this._exponential&&(a.console.assert(0!==this.current.value&&0!==this.target.value&&0!==this.start.value,"[OpenSeadragon.Spring.setExponential] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},update:function(){this.current.time=a.now();var b,c;this._exponential?(b=this.start._logValue,c=this.target._logValue):(b=this.start.value,c=this.target.value),d=this.current.time>=this.target.time?c:b+(c-b)*(e=this.springStiffness,d=(this.current.time-this.start.time)/(this.target.time-this.start.time),(1-Math.exp(e*-d))/(1-Math.exp(-e)));var d,e=this.current.value;return this._exponential?this.current.value=Math.exp(d):this.current.value=d,e!==this.current.value},isAtTargetValue:function(){return this.current.value===this.target.value}}}(OpenSeadragon),function(a){function b(b){a.extend(!0,this,{timeout:a.DEFAULT_SETTINGS.timeout,jobId:null},b),this.image=null}b.prototype={errorMsg:null,start:function(){var b=this,c=this.abort;this.image=new Image,this.image.onload=function(){b.finish(!0)},this.image.onabort=this.image.onerror=function(){b.errorMsg="Image load aborted",b.finish(!1)},this.jobId=window.setTimeout(function(){b.errorMsg="Image load exceeded timeout ("+b.timeout+" ms)",b.finish(!1)},this.timeout),this.loadWithAjax?(this.request=a.makeAjaxRequest({url:this.src,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,responseType:"arraybuffer",postData:this.postData,success:function(a){try{e=new window.Blob([a.response])}catch(c){var d=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;"TypeError"===c.name&&d&&(d=new d,d.append(a.response),e=d.getBlob())}0===e.size&&(b.errorMsg="Empty image response.",b.finish(!1));var e=(window.URL||window.webkitURL).createObjectURL(e);b.image.src=e},error:function(a){b.errorMsg="Image load aborted - XHR error: Ajax returned "+a.status,b.finish(!1)}}),this.abort=function(){b.request.abort(),"function"==typeof c&&c()}):(!1!==this.crossOriginPolicy&&(this.image.crossOrigin=this.crossOriginPolicy),this.image.src=this.src)},finish:function(a){this.image.onload=this.image.onerror=this.image.onabort=null,a||(this.image=null),this.jobId&&window.clearTimeout(this.jobId),this.callback(this)}},a.ImageLoader=function(b){a.extend(!0,this,{jobLimit:a.DEFAULT_SETTINGS.imageLoaderLimit,timeout:a.DEFAULT_SETTINGS.timeout,jobQueue:[],jobsInProgress:0},b)},a.ImageLoader.prototype={addJob:function(a){var c=this,d=new b({src:a.src,loadWithAjax:a.loadWithAjax,ajaxHeaders:a.loadWithAjax?a.ajaxHeaders:null,crossOriginPolicy:a.crossOriginPolicy,ajaxWithCredentials:a.ajaxWithCredentials,postData:a.postData,callback:function(b){!function(a,b,c){a.jobsInProgress--,(!a.jobLimit||a.jobsInProgress<a.jobLimit)&&0<a.jobQueue.length&&(a.jobQueue.shift().start(),a.jobsInProgress++),c(b.image,b.errorMsg,b.request)}(c,b,a.callback)},abort:a.abort,timeout:this.timeout});!this.jobLimit||this.jobsInProgress<this.jobLimit?(d.start(),this.jobsInProgress++):this.jobQueue.push(d)},clear:function(){for(var a=0;a<this.jobQueue.length;a++){var b=this.jobQueue[a];"function"==typeof b.abort&&b.abort()}this.jobQueue=[]}}}(OpenSeadragon),function(a){a.Tile=function(b,c,d,e,f,g,h,i,j,k,l,m){this.level=b,this.x=c,this.y=d,this.bounds=e,this.sourceBounds=k,this.exists=f,this.url=g,this.postData=l,this.context2D=h,this.loadWithAjax=i,this.ajaxHeaders=j,void 0===m&&(a.console.error("Tile constructor needs 'cacheKey' variable: creation tile cache in Tile class is deprecated. TileSource.prototype.getTileHashKey will be used."),m=a.TileSource.prototype.getTileHashKey(b,c,d,g,j,l)),this.cacheKey=m,this.loaded=!1,this.loading=!1,this.element=null,this.imgElement=null,this.image=null,this.style=null,this.position=null,this.size=null,this.flipped=!1,this.blendStart=null,this.opacity=null,this.squaredDistance=null,this.visibility=null,this.beingDrawn=!1,this.lastTouchTime=0,this.isRightMost=!1,this.isBottomMost=!1},a.Tile.prototype={toString:function(){return this.level+"/"+this.x+"_"+this.y},_hasTransparencyChannel:function(){return!!this.context2D||this.url.match(".png")},drawHTML:function(b){this.cacheImageRecord?this.loaded?(this.element||(this.element=a.makeNeutralElement("div"),this.imgElement=this.cacheImageRecord.getImage().cloneNode(),this.imgElement.style.msInterpolationMode="nearest-neighbor",this.imgElement.style.width="100%",this.imgElement.style.height="100%",this.style=this.element.style,this.style.position="absolute"),this.element.parentNode!==b&&b.appendChild(this.element),this.imgElement.parentNode!==this.element&&this.element.appendChild(this.imgElement),this.style.top=this.position.y+"px",this.style.left=this.position.x+"px",this.style.height=this.size.y+"px",this.style.width=this.size.x+"px",this.flipped&&(this.style.transform="scaleX(-1)"),a.setElementOpacity(this.element,this.opacity)):a.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString()):a.console.warn("[Tile.drawHTML] attempting to draw tile %s when it's not cached",this.toString())},drawCanvas:function(b,c,d,e,f){var g,h=this.position.times(a.pixelDensityRatio),i=this.size.times(a.pixelDensityRatio);if(this.context2D||this.cacheImageRecord)if(g=this.context2D||this.cacheImageRecord.getRenderedContext(),this.loaded&&g){b.save(),b.globalAlpha=this.opacity,"number"==typeof d&&1!==d&&(h=h.times(d),i=i.times(d)),e instanceof a.Point&&(h=h.plus(e)),1===b.globalAlpha&&this._hasTransparencyChannel()&&(f&&(h.x=Math.round(h.x),h.y=Math.round(h.y),i.x=Math.round(i.x),i.y=Math.round(i.y)),b.clearRect(h.x,h.y,i.x,i.y)),c({context:b,tile:this,rendered:g});var j,k;this.sourceBounds?(j=Math.min(this.sourceBounds.width,g.canvas.width),k=Math.min(this.sourceBounds.height,g.canvas.height)):(j=g.canvas.width,k=g.canvas.height),b.translate(h.x+i.x/2,0),this.flipped&&b.scale(-1,1),b.drawImage(g.canvas,0,0,j,k,-i.x/2,h.y,i.x,i.y),b.restore()}else a.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString());else a.console.warn("[Tile.drawCanvas] attempting to draw tile %s when it's not cached",this.toString())},getScaleForEdgeSmoothing:function(){var b;if(this.cacheImageRecord)b=this.cacheImageRecord.getRenderedContext();else{if(!this.context2D)return a.console.warn("[Tile.drawCanvas] attempting to get tile scale %s when tile's not cached",this.toString()),1;b=this.context2D}return b.canvas.width/(this.size.x*a.pixelDensityRatio)},getTranslationForEdgeSmoothing:function(b,c,d){var e=Math.max(1,Math.ceil((d.x-c.x)/2));return c=Math.max(1,Math.ceil((d.y-c.y)/2)),new a.Point(e,c).minus(this.position.times(a.pixelDensityRatio).times(b||1).apply(function(a){return a%1}))},unload:function(){this.imgElement&&this.imgElement.parentNode&&this.imgElement.parentNode.removeChild(this.imgElement),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=null,this.imgElement=null,this.loaded=!1,this.loading=!1}}}(OpenSeadragon),function(a){a.OverlayPlacement=a.Placement,a.OverlayRotationMode=a.freezeObject({NO_ROTATION:1,EXACT:2,BOUNDING_BOX:3}),a.Overlay=function(b,c,d){d=a.isPlainObject(b)?b:{element:b,location:c,placement:d},this.element=d.element,this.style=d.element.style,this._init(d)},a.Overlay.prototype={_init:function(b){this.location=b.location,this.placement=void 0===b.placement?a.Placement.TOP_LEFT:b.placement,this.onDraw=b.onDraw,this.checkResize=void 0===b.checkResize||b.checkResize,this.width=void 0===b.width?null:b.width,this.height=void 0===b.height?null:b.height,this.rotationMode=b.rotationMode||a.OverlayRotationMode.EXACT,this.location instanceof a.Rect&&(this.width=this.location.width,this.height=this.location.height,this.location=this.location.getTopLeft(),this.placement=a.Placement.TOP_LEFT),this.scales=null!==this.width&&null!==this.height,this.bounds=new a.Rect(this.location.x,this.location.y,this.width,this.height),this.position=this.location},adjust:function(b,c){var d=a.Placement.properties[this.placement];d&&(d.isHorizontallyCentered?b.x-=c.x/2:d.isRight&&(b.x-=c.x),d.isVerticallyCentered?b.y-=c.y/2:d.isBottom&&(b.y-=c.y))},destroy:function(){var b=this.element,c=this.style;b.parentNode&&(b.parentNode.removeChild(b),b.prevElementParent&&(c.display="none",document.body.appendChild(b))),this.onDraw=null,c.top="",c.left="",c.position="",null!==this.width&&(c.width=""),null!==this.height&&(c.height="");var d=a.getCssPropertyWithVendorPrefix("transformOrigin");b=a.getCssPropertyWithVendorPrefix("transform"),d&&b&&(c[d]="",c[b]="")},drawHTML:function(b,c){var d=this.element;d.parentNode!==b&&(d.prevElementParent=d.parentNode,d.prevNextSibling=d.nextSibling,b.appendChild(d),this.style.position="absolute",this.size=a.getElementSize(d));var e=this._getOverlayPositionAndSize(c);b=e.position,d=this.size=e.size,c=e.rotate,this.onDraw?this.onDraw(b,d,this.element):(e=this.style,e.left=b.x+"px",e.top=b.y+"px",null!==this.width&&(e.width=d.x+"px"),null!==this.height&&(e.height=d.y+"px"),b=a.getCssPropertyWithVendorPrefix("transformOrigin"),d=a.getCssPropertyWithVendorPrefix("transform"),b&&d&&(c?(e[b]=this._getTransformOrigin(),e[d]="rotate("+c+"deg)"):(e[b]="",e[d]="")),e.display="block")},_getOverlayPositionAndSize:function(b){var c=b.pixelFromPoint(this.location,!0),d=this._getSizeInPixels(b);this.adjust(c,d);var e=0;if(b.degrees&&this.rotationMode!==a.OverlayRotationMode.NO_ROTATION)if(this.rotationMode===a.OverlayRotationMode.BOUNDING_BOX&&null!==this.width&&null!==this.height){var f=new a.Rect(c.x,c.y,d.x,d.y);f=this._getBoundingBox(f,b.degrees),c=f.getTopLeft(),d=f.getSize()}else e=b.degrees;return{position:c,size:d,rotate:e}},_getSizeInPixels:function(b){var c=this.size.x,d=this.size.y;if(null!==this.width||null!==this.height){var e=b.deltaPixelsFromPointsNoRotate(new a.Point(this.width||0,this.height||0),!0);null!==this.width&&(c=e.x),null!==this.height&&(d=e.y)}return!this.checkResize||null!==this.width&&null!==this.height||(e=this.size=a.getElementSize(this.element),null===this.width&&(c=e.x),null===this.height&&(d=e.y)),new a.Point(c,d)},_getBoundingBox:function(a,b){var c=this._getPlacementPoint(a);return a.rotate(b,c).getBoundingBox()},_getPlacementPoint:function(b){var c=new a.Point(b.x,b.y),d=a.Placement.properties[this.placement];return d&&(d.isHorizontallyCentered?c.x+=b.width/2:d.isRight&&(c.x+=b.width),d.isVerticallyCentered?c.y+=b.height/2:d.isBottom&&(c.y+=b.height)),c},_getTransformOrigin:function(){var b="",c=a.Placement.properties[this.placement];return c?(c.isLeft?b="left":c.isRight&&(b="right"),c.isTop?b+=" top":c.isBottom&&(b+=" bottom"),b):b},update:function(b,c){c=a.isPlainObject(b)?b:{location:b,placement:c},this._init({location:c.location||this.location,placement:(void 0!==c.placement?c:this).placement,onDraw:c.onDraw||this.onDraw,checkResize:c.checkResize||this.checkResize,width:(void 0!==c.width?c:this).width,height:(void 0!==c.height?c:this).height,rotationMode:c.rotationMode||this.rotationMode})},getBounds:function(b){a.console.assert(b,"A viewport must now be passed to Overlay.getBounds.");var c=this.width,d=this.height;if(null===c||null===d){var e=b.deltaPointsFromPixelsNoRotate(this.size,!0);null===c&&(c=e.x),null===d&&(d=e.y)}return e=this.location.clone(),this.adjust(e,new a.Point(c,d)),this._adjustBoundsForRotation(b,new a.Rect(e.x,e.y,c,d))},_adjustBoundsForRotation:function(b,c){return b&&0!==b.degrees&&this.rotationMode!==a.OverlayRotationMode.EXACT?this.rotationMode!==a.OverlayRotationMode.BOUNDING_BOX?c.rotate(-b.degrees,this._getPlacementPoint(c)):null===this.width||null===this.height?c:(c=this._getOverlayPositionAndSize(b),b.viewerElementToViewportRectangle(new a.Rect(c.position.x,c.position.y,c.size.x,c.size.y))):c}}}(OpenSeadragon),function(a){a.Drawer=function(b){a.console.assert(b.viewer,"[Drawer] options.viewer is required");var c=arguments;a.isPlainObject(b)||(b={source:c[0],viewport:c[1],element:c[2]}),a.console.assert(b.viewport,"[Drawer] options.viewport is required"),a.console.assert(b.element,"[Drawer] options.element is required"),b.source&&a.console.error("[Drawer] options.source is no longer accepted; use TiledImage instead"),this.viewer=b.viewer,this.viewport=b.viewport,this.debugGridColor="string"==typeof b.debugGridColor?[b.debugGridColor]:b.debugGridColor||a.DEFAULT_SETTINGS.debugGridColor,b.opacity&&a.console.error("[Drawer] options.opacity is no longer accepted; set the opacity on the TiledImage instead"),this.useCanvas=a.supportsCanvas&&(!this.viewer||this.viewer.useCanvas),this.container=a.getElement(b.element),this.canvas=a.makeNeutralElement(this.useCanvas?"canvas":"div"),this.context=this.useCanvas?this.canvas.getContext("2d"):null,this.sketchCanvas=null,this.sketchContext=null,this.element=this.container,this.container.dir="ltr",this.useCanvas&&(c=this._calculateCanvasSize(),this.canvas.width=c.x,this.canvas.height=c.y),this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.position="absolute",a.setElementOpacity(this.canvas,this.opacity,!0),a.setElementPointerEventsNone(this.canvas),a.setElementTouchActionNone(this.canvas),this.container.style.textAlign="left",this.container.appendChild(this.canvas),this._imageSmoothingEnabled=!0},a.Drawer.prototype={addOverlay:function(b,c,d,e){return a.console.error("drawer.addOverlay is deprecated. Use viewer.addOverlay instead."),this.viewer.addOverlay(b,c,d,e),this},updateOverlay:function(b,c,d){return a.console.error("drawer.updateOverlay is deprecated. Use viewer.updateOverlay instead."),this.viewer.updateOverlay(b,c,d),this},removeOverlay:function(b){return a.console.error("drawer.removeOverlay is deprecated. Use viewer.removeOverlay instead."),this.viewer.removeOverlay(b),this},clearOverlays:function(){return a.console.error("drawer.clearOverlays is deprecated. Use viewer.clearOverlays instead."),this.viewer.clearOverlays(),this},
viewportCoordToDrawerCoord:function(b){return b=this.viewport.pixelFromPointNoRotate(b,!0),new a.Point(b.x*a.pixelDensityRatio,b.y*a.pixelDensityRatio)},clipWithPolygons:function(a,b){if(this.useCanvas){var c=this._getContext(b);c.beginPath(),a.forEach(function(a){a.forEach(function(a,b){c[0===b?"moveTo":"lineTo"](a.x,a.y)})}),c.clip()}},setOpacity:function(b){a.console.error("drawer.setOpacity is deprecated. Use tiledImage.setOpacity instead.");for(var c=this.viewer.world,d=0;d<c.getItemCount();d++)c.getItemAt(d).setOpacity(b);return this},getOpacity:function(){a.console.error("drawer.getOpacity is deprecated. Use tiledImage.getOpacity instead.");for(var b=this.viewer.world,c=0,d=0;d<b.getItemCount();d++){var e=b.getItemAt(d).getOpacity();c<e&&(c=e)}return c},needsUpdate:function(){return a.console.error("[Drawer.needsUpdate] this function is deprecated. Use World.needsDraw instead."),this.viewer.world.needsDraw()},numTilesLoaded:function(){return a.console.error("[Drawer.numTilesLoaded] this function is deprecated. Use TileCache.numTilesLoaded instead."),this.viewer.tileCache.numTilesLoaded()},reset:function(){return a.console.error("[Drawer.reset] this function is deprecated. Use World.resetItems instead."),this.viewer.world.resetItems(),this},update:function(){return a.console.error("[Drawer.update] this function is deprecated. Use Drawer.clear and World.draw instead."),this.clear(),this.viewer.world.draw(),this},canRotate:function(){return this.useCanvas},destroy:function(){this.canvas.width=1,this.canvas.height=1,this.sketchCanvas=null,this.sketchContext=null},clear:function(){if(this.canvas.innerHTML="",this.useCanvas){var a=this._calculateCanvasSize();this.canvas.width===a.x&&this.canvas.height===a.y||(this.canvas.width=a.x,this.canvas.height=a.y,this._updateImageSmoothingEnabled(this.context),null!==this.sketchCanvas&&(a=this._calculateSketchCanvasSize(),this.sketchCanvas.width=a.x,this.sketchCanvas.height=a.y,this._updateImageSmoothingEnabled(this.sketchContext))),this._clear()}},_clear:function(a,b){this.useCanvas&&(a=this._getContext(a),b?a.clearRect(b.x,b.y,b.width,b.height):(b=a.canvas,a.clearRect(0,0,b.width,b.height)))},viewportToDrawerRectangle:function(b){var c=this.viewport.pixelFromPointNoRotate(b.getTopLeft(),!0);return b=this.viewport.deltaPixelsFromPointsNoRotate(b.getSize(),!0),new a.Rect(c.x*a.pixelDensityRatio,c.y*a.pixelDensityRatio,b.x*a.pixelDensityRatio,b.y*a.pixelDensityRatio)},drawTile:function(b,c,d,e,f,g){a.console.assert(b,"[Drawer.drawTile] tile is required"),a.console.assert(c,"[Drawer.drawTile] drawingHandler is required"),this.useCanvas?(d=this._getContext(d),b.drawCanvas(d,c,e=e||1,f,g)):b.drawHTML(this.canvas)},_getContext:function(a){var b=this.context;if(a){if(null===this.sketchCanvas){if(this.sketchCanvas=document.createElement("canvas"),a=this._calculateSketchCanvasSize(),this.sketchCanvas.width=a.x,this.sketchCanvas.height=a.y,this.sketchContext=this.sketchCanvas.getContext("2d"),0===this.viewport.getRotation()){var c=this;this.viewer.addHandler("rotate",function a(){if(0!==c.viewport.getRotation()){c.viewer.removeHandler("rotate",a);var b=c._calculateSketchCanvasSize();c.sketchCanvas.width=b.x,c.sketchCanvas.height=b.y}})}this._updateImageSmoothingEnabled(this.sketchContext)}b=this.sketchContext}return b},saveContext:function(a){this.useCanvas&&this._getContext(a).save()},restoreContext:function(a){this.useCanvas&&this._getContext(a).restore()},setClip:function(a,b){this.useCanvas&&(b=this._getContext(b),b.beginPath(),b.rect(a.x,a.y,a.width,a.height),b.clip())},drawRectangle:function(a,b,c){this.useCanvas&&(c=this._getContext(c),c.save(),c.fillStyle=b,c.fillRect(a.x,a.y,a.width,a.height),c.restore())},blendSketch:function(b,c,d,e){var f=b;if(a.isPlainObject(f)||(f={opacity:b,scale:c,translate:d,compositeOperation:e}),this.useCanvas&&this.sketchCanvas){b=f.opacity,e=f.compositeOperation;var g=f.bounds;this.context.save(),this.context.globalAlpha=b,e&&(this.context.globalCompositeOperation=e),g?(g.x<0&&(g.width+=g.x,g.x=0),g.x+g.width>this.canvas.width&&(g.width=this.canvas.width-g.x),g.y<0&&(g.height+=g.y,g.y=0),g.y+g.height>this.canvas.height&&(g.height=this.canvas.height-g.y),this.context.drawImage(this.sketchCanvas,g.x,g.y,g.width,g.height,g.x,g.y,g.width,g.height)):(c=f.scale||1,b=(d=f.translate)instanceof a.Point?d:new a.Point(0,0),e=0,g=0,d&&(f=this.sketchCanvas.width-this.canvas.width,d=this.sketchCanvas.height-this.canvas.height,e=Math.round(f/2),g=Math.round(d/2)),this.context.drawImage(this.sketchCanvas,b.x-e*c,b.y-g*c,(this.canvas.width+2*e)*c,(this.canvas.height+2*g)*c,-e,-g,this.canvas.width+2*e,this.canvas.height+2*g)),this.context.restore()}},drawDebugInfo:function(b,c,d,e){if(this.useCanvas){var f=this.viewer.world.getIndexOfItem(e)%this.debugGridColor.length,g=this.context;g.save(),g.lineWidth=2*a.pixelDensityRatio,g.font="small-caps bold "+13*a.pixelDensityRatio+"px arial",g.strokeStyle=this.debugGridColor[f],g.fillStyle=this.debugGridColor[f],0!==this.viewport.degrees&&this._offsetForRotation({degrees:this.viewport.degrees}),e.getRotation(!0)%360!=0&&this._offsetForRotation({degrees:e.getRotation(!0),point:e.viewport.pixelFromPointNoRotate(e._getRotationPoint(!0),!0)}),0===e.viewport.degrees&&e.getRotation(!0)%360==0&&e._drawer.viewer.viewport.getFlip()&&e._drawer._flip(),g.strokeRect(b.position.x*a.pixelDensityRatio,b.position.y*a.pixelDensityRatio,b.size.x*a.pixelDensityRatio,b.size.y*a.pixelDensityRatio);var h=(b.position.x+b.size.x/2)*a.pixelDensityRatio;f=(b.position.y+b.size.y/2)*a.pixelDensityRatio,g.translate(h,f),g.rotate(Math.PI/180*-this.viewport.degrees),g.translate(-h,-f),0===b.x&&0===b.y&&(g.fillText("Zoom: "+this.viewport.getZoom(),b.position.x*a.pixelDensityRatio,(b.position.y-30)*a.pixelDensityRatio),g.fillText("Pan: "+this.viewport.getBounds().toString(),b.position.x*a.pixelDensityRatio,(b.position.y-20)*a.pixelDensityRatio)),g.fillText("Level: "+b.level,(b.position.x+10)*a.pixelDensityRatio,(b.position.y+20)*a.pixelDensityRatio),g.fillText("Column: "+b.x,(b.position.x+10)*a.pixelDensityRatio,(b.position.y+30)*a.pixelDensityRatio),g.fillText("Row: "+b.y,(b.position.x+10)*a.pixelDensityRatio,(b.position.y+40)*a.pixelDensityRatio),g.fillText("Order: "+d+" of "+c,(b.position.x+10)*a.pixelDensityRatio,(b.position.y+50)*a.pixelDensityRatio),g.fillText("Size: "+b.size.toString(),(b.position.x+10)*a.pixelDensityRatio,(b.position.y+60)*a.pixelDensityRatio),g.fillText("Position: "+b.position.toString(),(b.position.x+10)*a.pixelDensityRatio,(b.position.y+70)*a.pixelDensityRatio),0!==this.viewport.degrees&&this._restoreRotationChanges(),e.getRotation(!0)%360!=0&&this._restoreRotationChanges(),0===e.viewport.degrees&&e.getRotation(!0)%360==0&&e._drawer.viewer.viewport.getFlip()&&e._drawer._flip(),g.restore()}},debugRect:function(b){if(this.useCanvas){var c=this.context;c.save(),c.lineWidth=2*a.pixelDensityRatio,c.strokeStyle=this.debugGridColor[0],c.fillStyle=this.debugGridColor[0],c.strokeRect(b.x*a.pixelDensityRatio,b.y*a.pixelDensityRatio,b.width*a.pixelDensityRatio,b.height*a.pixelDensityRatio),c.restore()}},setImageSmoothingEnabled:function(a){this.useCanvas&&(this._imageSmoothingEnabled=a,this._updateImageSmoothingEnabled(this.context),this.viewer.forceRedraw())},_updateImageSmoothingEnabled:function(a){a.msImageSmoothingEnabled=this._imageSmoothingEnabled,a.imageSmoothingEnabled=this._imageSmoothingEnabled},getCanvasSize:function(b){return b=this._getContext(b).canvas,new a.Point(b.width,b.height)},getCanvasCenter:function(){return new a.Point(this.canvas.width/2,this.canvas.height/2)},_offsetForRotation:function(b){var c=b.point?b.point.times(a.pixelDensityRatio):this.getCanvasCenter(),d=this._getContext(b.useSketch);d.save(),d.translate(c.x,c.y),this.viewer.viewport.flipped?(d.rotate(Math.PI/180*-b.degrees),d.scale(-1,1)):d.rotate(Math.PI/180*b.degrees),d.translate(-c.x,-c.y)},_flip:function(b){var c=(b=b||{}).point?b.point.times(a.pixelDensityRatio):this.getCanvasCenter();b=this._getContext(b.useSketch),b.translate(c.x,0),b.scale(-1,1),b.translate(-c.x,0)},_restoreRotationChanges:function(a){this._getContext(a).restore()},_calculateCanvasSize:function(){var b=a.pixelDensityRatio,c=this.viewport.getContainerSize();return{x:Math.round(c.x*b),y:Math.round(c.y*b)}},_calculateSketchCanvasSize:function(){var a=this._calculateCanvasSize();return 0===this.viewport.getRotation()?a:(a=Math.ceil(Math.sqrt(a.x*a.x+a.y*a.y)),{x:a,y:a})}}}(OpenSeadragon),function(a){a.Viewport=function(b){var c=arguments;(b=c.length&&c[0]instanceof a.Point?{containerSize:c[0],contentSize:c[1],config:c[2]}:b).config&&(a.extend(!0,b,b.config),delete b.config),this._margins=a.extend({left:0,top:0,right:0,bottom:0},b.margins||{}),delete b.margins,a.extend(!0,this,{containerSize:null,contentSize:null,zoomPoint:null,viewer:null,springStiffness:a.DEFAULT_SETTINGS.springStiffness,animationTime:a.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:a.DEFAULT_SETTINGS.minZoomImageRatio,maxZoomPixelRatio:a.DEFAULT_SETTINGS.maxZoomPixelRatio,visibilityRatio:a.DEFAULT_SETTINGS.visibilityRatio,wrapHorizontal:a.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:a.DEFAULT_SETTINGS.wrapVertical,defaultZoomLevel:a.DEFAULT_SETTINGS.defaultZoomLevel,minZoomLevel:a.DEFAULT_SETTINGS.minZoomLevel,maxZoomLevel:a.DEFAULT_SETTINGS.maxZoomLevel,degrees:a.DEFAULT_SETTINGS.degrees,flipped:a.DEFAULT_SETTINGS.flipped,homeFillsViewer:a.DEFAULT_SETTINGS.homeFillsViewer,silenceMultiImageWarnings:a.DEFAULT_SETTINGS.silenceMultiImageWarnings},b),this._updateContainerInnerSize(),this.centerSpringX=new a.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.centerSpringY=new a.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.zoomSpring=new a.Spring({exponential:!0,initial:1,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,this._setContentBounds(new a.Rect(0,0,1,1),1),this.goHome(!0),this.update()},a.Viewport.prototype={resetContentSize:function(b){return a.console.assert(b,"[Viewport.resetContentSize] contentSize is required"),a.console.assert(b instanceof a.Point,"[Viewport.resetContentSize] contentSize must be an OpenSeadragon.Point"),a.console.assert(0<b.x,"[Viewport.resetContentSize] contentSize.x must be greater than 0"),a.console.assert(0<b.y,"[Viewport.resetContentSize] contentSize.y must be greater than 0"),this._setContentBounds(new a.Rect(0,0,1,b.y/b.x),b.x),this},setHomeBounds:function(b,c){a.console.error("[Viewport.setHomeBounds] this function is deprecated; The content bounds should not be set manually."),this._setContentBounds(b,c)},_setContentBounds:function(b,c){a.console.assert(b,"[Viewport._setContentBounds] bounds is required"),a.console.assert(b instanceof a.Rect,"[Viewport._setContentBounds] bounds must be an OpenSeadragon.Rect"),a.console.assert(0<b.width,"[Viewport._setContentBounds] bounds.width must be greater than 0"),a.console.assert(0<b.height,"[Viewport._setContentBounds] bounds.height must be greater than 0"),this._contentBoundsNoRotate=b.clone(),this._contentSizeNoRotate=this._contentBoundsNoRotate.getSize().times(c),this._contentBounds=b.rotate(this.degrees).getBoundingBox(),this._contentSize=this._contentBounds.getSize().times(c),this._contentAspectRatio=this._contentSize.x/this._contentSize.y,this.viewer&&this.viewer.raiseEvent("reset-size",{contentSize:this._contentSizeNoRotate.clone(),contentFactor:c,homeBounds:this._contentBoundsNoRotate.clone(),contentBounds:this._contentBounds.clone()})},getHomeZoom:function(){if(this.defaultZoomLevel)return this.defaultZoomLevel;var a=this._contentAspectRatio/this.getAspectRatio();return(this.homeFillsViewer?1<=a?a:1:1<=a?1:a)/this._contentBounds.width},getHomeBounds:function(){return this.getHomeBoundsNoRotate().rotate(-this.getRotation())},getHomeBoundsNoRotate:function(){var b=this._contentBounds.getCenter(),c=1/this.getHomeZoom(),d=c/this.getAspectRatio();return new a.Rect(b.x-c/2,b.y-d/2,c,d)},goHome:function(a){return this.viewer&&this.viewer.raiseEvent("home",{immediately:a}),this.fitBounds(this.getHomeBounds(),a)},getMinZoom:function(){var a=this.getHomeZoom();return this.minZoomLevel||this.minZoomImageRatio*a},getMaxZoom:function(){var a=this.maxZoomLevel;return a||(a=this._contentSize.x*this.maxZoomPixelRatio/this._containerInnerSize.x,a/=this._contentBounds.width),Math.max(a,this.getHomeZoom())},getAspectRatio:function(){return this._containerInnerSize.x/this._containerInnerSize.y},getContainerSize:function(){return new a.Point(this.containerSize.x,this.containerSize.y)},getMargins:function(){return a.extend({},this._margins)},setMargins:function(b){a.console.assert("object"===a.type(b),"[Viewport.setMargins] margins must be an object"),this._margins=a.extend({left:0,top:0,right:0,bottom:0},b),this._updateContainerInnerSize(),this.viewer&&this.viewer.forceRedraw()},getBounds:function(a){return this.getBoundsNoRotate(a).rotate(-this.getRotation())},getBoundsNoRotate:function(b){var c=this.getCenter(b),d=1/this.getZoom(b);return b=d/this.getAspectRatio(),new a.Rect(c.x-d/2,c.y-b/2,d,b)},getBoundsWithMargins:function(a){return this.getBoundsNoRotateWithMargins(a).rotate(-this.getRotation(),this.getCenter(a))},getBoundsNoRotateWithMargins:function(a){var b=this.getBoundsNoRotate(a);return a=this._containerInnerSize.x*this.getZoom(a),b.x-=this._margins.left/a,b.y-=this._margins.top/a,b.width+=(this._margins.left+this._margins.right)/a,b.height+=(this._margins.top+this._margins.bottom)/a,b},getCenter:function(b){var c,d,e,f=new a.Point(this.centerSpringX.current.value,this.centerSpringY.current.value),g=new a.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return b?f:this.zoomPoint?(c=this.pixelFromPoint(this.zoomPoint,!0),b=(d=1/(e=this.getZoom()))/this.getAspectRatio(),b=new a.Rect(f.x-d/2,f.y-b/2,d,b),e=this._pixelFromPoint(this.zoomPoint,b).minus(c).divide(this._containerInnerSize.x*e),g.plus(e)):g},getZoom:function(a){return(a?this.zoomSpring.current:this.zoomSpring.target).value},_applyZoomConstraints:function(a){return Math.max(Math.min(a,this.getMaxZoom()),this.getMinZoom())},_applyBoundaryConstraints:function(b){if(b=new a.Rect(b.x,b.y,b.width,b.height),!this.wrapHorizontal){var c=this.visibilityRatio*b.width,d=b.x+b.width,e=this._contentBoundsNoRotate.x+this._contentBoundsNoRotate.width;d=this._contentBoundsNoRotate.x-d+c,e=e-b.x-c,c>this._contentBoundsNoRotate.width?b.x+=(d+e)/2:e<0?b.x+=e:0<d&&(b.x+=d)}return this.wrapVertical||(c=this.visibilityRatio*b.height,e=b.y+b.height,d=this._contentBoundsNoRotate.y+this._contentBoundsNoRotate.height,e=this._contentBoundsNoRotate.y-e+c,d=d-b.y-c,c>this._contentBoundsNoRotate.height?b.y+=(e+d)/2:d<0?b.y+=d:0<e&&(b.y+=e)),b},_raiseConstraintsEvent:function(a){this.viewer&&this.viewer.raiseEvent("constrain",{immediately:a})},applyConstraints:function(a){var b=this.getZoom(),c=this._applyZoomConstraints(b);return b!==c&&this.zoomTo(c,this.zoomPoint,a),b=this.getBoundsNoRotate(),c=this._applyBoundaryConstraints(b),this._raiseConstraintsEvent(a),b.x===c.x&&b.y===c.y&&!a||this.fitBounds(c.rotate(-this.getRotation()),a),this},ensureVisible:function(a){return this.applyConstraints(a)},_fitBounds:function(b,c){var d=(c=c||{}).immediately||!1,e=c.constraints||!1,f=this.getAspectRatio();if(c=b.getCenter(),b=new a.Rect(b.x,b.y,b.width,b.height,b.degrees+this.getRotation()).getBoundingBox(),b.getAspectRatio()>=f?b.height=b.width/f:b.width=b.height*f,b.x=c.x-b.width/2,b.y=c.y-b.height/2,f=1/b.width,e){var g=b.getAspectRatio(),h=this._applyZoomConstraints(f);f!==h&&(b.width=1/(f=h),b.x=c.x-b.width/2,b.height=b.width/g,b.y=c.y-b.height/2),c=(b=this._applyBoundaryConstraints(b)).getCenter(),this._raiseConstraintsEvent(d)}return d?(this.panTo(c,!0),this.zoomTo(f,null,!0)):(this.panTo(this.getCenter(!0),!0),this.zoomTo(this.getZoom(!0),null,!0),h=this.getBounds(),0===(g=this.getZoom())||Math.abs(f/g-1)<1e-8?(this.zoomTo(f,!0),this.panTo(c,d)):(g=(b=b.rotate(-this.getRotation())).getTopLeft().times(f).minus(h.getTopLeft().times(g)).divide(f-g),this.zoomTo(f,g,d)))},fitBounds:function(a,b){return this._fitBounds(a,{immediately:b,constraints:!1})},fitBoundsWithConstraints:function(a,b){return this._fitBounds(a,{immediately:b,constraints:!0})},fitVertically:function(b){var c=new a.Rect(this._contentBounds.x+this._contentBounds.width/2,this._contentBounds.y,0,this._contentBounds.height);return this.fitBounds(c,b)},fitHorizontally:function(b){var c=new a.Rect(this._contentBounds.x,this._contentBounds.y+this._contentBounds.height/2,this._contentBounds.width,0);return this.fitBounds(c,b)},getConstrainedBounds:function(a){return a=this.getBounds(a),this._applyBoundaryConstraints(a)},panBy:function(b,c){var d=new a.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return this.panTo(d.plus(b),c)},panTo:function(a,b){return b?(this.centerSpringX.resetTo(a.x),this.centerSpringY.resetTo(a.y)):(this.centerSpringX.springTo(a.x),this.centerSpringY.springTo(a.y)),this.viewer&&this.viewer.raiseEvent("pan",{center:a,immediately:b}),this},zoomBy:function(a,b,c){return this.zoomTo(this.zoomSpring.target.value*a,b,c)},zoomTo:function(b,c,d){var e=this;return this.zoomPoint=c instanceof a.Point&&!isNaN(c.x)&&!isNaN(c.y)?c:null,d?this._adjustCenterSpringsForZoomPoint(function(){e.zoomSpring.resetTo(b)}):this.zoomSpring.springTo(b),this.viewer&&this.viewer.raiseEvent("zoom",{zoom:b,refPoint:c,immediately:d}),this},setRotation:function(b){return this.viewer&&this.viewer.drawer.canRotate()?(this.degrees=a.positiveModulo(b,360),this._setContentBounds(this.viewer.world.getHomeBounds(),this.viewer.world.getContentFactor()),this.viewer.forceRedraw(),this.viewer.raiseEvent("rotate",{degrees:b}),this):this},getRotation:function(){return this.degrees},resize:function(a,b){var c,d=this.getBoundsNoRotate(),e=d;return this.containerSize.x=a.x,this.containerSize.y=a.y,this._updateContainerInnerSize(),b&&(c=a.x/this.containerSize.x,e.width=d.width*c,e.height=e.width/this.getAspectRatio()),this.viewer&&this.viewer.raiseEvent("resize",{newContainerSize:a,maintain:b}),this.fitBounds(e,!0)},_updateContainerInnerSize:function(){this._containerInnerSize=new a.Point(Math.max(1,this.containerSize.x-(this._margins.left+this._margins.right)),Math.max(1,this.containerSize.y-(this._margins.top+this._margins.bottom)))},update:function(){var a=this;this._adjustCenterSpringsForZoomPoint(function(){a.zoomSpring.update()}),this.centerSpringX.update(),this.centerSpringY.update();var b=this.centerSpringX.current.value!==this._oldCenterX||this.centerSpringY.current.value!==this._oldCenterY||this.zoomSpring.current.value!==this._oldZoom;return this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,b},_adjustCenterSpringsForZoomPoint:function(a){if(this.zoomPoint){var b=this.pixelFromPoint(this.zoomPoint,!0);a(),b=this.pixelFromPoint(this.zoomPoint,!0).minus(b),b=this.deltaPointsFromPixels(b,!0),this.centerSpringX.shiftBy(b.x),this.centerSpringY.shiftBy(b.y),this.zoomSpring.isAtTargetValue()&&(this.zoomPoint=null)}else a()},deltaPixelsFromPointsNoRotate:function(a,b){return a.times(this._containerInnerSize.x*this.getZoom(b))},deltaPixelsFromPoints:function(a,b){return this.deltaPixelsFromPointsNoRotate(a.rotate(this.getRotation()),b)},deltaPointsFromPixelsNoRotate:function(a,b){return a.divide(this._containerInnerSize.x*this.getZoom(b))},deltaPointsFromPixels:function(a,b){return this.deltaPointsFromPixelsNoRotate(a,b).rotate(-this.getRotation())},pixelFromPointNoRotate:function(a,b){return this._pixelFromPointNoRotate(a,this.getBoundsNoRotate(b))},pixelFromPoint:function(a,b){return this._pixelFromPoint(a,this.getBoundsNoRotate(b))},_pixelFromPointNoRotate:function(b,c){return b.minus(c.getTopLeft()).times(this._containerInnerSize.x/c.width).plus(new a.Point(this._margins.left,this._margins.top))},_pixelFromPoint:function(a,b){return this._pixelFromPointNoRotate(a.rotate(this.getRotation(),this.getCenter(!0)),b)},pointFromPixelNoRotate:function(b,c){return c=this.getBoundsNoRotate(c),b.minus(new a.Point(this._margins.left,this._margins.top)).divide(this._containerInnerSize.x/c.width).plus(c.getTopLeft())},pointFromPixel:function(a,b){return this.pointFromPixelNoRotate(a,b).rotate(-this.getRotation(),this.getCenter(!0))},_viewportToImageDelta:function(b,c){var d=this._contentBoundsNoRotate.width;return new a.Point(b*this._contentSizeNoRotate.x/d,c*this._contentSizeNoRotate.x/d)},viewportToImageCoordinates:function(b,c){if(b instanceof a.Point)return this.viewportToImageCoordinates(b.x,b.y);if(this.viewer){var d=this.viewer.world.getItemCount();if(1<d)this.silenceMultiImageWarnings||a.console.error("[Viewport.viewportToImageCoordinates] is not accurate with multi-image; use TiledImage.viewportToImageCoordinates instead.");else if(1===d)return this.viewer.world.getItemAt(0).viewportToImageCoordinates(b,c,!0)}return this._viewportToImageDelta(b-this._contentBoundsNoRotate.x,c-this._contentBoundsNoRotate.y)},_imageToViewportDelta:function(b,c){var d=this._contentBoundsNoRotate.width;return new a.Point(b/this._contentSizeNoRotate.x*d,c/this._contentSizeNoRotate.x*d)},imageToViewportCoordinates:function(b,c){if(b instanceof a.Point)return this.imageToViewportCoordinates(b.x,b.y);if(this.viewer){var d=this.viewer.world.getItemCount();if(1<d)this.silenceMultiImageWarnings||a.console.error("[Viewport.imageToViewportCoordinates] is not accurate with multi-image; use TiledImage.imageToViewportCoordinates instead.");else if(1===d)return this.viewer.world.getItemAt(0).imageToViewportCoordinates(b,c,!0)}return c=this._imageToViewportDelta(b,c),c.x+=this._contentBoundsNoRotate.x,c.y+=this._contentBoundsNoRotate.y,c},imageToViewportRectangle:function(b,c,d,e){var f=b;if(f instanceof a.Rect||(f=new a.Rect(b,c,d,e)),this.viewer){var g=this.viewer.world.getItemCount();if(1<g)this.silenceMultiImageWarnings||a.console.error("[Viewport.imageToViewportRectangle] is not accurate with multi-image; use TiledImage.imageToViewportRectangle instead.");else if(1===g)return this.viewer.world.getItemAt(0).imageToViewportRectangle(b,c,d,e,!0)}return d=this.imageToViewportCoordinates(f.x,f.y),e=this._imageToViewportDelta(f.width,f.height),new a.Rect(d.x,d.y,e.x,e.y,f.degrees)},viewportToImageRectangle:function(b,c,d,e){var f=b;if(f instanceof a.Rect||(f=new a.Rect(b,c,d,e)),this.viewer){var g=this.viewer.world.getItemCount();if(1<g)this.silenceMultiImageWarnings||a.console.error("[Viewport.viewportToImageRectangle] is not accurate with multi-image; use TiledImage.viewportToImageRectangle instead.");else if(1===g)return this.viewer.world.getItemAt(0).viewportToImageRectangle(b,c,d,e,!0)}return d=this.viewportToImageCoordinates(f.x,f.y),e=this._viewportToImageDelta(f.width,f.height),new a.Rect(d.x,d.y,e.x,e.y,f.degrees)},viewerElementToImageCoordinates:function(a){return a=this.pointFromPixel(a,!0),this.viewportToImageCoordinates(a)},imageToViewerElementCoordinates:function(a){return a=this.imageToViewportCoordinates(a),this.pixelFromPoint(a,!0)},windowToImageCoordinates:function(b){return a.console.assert(this.viewer,"[Viewport.windowToImageCoordinates] the viewport must have a viewer."),b=b.minus(a.getElementPosition(this.viewer.element)),this.viewerElementToImageCoordinates(b)},imageToWindowCoordinates:function(b){return a.console.assert(this.viewer,"[Viewport.imageToWindowCoordinates] the viewport must have a viewer."),this.imageToViewerElementCoordinates(b).plus(a.getElementPosition(this.viewer.element))},viewerElementToViewportCoordinates:function(a){return this.pointFromPixel(a,!0)},viewportToViewerElementCoordinates:function(a){return this.pixelFromPoint(a,!0)},viewerElementToViewportRectangle:function(b){return a.Rect.fromSummits(this.pointFromPixel(b.getTopLeft(),!0),this.pointFromPixel(b.getTopRight(),!0),this.pointFromPixel(b.getBottomLeft(),!0))},viewportToViewerElementRectangle:function(b){return a.Rect.fromSummits(this.pixelFromPoint(b.getTopLeft(),!0),this.pixelFromPoint(b.getTopRight(),!0),this.pixelFromPoint(b.getBottomLeft(),!0))},windowToViewportCoordinates:function(b){return a.console.assert(this.viewer,"[Viewport.windowToViewportCoordinates] the viewport must have a viewer."),b=b.minus(a.getElementPosition(this.viewer.element)),this.viewerElementToViewportCoordinates(b)},viewportToWindowCoordinates:function(b){return a.console.assert(this.viewer,"[Viewport.viewportToWindowCoordinates] the viewport must have a viewer."),this.viewportToViewerElementCoordinates(b).plus(a.getElementPosition(this.viewer.element))},viewportToImageZoom:function(b){if(this.viewer){var c=this.viewer.world.getItemCount();if(1<c)this.silenceMultiImageWarnings||a.console.error("[Viewport.viewportToImageZoom] is not accurate with multi-image.");else if(1===c)return this.viewer.world.getItemAt(0).viewportToImageZoom(b)}return c=this._contentSizeNoRotate.x,b*(this._containerInnerSize.x/c*this._contentBoundsNoRotate.width)},imageToViewportZoom:function(b){if(this.viewer){var c=this.viewer.world.getItemCount();if(1<c)this.silenceMultiImageWarnings||a.console.error("[Viewport.imageToViewportZoom] is not accurate with multi-image.");else if(1===c)return this.viewer.world.getItemAt(0).imageToViewportZoom(b)}return b*(this._contentSizeNoRotate.x/this._containerInnerSize.x/this._contentBoundsNoRotate.width)},toggleFlip:function(){return this.setFlip(!this.getFlip()),this},getFlip:function(){return this.flipped},setFlip:function(a){return this.flipped===a?this:(this.flipped=a,this.viewer.navigator&&this.viewer.navigator.setFlip(this.getFlip()),this.viewer.forceRedraw(),this.viewer.raiseEvent("flip",{flipped:a}),this)}}}(OpenSeadragon),function(a){function b(b){return b!==a.SUBPIXEL_ROUNDING_OCCURRENCES.ALWAYS&&b!==a.SUBPIXEL_ROUNDING_OCCURRENCES.ONLY_AT_REST&&b!==a.SUBPIXEL_ROUNDING_OCCURRENCES.NEVER}function c(a){return b(a)?d:a}a.TiledImage=function(b){var c=this;a.console.assert(b.tileCache,"[TiledImage] options.tileCache is required"),a.console.assert(b.drawer,"[TiledImage] options.drawer is required"),a.console.assert(b.viewer,"[TiledImage] options.viewer is required"),a.console.assert(b.imageLoader,"[TiledImage] options.imageLoader is required"),a.console.assert(b.source,"[TiledImage] options.source is required"),a.console.assert(!b.clip||b.clip instanceof a.Rect,"[TiledImage] options.clip must be an OpenSeadragon.Rect if present"),a.EventSource.call(this),this._tileCache=b.tileCache,delete b.tileCache,this._drawer=b.drawer,delete b.drawer,this._imageLoader=b.imageLoader,delete b.imageLoader,b.clip instanceof a.Rect&&(this._clip=b.clip.clone()),delete b.clip;var d=b.x||0;delete b.x;var e=b.y||0;delete b.y,this.normHeight=b.source.dimensions.y/b.source.dimensions.x,this.contentAspectX=b.source.dimensions.x/b.source.dimensions.y;var f=1;b.width?(f=b.width,delete b.width,b.height&&(a.console.error("specifying both width and height to a tiledImage is not supported"),delete b.height)):b.height&&(f=b.height/this.normHeight,delete b.height);var g=b.fitBounds;delete b.fitBounds;var h=b.fitBoundsPlacement||OpenSeadragon.Placement.CENTER;delete b.fitBoundsPlacement;var i=b.degrees||0;delete b.degrees,a.extend(!0,this,{viewer:null,tilesMatrix:{},coverage:{},loadingCoverage:{},lastDrawn:[],lastResetTime:0,_midDraw:!1,_needsDraw:!0,_hasOpaqueTile:!1,_tilesLoading:0,springStiffness:a.DEFAULT_SETTINGS.springStiffness,animationTime:a.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:a.DEFAULT_SETTINGS.minZoomImageRatio,wrapHorizontal:a.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:a.DEFAULT_SETTINGS.wrapVertical,immediateRender:a.DEFAULT_SETTINGS.immediateRender,blendTime:a.DEFAULT_SETTINGS.blendTime,alwaysBlend:a.DEFAULT_SETTINGS.alwaysBlend,minPixelRatio:a.DEFAULT_SETTINGS.minPixelRatio,smoothTileEdgesMinZoom:a.DEFAULT_SETTINGS.smoothTileEdgesMinZoom,iOSDevice:a.DEFAULT_SETTINGS.iOSDevice,debugMode:a.DEFAULT_SETTINGS.debugMode,crossOriginPolicy:a.DEFAULT_SETTINGS.crossOriginPolicy,ajaxWithCredentials:a.DEFAULT_SETTINGS.ajaxWithCredentials,placeholderFillStyle:a.DEFAULT_SETTINGS.placeholderFillStyle,opacity:a.DEFAULT_SETTINGS.opacity,preload:a.DEFAULT_SETTINGS.preload,compositeOperation:a.DEFAULT_SETTINGS.compositeOperation,subPixelRoundingForTransparency:a.DEFAULT_SETTINGS.subPixelRoundingForTransparency},b),this._preload=this.preload,delete this.preload,this._fullyLoaded=!1,this._xSpring=new a.Spring({initial:d,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._ySpring=new a.Spring({initial:e,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._scaleSpring=new a.Spring({initial:f,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._degreesSpring=new a.Spring({initial:i,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._updateForScale(),g&&this.fitBounds(g,h,!0),this._drawingHandler=function(b){c.viewer.raiseEvent("tile-drawing",a.extend({tiledImage:c},b))}},a.extend(a.TiledImage.prototype,a.EventSource.prototype,{needsDraw:function(){return this._needsDraw},getFullyLoaded:function(){return this._fullyLoaded},_setFullyLoaded:function(a){a!==this._fullyLoaded&&(this._fullyLoaded=a,this.raiseEvent("fully-loaded-change",{fullyLoaded:this._fullyLoaded}))},reset:function(){this._tileCache.clearTilesFor(this),this.lastResetTime=a.now(),this._needsDraw=!0},update:function(){var a=this._xSpring.update(),b=this._ySpring.update(),c=this._scaleSpring.update(),d=this._degreesSpring.update();return!!(a||b||c||d)&&(this._updateForScale(),this._needsDraw=!0)},draw:function(){0!==this.opacity||this._preload?(this._midDraw=!0,this._updateViewport(),this._midDraw=!1):this._needsDraw=!1},destroy:function(){this.reset(),this.source.destroy&&this.source.destroy()},getBounds:function(a){return this.getBoundsNoRotate(a).rotate(this.getRotation(a),this._getRotationPoint(a))},getBoundsNoRotate:function(b){return b?new a.Rect(this._xSpring.current.value,this._ySpring.current.value,this._worldWidthCurrent,this._worldHeightCurrent):new a.Rect(this._xSpring.target.value,this._ySpring.target.value,this._worldWidthTarget,this._worldHeightTarget)},getWorldBounds:function(){return a.console.error("[TiledImage.getWorldBounds] is deprecated; use TiledImage.getBounds instead"),this.getBounds()},getClippedBounds:function(b){var c=this.getBoundsNoRotate(b);if(this._clip){var d=(b?this._worldWidthCurrent:this._worldWidthTarget)/this.source.dimensions.x;d=this._clip.times(d),c=new a.Rect(c.x+d.x,c.y+d.y,d.width,d.height)}return c.rotate(this.getRotation(b),this._getRotationPoint(b))},getTileBounds:function(a,b,c){var d=this.source.getNumTiles(a),e=(d.x+b%d.x)%d.x,f=(d.y+c%d.y)%d.y;return a=this.source.getTileBounds(a,e,f),this.getFlip()&&(a.x=1-a.x-a.width),a.x+=(b-e)/d.x,a.y+=this._worldHeightCurrent/this._worldWidthCurrent*((c-f)/d.y),a},getContentSize:function(){return new a.Point(this.source.dimensions.x,this.source.dimensions.y)},getSizeInWindowCoordinates:function(){var b=this.imageToWindowCoordinates(new a.Point(0,0)),c=this.imageToWindowCoordinates(this.getContentSize());return new a.Point(c.x-b.x,c.y-b.y)},_viewportToImageDelta:function(b,c,d){return d=(d?this._scaleSpring.current:this._scaleSpring.target).value,new a.Point(b*(this.source.dimensions.x/d),c*(this.source.dimensions.y*this.contentAspectX/d))},viewportToImageCoordinates:function(b,c,d){var e;return b instanceof a.Point?(d=c,e=b):e=new a.Point(b,c),e=e.rotate(-this.getRotation(d),this._getRotationPoint(d)),d?this._viewportToImageDelta(e.x-this._xSpring.current.value,e.y-this._ySpring.current.value):this._viewportToImageDelta(e.x-this._xSpring.target.value,e.y-this._ySpring.target.value)},_imageToViewportDelta:function(b,c,d){
return d=(d?this._scaleSpring.current:this._scaleSpring.target).value,new a.Point(b/this.source.dimensions.x*d,c/this.source.dimensions.y/this.contentAspectX*d)},imageToViewportCoordinates:function(b,c,d){return b instanceof a.Point&&(d=c,c=b.y,b=b.x),c=this._imageToViewportDelta(b,c),d?(c.x+=this._xSpring.current.value,c.y+=this._ySpring.current.value):(c.x+=this._xSpring.target.value,c.y+=this._ySpring.target.value),c.rotate(this.getRotation(d),this._getRotationPoint(d))},imageToViewportRectangle:function(b,c,d,e,f){var g=b;return g instanceof a.Rect?f=c:g=new a.Rect(b,c,d,e),d=this.imageToViewportCoordinates(g.getTopLeft(),f),e=this._imageToViewportDelta(g.width,g.height,f),new a.Rect(d.x,d.y,e.x,e.y,g.degrees+this.getRotation(f))},viewportToImageRectangle:function(b,c,d,e,f){var g=b;return b instanceof a.Rect?f=c:g=new a.Rect(b,c,d,e),d=this.viewportToImageCoordinates(g.getTopLeft(),f),e=this._viewportToImageDelta(g.width,g.height,f),new a.Rect(d.x,d.y,e.x,e.y,g.degrees-this.getRotation(f))},viewerElementToImageCoordinates:function(a){return a=this.viewport.pointFromPixel(a,!0),this.viewportToImageCoordinates(a)},imageToViewerElementCoordinates:function(a){return a=this.imageToViewportCoordinates(a),this.viewport.pixelFromPoint(a,!0)},windowToImageCoordinates:function(a){return a=a.minus(OpenSeadragon.getElementPosition(this.viewer.element)),this.viewerElementToImageCoordinates(a)},imageToWindowCoordinates:function(a){return this.imageToViewerElementCoordinates(a).plus(OpenSeadragon.getElementPosition(this.viewer.element))},_viewportToTiledImageRectangle:function(b){var c=this._scaleSpring.current.value;return b=b.rotate(-this.getRotation(!0),this._getRotationPoint(!0)),new a.Rect((b.x-this._xSpring.current.value)/c,(b.y-this._ySpring.current.value)/c,b.width/c,b.height/c,b.degrees)},viewportToImageZoom:function(a){return this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x*a},imageToViewportZoom:function(a){return a/(this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x)},setPosition:function(a,b){var c=this._xSpring.target.value===a.x&&this._ySpring.target.value===a.y;if(b){if(c&&this._xSpring.current.value===a.x&&this._ySpring.current.value===a.y)return;this._xSpring.resetTo(a.x),this._ySpring.resetTo(a.y),this._needsDraw=!0}else{if(c)return;this._xSpring.springTo(a.x),this._ySpring.springTo(a.y),this._needsDraw=!0}c||this._raiseBoundsChange()},setWidth:function(a,b){this._setScale(a,b)},setHeight:function(a,b){this._setScale(a/this.normHeight,b)},setCroppingPolygons:function(b){var c=function(b){return b instanceof a.Point||"number"==typeof b.x&&"number"==typeof b.y};try{if(!a.isArray(b))throw new Error("Provided cropping polygon is not an array");this._croppingPolygons=b.map(function(a){return a.map(function(a){try{if(c(a))return{x:a.x,y:a.y};throw new Error}catch(a){throw new Error("A Provided cropping polygon point is not supported")}})})}catch(b){a.console.error("[TiledImage.setCroppingPolygons] Cropping polygon format not supported"),a.console.error(b),this._croppingPolygons=null}},resetCroppingPolygons:function(){this._croppingPolygons=null},fitBounds:function(b,c,d){c=c||a.Placement.CENTER;var e=a.Placement.properties[c],f=this.contentAspectX,g=0,h=0,i=1;if(c=1,this._clip&&(f=this._clip.getAspectRatio(),i=this._clip.width/this.source.dimensions.x,c=this._clip.height/this.source.dimensions.y,b.getAspectRatio()>f?(g=this._clip.x/this._clip.height*b.height,h=this._clip.y/this._clip.height*b.height):(g=this._clip.x/this._clip.width*b.width,h=this._clip.y/this._clip.width*b.width)),b.getAspectRatio()>f){var j=b.height/c;c=0,e.isHorizontallyCentered?c=(b.width-b.height*f)/2:e.isRight&&(c=b.width-b.height*f),this.setPosition(new a.Point(b.x-g+c,b.y-h),d),this.setHeight(j,d)}else j=b.width/i,i=0,e.isVerticallyCentered?i=(b.height-b.width/f)/2:e.isBottom&&(i=b.height-b.width/f),this.setPosition(new a.Point(b.x-g,b.y-h+i),d),this.setWidth(j,d)},getClip:function(){return this._clip?this._clip.clone():null},setClip:function(b){a.console.assert(!b||b instanceof a.Rect,"[TiledImage.setClip] newClip must be an OpenSeadragon.Rect or null"),b instanceof a.Rect?this._clip=b.clone():this._clip=null,this._needsDraw=!0,this.raiseEvent("clip-change")},getFlip:function(){return!!this.flipped},setFlip:function(a){this.flipped=!!a,this._needsDraw=!0,this._raiseBoundsChange()},getOpacity:function(){return this.opacity},setOpacity:function(a){a!==this.opacity&&(this.opacity=a,this._needsDraw=!0,this.raiseEvent("opacity-change",{opacity:this.opacity}))},getPreload:function(){return this._preload},setPreload:function(a){this._preload=!!a,this._needsDraw=!0},getRotation:function(a){return(a?this._degreesSpring.current:this._degreesSpring.target).value},setRotation:function(a,b){this._degreesSpring.target.value===a&&this._degreesSpring.isAtTargetValue()||(b?this._degreesSpring.resetTo(a):this._degreesSpring.springTo(a),this._needsDraw=!0,this._raiseBoundsChange())},_getRotationPoint:function(a){return this.getBoundsNoRotate(a).getCenter()},getCompositeOperation:function(){return this.compositeOperation},setCompositeOperation:function(a){a!==this.compositeOperation&&(this.compositeOperation=a,this._needsDraw=!0,this.raiseEvent("composite-operation-change",{compositeOperation:this.compositeOperation}))},_setScale:function(a,b){var c=this._scaleSpring.target.value===a;if(b){if(c&&this._scaleSpring.current.value===a)return;this._scaleSpring.resetTo(a),this._updateForScale(),this._needsDraw=!0}else{if(c)return;this._scaleSpring.springTo(a),this._updateForScale(),this._needsDraw=!0}c||this._raiseBoundsChange()},_updateForScale:function(){this._worldWidthTarget=this._scaleSpring.target.value,this._worldHeightTarget=this.normHeight*this._scaleSpring.target.value,this._worldWidthCurrent=this._scaleSpring.current.value,this._worldHeightCurrent=this.normHeight*this._scaleSpring.current.value},_raiseBoundsChange:function(){this.raiseEvent("bounds-change")},_isBottomItem:function(){return this.viewer.world.getItemAt(0)===this},_getLevelsInterval:function(){var a=Math.max(this.source.minLevel,Math.floor(Math.log(this.minZoomImageRatio)/Math.log(2))),b=this.viewport.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(0),!0).x*this._scaleSpring.current.value;return b=Math.min(Math.abs(this.source.maxLevel),Math.abs(Math.floor(Math.log(b/this.minPixelRatio)/Math.log(2)))),b=Math.max(b,this.source.minLevel||0),{lowestLevel:Math.min(a,b),highestLevel:b}},_updateViewport:function(){for(this._needsDraw=!1,this._tilesLoading=0,this.loadingCoverage={};0<this.lastDrawn.length;)this.lastDrawn.pop().beingDrawn=!1;var b=this.viewport,c=this._viewportToTiledImageRectangle(b.getBoundsWithMargins(!0));if(!this.wrapHorizontal&&!this.wrapVertical){var d=this._viewportToTiledImageRectangle(this.getClippedBounds(!0));if(null===(c=c.intersection(d)))return}d=this._getLevelsInterval();var e=d.lowestLevel;d=d.highestLevel;for(var f=null,g=!1,h=a.now(),i=d;e<=i;i--){var j=!1,k=b.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(i),!0).x*this._scaleSpring.current.value;if(i===e||!g&&k>=this.minPixelRatio)g=j=!0;else if(!g)continue;var l=b.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(i),!1).x*this._scaleSpring.current.value,m=b.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(Math.max(this.source.getClosestLevel(),0)),!1).x*this._scaleSpring.current.value;if(m=this.immediateRender?1:m,k=Math.min(1,(k-.5)/.5),l=m/Math.abs(m-l),f=this._updateLevel(g,j,i,k,l,c,h,f),this._providesCoverage(this.coverage,i))break}this._drawTiles(this.lastDrawn),f&&!f.context2D?(this._loadTile(f,h),this._needsDraw=!0,this._setFullyLoaded(!1)):this._setFullyLoaded(0===this._tilesLoading)},_getCornerTiles:function(b,c,d){var e,f;this.wrapHorizontal?(e=a.positiveModulo(c.x,1),f=a.positiveModulo(d.x,1)):(e=Math.max(0,c.x),f=Math.min(1,d.x));var g=1/this.source.aspectRatio;this.wrapVertical?(h=a.positiveModulo(c.y,g),i=a.positiveModulo(d.y,g)):(h=Math.max(0,c.y),i=Math.min(g,d.y));var h=this.source.getTileAtPoint(b,new a.Point(e,h)),i=this.source.getTileAtPoint(b,new a.Point(f,i));return b=this.source.getNumTiles(b),this.wrapHorizontal&&(h.x+=b.x*Math.floor(c.x),i.x+=b.x*Math.floor(d.x)),this.wrapVertical&&(h.y+=b.y*Math.floor(c.y/g),i.y+=b.y*Math.floor(d.y/g)),{topLeft:h,bottomRight:i}},_updateLevel:function(a,b,c,d,e,f,g,h){var i=f.getBoundingBox().getTopLeft(),j=f.getBoundingBox().getBottomRight();this.viewer&&this.viewer.raiseEvent("update-level",{tiledImage:this,havedrawn:a,level:c,opacity:d,visibility:e,drawArea:f,topleft:i,bottomright:j,currenttime:g,best:h}),this._resetCoverage(this.coverage,c),this._resetCoverage(this.loadingCoverage,c),j=this._getCornerTiles(c,i,j);var k=j.topLeft,l=j.bottomRight,m=this.source.getNumTiles(c),n=this.viewport.pixelFromPoint(this.viewport.getCenter());this.getFlip()&&(l.x+=1,this.wrapHorizontal||(l.x=Math.min(l.x,m.x-1)));for(var o=k.x;o<=l.x;o++)for(var p=k.y;p<=l.y;p++){if(this.getFlip()){var q=(m.x+o%m.x)%m.x;q=o+m.x-q-q-1}else q=o;null!==f.intersection(this.getTileBounds(c,q,p))&&(h=this._updateTile(b,a,q,p,c,d,e,n,m,g,h))}return h},_updateTile:function(a,b,c,d,e,f,g,h,i,j,k){var l=this._getTile(c,d,e,j,i,this._worldWidthCurrent,this._worldHeightCurrent),i=b;return this.viewer&&this.viewer.raiseEvent("update-tile",{tiledImage:this,tile:l}),this._setCoverage(this.coverage,e,c,d,!1),b=l.loaded||l.loading||this._isCovered(this.loadingCoverage,e,c,d),this._setCoverage(this.loadingCoverage,e,c,d,b),l.exists?(a&&!i&&(this._isCovered(this.coverage,e,c,d)?this._setCoverage(this.coverage,e,c,d,!0):i=!0),i?(this._positionTile(l,this.source.tileOverlap,this.viewport,h,g),l.loaded||(l.context2D?this._setTileLoaded(l):(g=this._tileCache.getImageRecord(l.cacheKey))&&(g=g.getImage(),this._setTileLoaded(l,g))),l.loaded?this._blendTile(l,c,d,e,f,j)&&(this._needsDraw=!0):l.loading?this._tilesLoading++:b||(k=this._compareTiles(k,l)),k):k):k},_getTile:function(b,c,d,e,f,g,h){var i,j,k,l,m,n,o,p,q,r=this.tilesMatrix,s=this.source;return r[d]||(r[d]={}),r[d][b]||(r[d][b]={}),r[d][b][c]&&!r[d][b][c].flipped==!this.flipped||(i=(f.x+b%f.x)%f.x,j=(f.y+c%f.y)%f.y,k=this.getTileBounds(d,b,c),l=s.getTileBounds(d,i,j,!0),m=s.tileExists(d,i,j),n=s.getTileUrl(d,i,j),q=s.getTilePostData(d,i,j),this.loadTilesWithAjax?(o=s.getTileAjaxHeaders(d,i,j),a.isPlainObject(this.ajaxHeaders)&&(o=a.extend({},this.ajaxHeaders,o))):o=null,p=s.getContext2D?s.getContext2D(d,i,j):void 0,q=new a.Tile(d,b,c,k,m,n,p,this.loadTilesWithAjax,o,l,q,s.getTileHashKey(d,i,j,n,o,q)),this.getFlip()?0==i&&(q.isRightMost=!0):i==f.x-1&&(q.isRightMost=!0),j==f.y-1&&(q.isBottomMost=!0),q.flipped=this.flipped,r[d][b][c]=q),(q=r[d][b][c]).lastTouchTime=e,q},_loadTile:function(a,b){var c=this;a.loading=!0,this._imageLoader.addJob({src:a.url,postData:a.postData,loadWithAjax:a.loadWithAjax,ajaxHeaders:a.ajaxHeaders,crossOriginPolicy:this.crossOriginPolicy,ajaxWithCredentials:this.ajaxWithCredentials,callback:function(d,e,f){c._onTileLoad(a,b,d,e,f)},abort:function(){a.loading=!1}})},_onTileLoad:function(b,c,d,e,f){function g(){var a=h.source.getClosestLevel();h._setTileLoaded(b,d,a,f)}if(d)if(c<this.lastResetTime)a.console.warn("Ignoring tile %s loaded before reset: %s",b,b.url),b.loading=!1;else{var h=this;this._midDraw?window.setTimeout(g,1):g()}else a.console.error("Tile %s failed to load: %s - error: %s",b,b.url,e),this.viewer.raiseEvent("tile-load-failed",{tile:b,tiledImage:this,time:c,message:e,tileRequest:f}),b.loading=!1,b.exists=!1},_setTileLoaded:function(a,b,c,d){function e(){return g++,f}function f(){0==--g&&(a.loading=!1,a.loaded=!0,a.context2D||h._tileCache.cacheTile({image:b,tile:a,cutoff:c,tiledImage:h}),h._needsDraw=!0)}var g=0,h=this;this.viewer.raiseEvent("tile-loaded",{tile:a,tiledImage:this,tileRequest:d,image:b,getCompletionCallback:e}),e()()},_positionTile:function(b,c,d,e,f){var g=b.bounds.getTopLeft();g.x*=this._scaleSpring.current.value,g.y*=this._scaleSpring.current.value,g.x+=this._xSpring.current.value,g.y+=this._ySpring.current.value;var h=b.bounds.getSize();h.x*=this._scaleSpring.current.value,h.y*=this._scaleSpring.current.value;var i=d.pixelFromPointNoRotate(g,!0),j=d.pixelFromPointNoRotate(g,!1),g=d.deltaPixelsFromPointsNoRotate(h,!0),h=d.deltaPixelsFromPointsNoRotate(h,!1),h=j.plus(h.divide(2)),h=e.squaredDistanceTo(h);c||(g=g.plus(new a.Point(1,1))),b.isRightMost&&this.wrapHorizontal&&(g.x+=.75),b.isBottomMost&&this.wrapVertical&&(g.y+=.75),b.position=i,b.size=g,b.squaredDistance=h,b.visibility=f},_blendTile:function(a,b,c,d,e,f){var g,h=1e3*this.blendTime;if(a.blendStart||(a.blendStart=f),g=f-a.blendStart,f=h?Math.min(1,g/h):1,this.alwaysBlend&&(f*=e),a.opacity=f,this.lastDrawn.push(a),1===f)this._setCoverage(this.coverage,d,b,c,!0),this._hasOpaqueTile=!0;else if(g<h)return!0;return!1},_compareTiles:function(a,b){return!a||b.visibility>a.visibility||b.visibility===a.visibility&&b.squaredDistance<a.squaredDistance?b:a},_drawTiles:function(e){if(0!==this.opacity&&(0!==e.length||this.placeholderFillStyle)){var f,g=e[0];g&&(f=this.opacity<1||this.compositeOperation&&"source-over"!==this.compositeOperation||!this._isBottomItem()&&g._hasTransparencyChannel());var h,i,j=this.viewport.getZoom(!0),k=this.viewportToImageZoom(j);1<e.length&&k>this.smoothTileEdgesMinZoom&&!this.iOSDevice&&this.getRotation(!0)%360==0&&a.supportsCanvas&&this.viewer.useCanvas&&(f=!0,h=g.getScaleForEdgeSmoothing(),i=g.getTranslationForEdgeSmoothing(h,this._drawer.getCanvasSize(!1),this._drawer.getCanvasSize(!0)));var l;if(f&&(h||(l=this.viewport.viewportToViewerElementRectangle(this.getClippedBounds(!0)).getIntegerBoundingBox(),this._drawer.viewer.viewport.getFlip()&&(0===this.viewport.degrees&&this.getRotation(!0)%360==0||(l.x=this._drawer.viewer.container.clientWidth-(l.x+l.width))),l=l.times(a.pixelDensityRatio)),this._drawer._clear(!0,l)),h||(0!==this.viewport.degrees&&this._drawer._offsetForRotation({degrees:this.viewport.degrees,useSketch:f}),this.getRotation(!0)%360!=0&&this._drawer._offsetForRotation({degrees:this.getRotation(!0),point:this.viewport.pixelFromPointNoRotate(this._getRotationPoint(!0),!0),useSketch:f}),0===this.viewport.degrees&&this.getRotation(!0)%360==0&&this._drawer.viewer.viewport.getFlip()&&this._drawer._flip()),j=!1,this._clip&&(this._drawer.saveContext(f),k=this.imageToViewportRectangle(this._clip,!0),k=k.rotate(-this.getRotation(!0),this._getRotationPoint(!0)),k=this._drawer.viewportToDrawerRectangle(k),h&&(k=k.times(h)),i&&(k=k.translate(i)),this._drawer.setClip(k,f),j=!0),this._croppingPolygons){this._drawer.saveContext(f);try{var m=this._croppingPolygons.map(function(a){return a.map(function(a){return a=this.imageToViewportCoordinates(a.x,a.y,!0).rotate(-this.getRotation(!0),this._getRotationPoint(!0)),a=this._drawer.viewportCoordToDrawerCoord(a),a=h?a.times(h):a})});this._drawer.clipWithPolygons(m,f)}catch(e){a.console.error(e)}j=!0}if(this.placeholderFillStyle&&!1===this._hasOpaqueTile){m=this._drawer.viewportToDrawerRectangle(this.getBounds(!0)),h&&(m=m.times(h)),i&&(m=m.translate(i));var n=null;n="function"==typeof this.placeholderFillStyle?this.placeholderFillStyle(this,this._drawer.context):this.placeholderFillStyle,this._drawer.drawRectangle(m,n,f)}n=function(e){if("number"==typeof e)return c(e);if(!e||!a.Browser)return d;var f=e[a.Browser.vendor];return b(f)&&(f=e["*"]),c(f)}(this.subPixelRoundingForTransparency);var o=!1;n===a.SUBPIXEL_ROUNDING_OCCURRENCES.ALWAYS?o=!0:n===a.SUBPIXEL_ROUNDING_OCCURRENCES.ONLY_AT_REST&&(o=!(this.viewer&&this.viewer.isAnimating()));for(var p=e.length-1;0<=p;p--)g=e[p],this._drawer.drawTile(g,this._drawingHandler,f,h,i,o),g.beingDrawn=!0,this.viewer&&this.viewer.raiseEvent("tile-drawn",{tiledImage:this,tile:g});j&&this._drawer.restoreContext(f),h||(this.getRotation(!0)%360!=0&&this._drawer._restoreRotationChanges(f),0!==this.viewport.degrees&&this._drawer._restoreRotationChanges(f)),f&&(h&&(0!==this.viewport.degrees&&this._drawer._offsetForRotation({degrees:this.viewport.degrees,useSketch:!1}),this.getRotation(!0)%360!=0&&this._drawer._offsetForRotation({degrees:this.getRotation(!0),point:this.viewport.pixelFromPointNoRotate(this._getRotationPoint(!0),!0),useSketch:!1})),this._drawer.blendSketch({opacity:this.opacity,scale:h,translate:i,compositeOperation:this.compositeOperation,bounds:l}),h&&(this.getRotation(!0)%360!=0&&this._drawer._restoreRotationChanges(!1),0!==this.viewport.degrees&&this._drawer._restoreRotationChanges(!1))),h||0===this.viewport.degrees&&this.getRotation(!0)%360==0&&this._drawer.viewer.viewport.getFlip()&&this._drawer._flip(),this._drawDebugInfo(e)}},_drawDebugInfo:function(b){if(this.debugMode)for(var c=b.length-1;0<=c;c--){var d=b[c];try{this._drawer.drawDebugInfo(d,b.length,c,this)}catch(b){a.console.error(b)}}},_providesCoverage:function(a,b,c,d){var e,f,g,h;if(!a[b])return!1;if(void 0!==c&&void 0!==d)return void 0===a[b][c]||void 0===a[b][c][d]||!0===a[b][c][d];for(g in e=a[b])if(Object.prototype.hasOwnProperty.call(e,g))for(h in f=e[g])if(Object.prototype.hasOwnProperty.call(f,h)&&!f[h])return!1;return!0},_isCovered:function(a,b,c,d){return void 0===c||void 0===d?this._providesCoverage(a,b+1):this._providesCoverage(a,b+1,2*c,2*d)&&this._providesCoverage(a,b+1,2*c,2*d+1)&&this._providesCoverage(a,b+1,2*c+1,2*d)&&this._providesCoverage(a,b+1,2*c+1,2*d+1)},_setCoverage:function(b,c,d,e,f){b[c]?(b[c][d]||(b[c][d]={}),b[c][d][e]=f):a.console.warn("Setting coverage for a tile before its level's coverage has been reset: %s",c)},_resetCoverage:function(a,b){a[b]={}}});var d=a.SUBPIXEL_ROUNDING_OCCURRENCES.NEVER}(OpenSeadragon),function(a){function b(b){a.console.assert(b,"[TileCache.cacheTile] options is required"),a.console.assert(b.tile,"[TileCache.cacheTile] options.tile is required"),a.console.assert(b.tiledImage,"[TileCache.cacheTile] options.tiledImage is required"),this.tile=b.tile,this.tiledImage=b.tiledImage}function c(b){a.console.assert(b,"[ImageRecord] options is required"),a.console.assert(b.image,"[ImageRecord] options.image is required"),this._image=b.image,this._tiles=[]}c.prototype={destroy:function(){this._image=null,this._renderedContext=null,this._tiles=null},getImage:function(){return this._image},getRenderedContext:function(){if(!this._renderedContext){var a=document.createElement("canvas");a.width=this._image.width,a.height=this._image.height,this._renderedContext=a.getContext("2d"),this._renderedContext.drawImage(this._image,0,0),this._image=null}return this._renderedContext},setRenderedContext:function(b){a.console.error("ImageRecord.setRenderedContext is deprecated. The rendered context should be created by the ImageRecord itself when calling ImageRecord.getRenderedContext."),this._renderedContext=b},addTile:function(b){a.console.assert(b,"[ImageRecord.addTile] tile is required"),this._tiles.push(b)},removeTile:function(b){for(var c=0;c<this._tiles.length;c++)if(this._tiles[c]===b)return void this._tiles.splice(c,1);a.console.warn("[ImageRecord.removeTile] trying to remove unknown tile",b)},getTileCount:function(){return this._tiles.length}},a.TileCache=function(b){this._maxImageCacheCount=(b=b||{}).maxImageCacheCount||a.DEFAULT_SETTINGS.maxImageCacheCount,this._tilesLoaded=[],this._imagesLoaded=[],this._imagesLoadedCount=0},a.TileCache.prototype={numTilesLoaded:function(){return this._tilesLoaded.length},cacheTile:function(d){a.console.assert(d,"[TileCache.cacheTile] options is required"),a.console.assert(d.tile,"[TileCache.cacheTile] options.tile is required"),a.console.assert(d.tile.cacheKey,"[TileCache.cacheTile] options.tile.cacheKey is required"),a.console.assert(d.tiledImage,"[TileCache.cacheTile] options.tiledImage is required");var e=d.cutoff||0,f=this._tilesLoaded.length,g=this._imagesLoaded[d.tile.cacheKey];if(g||(a.console.assert(d.image,"[TileCache.cacheTile] options.image is required to create an ImageRecord"),g=this._imagesLoaded[d.tile.cacheKey]=new c({image:d.image}),this._imagesLoadedCount++),g.addTile(d.tile),d.tile.cacheImageRecord=g,this._imagesLoadedCount>this._maxImageCacheCount){for(var h,i,j,k,l,m,n=null,o=-1,p=null,q=this._tilesLoaded.length-1;0<=q;q--)(h=(m=this._tilesLoaded[q]).tile).level<=e||h.beingDrawn||(n?(k=h.lastTouchTime,i=n.lastTouchTime,l=h.level,j=n.level,(k<i||k===i&&j<l)&&(n=h,o=q,p=m)):(n=h,o=q,p=m));n&&0<=o&&(this._unloadTile(p),f=o)}this._tilesLoaded[f]=new b({tile:d.tile,tiledImage:d.tiledImage})},clearTilesFor:function(b){a.console.assert(b,"[TileCache.clearTilesFor] tiledImage is required");for(var c,d=0;d<this._tilesLoaded.length;++d)(c=this._tilesLoaded[d]).tiledImage===b&&(this._unloadTile(c),this._tilesLoaded.splice(d,1),d--)},getImageRecord:function(b){return a.console.assert(b,"[TileCache.getImageRecord] cacheKey is required"),this._imagesLoaded[b]},_unloadTile:function(b){a.console.assert(b,"[TileCache._unloadTile] tileRecord is required");var c=b.tile,d=b.tiledImage;c.unload(),c.cacheImageRecord=null,b=this._imagesLoaded[c.cacheKey],b.removeTile(c),b.getTileCount()||(b.destroy(),delete this._imagesLoaded[c.cacheKey],this._imagesLoadedCount--),d.viewer.raiseEvent("tile-unloaded",{tile:c,tiledImage:d})}}}(OpenSeadragon),function(a){a.World=function(b){var c=this;a.console.assert(b.viewer,"[World] options.viewer is required"),a.EventSource.call(this),this.viewer=b.viewer,this._items=[],this._needsDraw=!1,this._autoRefigureSizes=!0,this._needsSizesFigured=!1,this._delegatedFigureSizes=function(a){c._autoRefigureSizes?c._figureSizes():c._needsSizesFigured=!0},this._figureSizes()},a.extend(a.World.prototype,a.EventSource.prototype,{addItem:function(b,c){a.console.assert(b,"[World.addItem] item is required"),a.console.assert(b instanceof a.TiledImage,"[World.addItem] only TiledImages supported at this time"),void 0!==(c=c||{}).index?(c=Math.max(0,Math.min(this._items.length,c.index)),this._items.splice(c,0,b)):this._items.push(b),this._autoRefigureSizes?this._figureSizes():this._needsSizesFigured=!0,this._needsDraw=!0,b.addHandler("bounds-change",this._delegatedFigureSizes),b.addHandler("clip-change",this._delegatedFigureSizes),this.raiseEvent("add-item",{item:b})},getItemAt:function(b){return a.console.assert(void 0!==b,"[World.getItemAt] index is required"),this._items[b]},getIndexOfItem:function(b){return a.console.assert(b,"[World.getIndexOfItem] item is required"),a.indexOf(this._items,b)},getItemCount:function(){return this._items.length},setItemIndex:function(b,c){a.console.assert(b,"[World.setItemIndex] item is required"),a.console.assert(void 0!==c,"[World.setItemIndex] index is required");var d=this.getIndexOfItem(b);if(c>=this._items.length)throw new Error("Index bigger than number of layers.");c!==d&&-1!==d&&(this._items.splice(d,1),this._items.splice(c,0,b),this._needsDraw=!0,this.raiseEvent("item-index-change",{item:b,previousIndex:d,newIndex:c}))},removeItem:function(b){a.console.assert(b,"[World.removeItem] item is required");var c=a.indexOf(this._items,b);-1!==c&&(b.removeHandler("bounds-change",this._delegatedFigureSizes),b.removeHandler("clip-change",this._delegatedFigureSizes),b.destroy(),this._items.splice(c,1),this._figureSizes(),this._needsDraw=!0,this._raiseRemoveItem(b))},removeAll:function(){this.viewer._cancelPendingImages();var a,b;for(b=0;b<this._items.length;b++)(a=this._items[b]).removeHandler("bounds-change",this._delegatedFigureSizes),a.removeHandler("clip-change",this._delegatedFigureSizes),a.destroy();var c=this._items;for(this._items=[],this._figureSizes(),this._needsDraw=!0,b=0;b<c.length;b++)a=c[b],this._raiseRemoveItem(a)},resetItems:function(){for(var a=0;a<this._items.length;a++)this._items[a].reset()},update:function(){for(var a=!1,b=0;b<this._items.length;b++)a=this._items[b].update()||a;return a},draw:function(){for(var a=0;a<this._items.length;a++)this._items[a].draw();this._needsDraw=!1},needsDraw:function(){for(var a=0;a<this._items.length;a++)if(this._items[a].needsDraw())return!0;return this._needsDraw},getHomeBounds:function(){return this._homeBounds.clone()},getContentFactor:function(){return this._contentFactor},setAutoRefigureSizes:function(a){(this._autoRefigureSizes=a)&this._needsSizesFigured&&(this._figureSizes(),this._needsSizesFigured=!1)},arrange:function(b){var c,d=(b=b||{}).immediately||!1,e=b.layout||a.DEFAULT_SETTINGS.collectionLayout,f=b.rows||a.DEFAULT_SETTINGS.collectionRows,g=b.columns||a.DEFAULT_SETTINGS.collectionColumns,h=b.tileSize||a.DEFAULT_SETTINGS.collectionTileSize,i=h+(b.tileMargin||a.DEFAULT_SETTINGS.collectionTileMargin);c=!b.rows&&g?g:Math.ceil(this._items.length/f);var j,k,l,m=0,n=0;this.setAutoRefigureSizes(!1);for(var o=0;o<this._items.length;o++)o&&o%c==0&&("horizontal"===e?(n+=i,m=0):(m+=i,n=0)),l=(k=(l=(j=this._items[o]).getBounds()).width>l.height?h:h*(l.width/l.height))*(l.height/l.width),l=new a.Point(m+(h-k)/2,n+(h-l)/2),j.setPosition(l,d),j.setWidth(k,d),"horizontal"===e?m+=i:n+=i;this.setAutoRefigureSizes(!0)},_figureSizes:function(){var b=this._homeBounds?this._homeBounds.clone():null,c=this._contentSize?this._contentSize.clone():null,d=this._contentFactor||0;if(this._items.length){var e=this._items[0],f=e.getBounds();this._contentFactor=e.getContentSize().x/f.width;for(var g=e.getClippedBounds().getBoundingBox(),h=g.x,i=g.y,j=g.x+g.width,k=g.y+g.height,l=1;l<this._items.length;l++)f=(e=this._items[l]).getBounds(),this._contentFactor=Math.max(this._contentFactor,e.getContentSize().x/f.width),g=e.getClippedBounds().getBoundingBox(),h=Math.min(h,g.x),i=Math.min(i,g.y),j=Math.max(j,g.x+g.width),k=Math.max(k,g.y+g.height);this._homeBounds=new a.Rect(h,i,j-h,k-i),this._contentSize=new a.Point(this._homeBounds.width*this._contentFactor,this._homeBounds.height*this._contentFactor)}else this._homeBounds=new a.Rect(0,0,1,1),this._contentSize=new a.Point(1,1),this._contentFactor=1;this._contentFactor===d&&this._homeBounds.equals(b)&&this._contentSize.equals(c)||this.raiseEvent("metrics-change",{})},_raiseRemoveItem:function(a){this.raiseEvent("remove-item",{item:a})}})}(OpenSeadragon),function(a){function b(a){return a?Array.prototype.slice.call(a):[]}function c(a,b){return b||0!==a.indexOf("#")?(b||document).querySelector(a):document.getElementById(a.substr(1,a.length))}function d(a,c){return b((c||document).querySelectorAll(a))}a.$=c,a.$$=d,a.ff={toArray:b}}(this),function(a){function b(){U=X.innerHeight,V=X.innerWidth,T=aa?aa.offsetHeight:0,c()}function c(){var a=X.pageYOffset||Z.scrollTop;da=a<W,W=a}function d(){(!ea||Math.abs(ea-U)>250)&&(ea=U,Z.style.setProperty("--vh",U+"px"))}function e(a,b,c){var d;return function(){var e=this,f=arguments,g=function(){d=null,c||a.apply(e,f)},h=c&&!d;clearTimeout(d),d=setTimeout(g,b),h&&a.apply(e,f)}}function f(a,b){ha.push({selector:a,callback:b})}function g(b){var c=new MouseEvent("click",{bubbles:!0,cancelable:!0,view:a});b.dispatchEvent(c)}function h(){Z.classList.contains("is-menu-open")||(ia&&X.clearTimeout(ia),fa=W,Z.classList.add("is-menu-open"),ia=X.setTimeout(function(){Z.classList.add("is-scrollBlocked")},100))}function i(){Z.classList.contains("is-menu-open")&&(ia&&X.clearTimeout(ia),Z.classList.remove("is-scrollBlocked"),Z.scrollTop=fa,X.setTimeout(function(){Z.classList.remove("is-menu-open"),Z.classList.remove("is-nav-hide")},50))}function j(){da||W<T?Z.classList.remove("is-nav-hide"):(l(),Z.classList.add("is-nav-hide"))}function k(a,b){a&&a.preventDefault(),b.matches('[aria-expanded="true"]')?l(b.getAttribute("aria-controls")):Z.classList.contains("is-panel-open")?(l(),m(b.getAttribute("aria-controls"))):m(b.getAttribute("aria-controls"))}function l(a){if(Z.classList.contains("is-panel-open")){var b=a?$('.js-panel-toggle[aria-controls="'+a+'"][aria-expanded="true"]'):$('.js-panel-toggle[aria-controls][aria-expanded="true"]'),c=!!b&&$("#"+b.getAttribute("aria-controls"));Z.classList.remove("is-panel-open"),b&&b.setAttribute("aria-expanded","false"),c&&c.setAttribute("aria-hidden","true")}}function m(a){var b=$("#"+a),c=$('.js-panel-toggle[aria-controls="'+a+'"]');c&&b&&(Z.classList.add("is-panel-open"),c.setAttribute("aria-expanded","true"),b.setAttribute("aria-hidden","false"))}function n(a){a&&a.preventDefault(),ka-=1,Z.style.setProperty("--text-font-size",ka+"px"),p()}function o(a){a&&a.preventDefault(),ka+=1,Z.style.setProperty("--text-font-size",ka+"px"),p()}function p(){y(),H(),ka>=24?$(".js-settings-size-inc").setAttribute("disabled","disabled"):$(".js-settings-size-inc").removeAttribute("disabled"),ka<=12?$(".js-settings-size-dec").setAttribute("disabled","disabled"):$(".js-settings-size-dec").removeAttribute("disabled")}function q(a){a&&a.preventDefault(),Z.style.removeProperty("--text-font-size"),ka=ja,p(),Z.removeAttribute("data-theme-color"),$('input[name="color-theme-radios"][value="light"]',aa).checked=!0}function r(){ca&&la&&ma&&(ma.getBoundingClientRect().top<T&&ca.getBoundingClientRect().top+ca.clientHeight>la.clientHeight+T?la.classList.add("is-fixed"):la.classList.remove("is-fixed"))}function s(){$$(".js-acc",ba).forEach(function(a){var b=a.firstElementChild,c=a.lastElementChild,d="acc-btn-"+na,e="acc-content-"+na;if(b&&c){var f=$("a",b);if(f)f.classList.add("js-acc-trigger"),f.setAttribute("aria-expanded","false"),f.setAttribute("aria-controls",e),f.id=d;else{var g=b.className;b.className="",b.innerHTML='<button type="button" aria-expanded="false" class="js-acc-trigger '+g+'" aria-controls="'+e+'" id="'+d+'">'+b.innerHTML+"</button>"}c.setAttribute("aria-hidden","true"),c.setAttribute("aria-labelledby",d),c.id=e,c.classList.add("js-acc-content"),na++}})}function t(a,b){a&&a.preventDefault();var c=$("#"+b.getAttribute("aria-controls"));"true"==b.getAttribute("aria-expanded")?(b.setAttribute("aria-expanded","false"),c.setAttribute("aria-hidden","true")):(b.setAttribute("aria-expanded","true"),c.setAttribute("aria-hidden","false"))}function u(a,b){var c=$(".page_infos #notes .js-acc-content",ba);c&&c.matches('[aria-hidden="true"]')&&g($(".page_infos #notes .js-acc-trigger",ba))}function v(a){$$('a[href^="#note-"][id^="note-anchor-"]',a||ba).forEach(function(a){var b=$(a.getAttribute("href"));if(a.setAttribute("aria-hidden","true"),b){var c=b.parentNode.innerHTML,d=Y.createElement("small");d.classList.add("note"),d.innerHTML=c,$("*"+a.getAttribute("href"),d).outerHTML=a.outerHTML,$('[href^="#note-anchor-"]',d).remove(),$('[id^="note-anchor-"]',d).setAttribute("aria-label","Voir la note en fin darticle"),$('[id^="note-anchor-"]',d).removeAttribute("id"),a.after(d)}})}function w(a,b){a&&a.preventDefault();var c=b.matches(".note")?b:b.nextElementSibling,d=b.matches("a")?b.href:!!b.previousElementSibling&&b.previousElementSibling.href;if(c&&c.matches(".note")){var e=$(".note.is-open",ba);c.classList.toggle("is-open"),e&&e!=c&&e.classList.remove("is-open"),d&&support.history&&c.classList.contains("is-open")&&history.replaceState({},"",d)}}function x(a){$$('.note[id^="note-p"]',a||ba).forEach(function(a){var b=Y.createElement("a"),c=$(".note_label",a);b.setAttribute("aria-hidden","true"),b.setAttribute("href","#"+a.id),b.id=a.id,a.removeAttribute("id"),b.innerHTML=c?c.innerHTML:"1",a.before(b)})}function y(){var a=$$(".note",ba),b=$(".page_content",ba);a.forEach(function(c,d){0!==d&&(c.style[ga]="",c.getBoundingClientRect().top<a[d-1].getBoundingClientRect().top+a[d-1].offsetHeight&&(c.style[ga]="translateY("+(a[d-1].getBoundingClientRect().top+a[d-1].offsetHeight-c.getBoundingClientRect().top)+"px)"),b&&d===a.length-1&&(b.style.marginBottom="",c.getBoundingClientRect().top+c.offsetHeight>b.getBoundingClientRect().top+b.offsetHeight&&(b.style.marginBottom=c.getBoundingClientRect().top+c.offsetHeight-b.getBoundingClientRect().top-b.offsetHeight+"px")))})}function z(){oa=$(".side_trigger button",ba),pa=$("#side-summary"),qa=!!pa&&pa.parentNode,oa&&pa&&qa&&(f(".side_trigger button",A),summaryTriggerInitialText=oa.innerHTML,oa.setAttribute("aria-haspopup","true"),oa.setAttribute("aria-controls","side-summary"),oa.setAttribute("aria-expanded","false"),
pa.setAttribute("aria-hidden","true"),pa.setAttribute("aria-modal","true"),pa.setAttribute("role","dialog"),pa.setAttribute("aria-labelledby","summarySideTitle"))}function A(a,b){pa&&oa&&qa&&(qa.classList.contains("is-open")?B():C())}function B(){pa&&oa&&qa&&qa.classList.contains("is-open")&&(oa.setAttribute("aria-expanded","true"),pa.setAttribute("aria-hidden","false"),qa.classList.remove("is-open"))}function C(){pa&&oa&&qa&&!qa.classList.contains("is-open")&&(oa.setAttribute("aria-expanded","false"),pa.setAttribute("aria-hidden","true"),qa.classList.add("is-open"))}function D(a){var b=$$(".txt_plate[data-views]",a);if(b.length){var c=Y.createElement("div"),d="",e=[];c.classList.add("plates"),b.forEach(function(a){var b=a.getAttribute("data-views");b=b.split(","),b.forEach(function(b,c){e.push({src:apiURL+bookID+b+"/full/1000,/0/native.jpg",lgd:a.hasAttribute("data-lgd"+(c+1))?a.getAttribute("data-lgd"+(c+1)):0===c&&a.hasAttribute("data-lgd")?a.getAttribute("data-lgd"):""})})}),e=e.slice(0,4),c.classList.remove("plates-1"),c.classList.remove("plates-2"),c.classList.remove("plates-3"),c.classList.remove("plates-4"),c.classList.add("plates-"+e.length),d+='<div class="plates_inner"><div class="plates_figs">',e.forEach(function(a){d+='<figure class="plates_fig"><img src="'+a.src+'" alt=""><button class="viewer_trigger" type="button"><span class="icon-zoom_in"></span><span class="srOnly">Voir dans la visionneuse</span></button><figcaption class="srOnly">'+a.lgd+"</figcaption></figure>"}),d+='</div><div class="plates_lgds" aria-hidden="true">',e.forEach(function(a){d+=a.lgd&&""!==a.lgd?'<div class="plates_lgd">'+a.lgd+"</div>":""}),d+="</div></div>",c.innerHTML=d,a.append(c),G(c),ta.push(c)}}function E(a){var b=$$(".txt_plate[data-views]:not(.txt_plate[data-views] ~ .txt_plate[data-views])",a||ba).map(function(a){return a.closest(".page_chapter")});b.length&&b.forEach(function(a,b){D(a)}),ra=$$(".plates",ba).map(function(a){return a.closest(".page_chapter")})}function F(){if(ra.length){var a=!1,b=!1;ra.forEach(function(b,c){b.getBoundingClientRect().top<=.8*U&&b.getBoundingClientRect().top+b.clientHeight>=T&&(a=b)}),sa!=a&&(a&&(b=$(".plates",a)),ua&&ua.classList.remove("is-visible"),b&&(G(b),b.classList.add("is-visible")),sa=a,ua=b)}}function G(a){var b=$(".plates_figs",a),c=$$(".plates_fig",b);if(c.length){var d=c.length?parseInt(X.getComputedStyle(c[0],null).getPropertyValue("border-left-width")):0,e=b.clientWidth-1,f=b.clientHeight-1,g=1.496,h=!1,i=!1;c.length>1?2*((e/2-2*d)*g+2*d)>f?(i=f/2,h=(i-2*d)/g+2*d):(h=e/2,i=(h-2*d)*g+2*d):1==c.length&&((e-2*d)*g+2*d>f?(i=f,h=(i-2*d)/g+2*d):(h=e,i=(h-2*d)*g+2*d)),c.forEach(function(a){a.style.height=i?Math.floor(i)+"px":"",a.style.width=h?Math.floor(h)+"px":""})}}function H(){ua&&G(ua)}function I(a){var b=$$(".illusTab_i img, .figure_img",a||ba);b.forEach(function(a){a.insertAdjacentHTML("afterend",'<button class="viewer_trigger" type="button"><span class="icon-zoom_in"></span><span class="srOnly">Voir dans la visionneuse</span></button>')}),b.length&&(va=Y.createElement("div"),va.setAttribute("aria-hidden","true"),va.classList.add("viewer"),va.innerHTML='<button type="button" class="viewer_close"><span class="icon-clear"></span></button><div class="viewer_panel" data-panel-name="infos"><button type="button" class="viewer_panelClose"><span class="icon-clear"></span></button><div class="viewer_panelInner txt txt-xs"></div></div><div class="viewer_nav"><button type="button" class="viewer_btn viewer_btn-infos"><span class="icon-info"></span></button><button type="button" class="viewer_btn viewer_btn-zoom_in" id="viewer-zoom-in"><span class="icon-zoom_in"></span></button><button type="button" class="viewer_btn viewer_btn-zoom_out" id="viewer-zoom-out"><span class="icon-zoom_out"></span></button><button type="button" class="viewer_btn viewer_btn-rotate" id="viewer-rotate-left"><span class="icon-rotate_left"></span></button><a href="#" class="viewer_btn viewer_btn-dl" target="_blank"><span class="icon-vertical_align_bottom"></span></a></div><div class="viewer_navigator" id="viewer-navigator"></div>',_.append(va),wa=OpenSeadragon({element:va,viewportMargins:{left:40,top:40,right:40,bottom:40},showHomeControl:!1,showFullPageControl:!1,zoomInButton:"viewer-zoom-in",zoomOutButton:"viewer-zoom-out",rotateLeftButton:"viewer-rotate-left",showRotationControl:!0,gestureSettingsTouch:{pinchRotate:!0},showNavigator:!0,navigatorId:"viewer-navigator",navigatorOpacity:1,navigatorBorderColor:"#000",navigatorDisplayRegionColor:"#979797"}),wa.addHandler("open",function(a){va.classList.add("is-open")}),wa.addHandler("close",function(a){va.classList.remove("is-open"),va.classList.remove("has-panel-infos-open")}))}function J(a,b){if(a&&a.preventDefault(),va){var c=b.previousElementSibling;c&&c.matches("img[src]")&&K(c)}}function K(a){if(va&&wa){var b=a.getAttribute("src"),c=L(b),d=c?apiURL+bookID+c+"/info.json":{type:"image",url:b,buildPyramid:!1},e=c?apiURL+bookID+c+"/full/full/0/native.jpg":b,f=a.closest("figure"),g=!!f&&$("figcaption",f);$(".viewer_btn-dl",va).setAttribute("href",e),$('.viewer_panel[data-panel-name="infos"] .viewer_panelInner',va).innerHTML=g?"<p>"+g.innerHTML+"</p>":"",wa.open(d)}}function L(a){var b=!1;return-1!==a.indexOf(apiURL+bookID)&&(b=a.replace(apiURL+bookID,""),b=b.split("/"),b=b[0]),b}function M(a){va&&wa&&(a&&a.preventDefault(),wa.close())}function N(a){a&&a.preventDefault(),va.classList.toggle("has-panel-infos-open")}function O(a){a&&a.preventDefault(),va.classList.remove("has-panel-infos-open")}function P(){b()}function Q(){c(),R()}function R(){ya||(ya=!0,X.requestAnimationFrame(S))}function S(){ya=!1,j(),r(),F()}var T,U,V,W,X=a,Y=document,Z=Y.documentElement,_=Y.body,aa=$("#header"),ba=$("#main"),ca=$(".page",ba),da=!1,ea=!1,fa=0;b();var ga;!function(){var a,b=document.createElement("a").style;void 0!==b[a="webkitTransform"]&&(ga=a),void 0!==b[a="msTransform"]&&(ga=a),void 0!==b[a="transform"]&&(ga=a)}();var ha=[];_.addEventListener("click",function(a){a.ctrlKey||ha.forEach(function(b){a.target&&a.target.matches(b.selector+", "+b.selector+" *")&&(a.stopPropagation(),b.callback(a,a.target.closest(b.selector)))})},!1);var ia=!1;f(".js-nav-open",function(a){a.preventDefault(),h()}),f(".js-nav-close",function(a){a.preventDefault(),i()}),f(".js-panel-toggle[aria-controls]",k),f(".js-panel-close",function(a,b){k(a,$('.js-panel-toggle[aria-controls="'+b.closest('[aria-modal="true"], [role="dialog"]').id+'"]'))});var ja=parseInt(X.getComputedStyle(_,null).getPropertyValue("font-size")),ka=ja;f(".js-settings-size-dec",n),f(".js-settings-size-inc",o),$$('input[name="color-theme-radios"]',aa).forEach(function(a){a.addEventListener("change",function(a){"dark"==this.value?Z.setAttribute("data-theme-color","dark"):Z.removeAttribute("data-theme-color")},!1)}),f(".js-settings-reset",q),q();var la=$(".page_nav",ba),ma=$(".page_content",ba),na=0;s(),f(".js-acc-trigger[aria-expanded][aria-controls]",t),f('.page_content a[href^="#note-"]:not([href^="#note-p"])',u),v(),f('.page_content a[href^="#note-p"], .page_content a[href^="#note-p"] + .note',w),x();var oa=!1,pa=!1,qa=!1;z();var ra=[],sa=!1,ta=[],ua=!1;E(),F();var va=!1,wa=!1;I(),f(".viewer_trigger",J),f(".viewer_close",M),f(".viewer_btn-infos",N),f('.viewer_panel[data-panel-name="infos"] .viewer_panelClose',O),Y.addEventListener("keydown",function(a){27==a.keyCode&&(wa&&wa.isOpen()?M():Z.classList.contains("is-menu-open")?i():Z.classList.contains("is-panel-open")?l():B())}),X.addEventListener("resize",P,!1);var xa=e(function(){d(),y(),H()},300);X.addEventListener("resize",xa,!1),xa();var ya=!1;X.addEventListener("scroll",Q,!1)}(window);